*>Copyright (c) 2016-2021 NTT DATA, Inc. All rights reserved.
*>compiler version:  6.0.28692
*>source file name:  SQLROLL24B.cbl
*>date generated  :  Mon Oct 03 09:51:25 CDT 2022
*>compiler options:  -cv -apost -dcmi -cscs=preserve -dz -ld -sp=/apps/test/mdoff/copy:/apps/prod/cid1p/copy -dv=32 -od=/apps/test/mdoff/exe/bat -cirp1 -cmcd -csqq -pt2 -cax -sl2 -rw=FILE-ID
*>source encoding :  UTF-8
*>target encoding :  ISO-8859-1
*>***************************************************************  
IDENTIFICATION DIVISION.                                         
PROGRAM-ID. sqlroll24b.                                          
AUTHOR.   Pablo.                                                 
                                                                 
*>*****************************************************************
*>                   C H A N G E   L O G                           
*>                                                                 
*> CHANGES ARE MARKED BY THE CHANGE EFFECTIVE DATE.                
*>-----------------------------------------------------------------
*>  CHANGE   CHANGE REQUEST PGMR  DESCRIPTION OF CHANGE            
*> EFFECTIVE    NUMBER                                             
*>-----------------------------------------------------------------
*> 063022  CR2019012500003  PEMA  Migrate DB's to SQLSERVER 2016   
*>*****************************************************************
                                                                 
ENVIRONMENT DIVISION.                                            
CONFIGURATION SECTION.                                           
INPUT-OUTPUT SECTION.                                            
FILE-CONTROL.                                                    
                                                                 
    SELECT FILE-IN          ASSIGN TO SYS010                     
                            ORGANIZATION IS LINE SEQUENTIAL.     
                                                                 
DATA DIVISION.                                                   
FILE SECTION.                                                    
                                                                 
FD  FILE-IN                                                      
    BLOCK CONTAINS 0 RECORDS                                     
    RECORDING MODE F.                                            
                                                                 
01  FILE-IN-REC                PIC X(249).                       
                                                                 
working-storage section.                                         
                                                                 
*>EXEC SQL                                                         
*>   INCLUDE SQLCA                                                 
*>END-EXEC                                                         
*>vvv-> file: /apps/prod/cid1p/copy/SQLCA
*>***************************************************************<*
*> Copyright (c) 2016-2021 NTT DATA, Inc. All rights reserved.  *<*
*> Users of NTT DATA Enterprise COBOL may freely                *<*
*> redistribute this copybook.                                  *<*
*>***************************************************************<*
                                                                 
01  SQLCA GLOBAL.                                                
    05  SQLCAID                PIC X(8).                         
    05  SQLCABC                PIC S9(9) COMP-5.                 
    05  SQLCODE                PIC S9(9) COMP-5.                 
    05  SQLERRM.                                                 
        49  SQLERRML           PIC S9(4) COMP-5.                 
        49  SQLERRMC           PIC X(254).                       
    05  SQLERRP                PIC X(8).                         
    05  SQLERRD OCCURS 6 TIMES PIC S9(9) COMP-5.                 
    05  SQLWARN.                                                 
        10 SQLWARN0            PIC X(1).                         
        10 SQLWARN1            PIC X(1).                         
        10 SQLWARN2            PIC X(1).                         
        10 SQLWARN3            PIC X(1).                         
        10 SQLWARN4            PIC X(1).                         
        10 SQLWARN5            PIC X(1).                         
        10 SQLWARN6            PIC X(1).                         
        10 SQLWARN7            PIC X(1).                         
    05  SQLSTATE               PIC X(5).                         
    05  SQLEXT                 PIC S9(5) COMP-3 VALUE 1.         
*>^^^-> file: /apps/prod/cid1p/copy/SQLCA
                                                                 
77  rec-cnt                     pic 9(7) value zeros.            
77  ws-recs-in                  pic 9(7) value zeros.            
77  eof-sw                      pic x value ' '.                 
    88  end-of-input               value 'Y'.                    
                                                                 
01  P pointer.                                                   
01  KIXSYS                      pic X(7)  VALUE Z"KIXSYS".       
01  var-ptr pointer.                                             
01  env-var-len                 pic 9(4)  binary.                
01  rc                          pic 9(9)  binary.                
                                                                 
01  WS-KIXSYS.                                                   
    05  WS-KIX-FIL1             PIC X(10).                       
    05  WS-KIX-APPS             PIC X(10).                       
    05  WS-KIX-ENV              PIC X(10).                       
    05  WS-KIX-MYENV            PIC X(10).                       
    05  WS-KIX-SYS              PIC X(10).                       
                                                                 
EXEC SQL                                                         
   BEGIN DECLARE SECTION                                         
END-EXEC                                                         
                                                                 
01  svr                         pic x(32).                       
01  usr                         pic x(32).                       
01  pass                        pic x(32).                       
01  usr-pass                    pic x(64).                       
01  ws-disp-code                pic s9(11).                      
                                                                 
01  EXTRACT-RECORD.                                              
    05  EXT-CARRIER             PIC X.                           
    05  F                       PIC X.                           
    05  EXT-GROUP               PIC X(6).                        
    05  F                       PIC X.                           
    05  EXT-STATE               PIC XX.                          
    05  F                       PIC X.                           
    05  EXT-ACCOUNT             PIC X(10).                       
    05  F                       PIC X.                           
    05  ext-exp-dt              pic x(10).                       
    05  f                       pic x.                           
    05  ext-eff-dt              pic x(10).                       
    05  F                       PIC X.                           
    05  EXT-YEAR                PIC 9(4).                        
    05  f                       pic x.                           
    05  EXT-MONTH               PIC 99.                          
    05  F                       PIC X.                           
    05  EXT-REPORT-CDE1         PIC X(10).                       
    05  F                       PIC X.                           
    05  EXT-REPORT-CDE2         PIC X(10).                       
    05  F                       PIC X.                           
    05  EXT-REPORT-CDE3         PIC X(10).                       
    05  F                       PIC X.                           
    05  EXT-LF-BEN              PIC X(14).                       
    05  F                       PIC X.                           
    05  EXT-LF-PREM             PIC X(12).                       
    05  F                       PIC X.                           
    05  EXT-LF-CLMS             PIC X(12).                       
    05  F                       PIC X.                           
    05  EXT-AH-BEN              PIC X(14).                       
    05  F                       PIC X.                           
    05  EXT-AH-PREM             PIC X(12).                       
    05  F                       PIC X.                           
    05  EXT-AH-CLMS             PIC X(12).                       
    05  F                       PIC X.                           
    05  EXT-TOT-PREM            PIC X(14).                       
    05  F                       PIC X.                           
    05  EXT-TOT-COMM            PIC X(12).                       
    05  F                       PIC X.                           
    05  EXT-NET-COUNT           PIC X(9).                        
    05  F                       PIC X.                           
    05  ext-account-name        pic x(30).                       
    05  F                       PIC X.                           
    05  EXT-HI-CERT-DT          PIC X(10).                       
    05  F                       PIC X.                           
    05  EXT-EOR                 PIC X.                           
EXEC SQL                                                         
   END DECLARE SECTION                                           
END-EXEC                                                         
                                                                 
01  sqlconnect-parms.                                            
    05  p-sql-server            PIC X(30).                       
    05  p-sql-database          PIC X(30).                       
    05  p-connect-return-code   pic s9(5) comp-5.                
    05  p-sql-return-message    pic x(256).                      
                                                                 
LINKAGE SECTION.                                                 
01  var  pic x(30).                                              
                                                                 
procedure division.                                              
0000-begin.                                                      
                                                                 
    display ' Begin Program '                                    
                                                                 
    set P to address of KIXSYS                                   
    CALL "getenv" using by value P returning var-ptr             
    if var-ptr = null then                                       
       display ' kixsys not set '                                
    else                                                         
       set address of var to var-ptr                             
       move 0 to env-var-len                                     
       inspect var tallying env-var-len                          
         for characters before X'00'                             
       unstring var (1:env-var-len) delimited by '/'             
          into WS-KIX-FIL1 WS-KIX-APPS WS-KIX-ENV WS-KIX-MYENV   
             WS-KIX-SYS                                          
       end-unstring                                              
    end-if                                                       
                                                                 
    display ' KIXSYS  ' ws-kix-myenv                             
                                                                 
    perform 0010-init           thru 0010-exit                   
    perform 0020-connect        thru 0020-exit                   
*>    perform 0030-drop-table     thru 0030-exit                   
*>    perform 0040-create-table   thru 0040-exit                   
    perform 0035-truncate-table thru 0035-exit                   
                                                                 
    open input file-in                                           
                                                                 
    EXEC SQL                                                     
       SET AUTOCOMMIT OFF                                        
    END-EXEC                                                     
                                                                 
    perform 0046-read-input     thru 0046-exit                   
    perform 0045-process-input  thru 0045-exit until             
       end-of-input                                              
*>      or ws-recs-in > 10000                                      
                                                                 
    perform 0060-finish-up      thru 0060-exit                   
    close file-in                                                
    display ' End Program '                                      
    display ' rows inserted ' rec-cnt                            
    display ' records read  ' ws-recs-in                         
    goback                                                       
                                                                 
    .                                                            
0010-init.                                                       
                                                                 
    .                                                            
0010-exit.                                                       
    exit.                                                        
                                                                 
0020-connect.                                                    
                                                                 
    display 'Begin connect to DB '                               
                                                                 
*>***  The below code is for when the db has been                  
*>***  converted to sql server 2016                                
    evaluate ws-kix-myenv                                        
       when 'cid1p'                                              
          move '//sdv-db01.cso.local:1433;'                      
                                to p-sql-server                  
       when 'mdoff'                                              
          move '//hov-tstdb01.cso.local:55330;'                  
                                to p-sql-server                  
       when other                                                
          move '//hov-tstdb01.cso.local:1433;'                   
                                to p-sql-server                  
    end-evaluate                                                 
                                                                 
    move 'Logic'                to p-sql-database                
                                                                 
    CALL 'SQLCONNECT' USING sqlconnect-parms                     
    display ' ret code ' p-connect-return-code                   
    move p-connect-return-code  to sqlcode                       
    move p-sql-return-message   to sqlerrmc                      
                                                                 
                                                                 
    if sqlcode not = 0                                           
       display "Error: cannot connect "                          
       display sqlcode                                           
       display sqlerrmc                                          
       goback                                                    
    end-if                                                       
                                                                 
    display " connect to DB successful "                         
                                                                 
    .                                                            
0020-exit.                                                       
    exit.                                                        
                                                                 
0030-drop-table.                                                 
                                                                 
    display 'Begin Drop table'                                   
    EXEC SQL                                                     
        drop table ROLL24_CPS                                    
    END-EXEC                                                     
    if sqlcode not = 0                                           
       display "Error(anticipated) : cannot drop table "         
       display sqlcode                                           
       display sqlerrmc                                          
*>       goback                                                    
    end-if                                                       
                                                                 
    display ' sql return code ' sqlcode                          
    display ' sql err mess    ' sqlerrmc                         
                                                                 
    .                                                            
0030-exit.                                                       
    exit.                                                        
                                                                 
0035-truncate-table.                                             
                                                                 
    display '*** Begin Truncate table ***'                       
    EXEC SQL                                                     
*>        truncate table ROLL24_CPS                                
        EXECUTE IMMEDIATE 'truncate table ROLL24_CPS'            
    END-EXEC                                                     
    if sqlcode not = 0                                           
       display "Error : cannot truncate table "                  
       display sqlcode                                           
       display sqlerrmc                                          
       goback                                                    
    end-if                                                       
                                                                 
    display ' sql return code ' sqlcode                          
    display ' sql err mess    ' sqlerrmc                         
    display '***  End  Truncate table ***'                       
                                                                 
    .                                                            
0035-exit.                                                       
    exit.                                                        
                                                                 
0040-create-table.                                               
                                                                 
    display ' Begin Create table'                                
    EXEC SQL                                                     
       create table ROLL24_CPS (                                 
               carrier char(1),                                  
               grouping char(6),                                 
               state char(2),                                    
               account char(10),                                 
               exp_date datetime,                                
               eff_date datetime,                                
               year int,                                         
               month int,                                        
               report_cd1 char(10),                              
               report_cd2 char(10),                              
               report_cd3 char(10),                              
               lf_net_benefits decimal(13,2),                    
               lf_net_premium decimal(11,2),                     
               lf_claims decimal(11,2),                          
               ah_net_benefits decimal(13,2),                    
               ah_net_premium decimal(11,2),                     
               ah_claims decimal(11,2),                          
               tot_net_premium decimal(13,2),                    
               tot_net_acct_commission decimal(11,2),            
               net_count decimal(9,0),                           
               account_name varchar(30),                         
               hi_cert_date datetime)                            
    END-EXEC                                                     
    if sqlcode not = 0                                           
       display "Error: cannot create table "                     
       move sqlcode             to ws-disp-code                  
       display ' sql return code ' ws-disp-code                  
       display ' sql err mess    ' sqlerrmc                      
       goback                                                    
    end-if                                                       
                                                                 
    display " Create table successful "                          
                                                                 
    .                                                            
0040-exit.                                                       
    exit.                                                        
                                                                 
0045-process-input.                                              
                                                                 
    perform 0050-insert-row     thru 0050-exit                   
    perform 0046-read-input     thru 0046-exit                   
                                                                 
    .                                                            
0045-exit.                                                       
    exit.                                                        
                                                                 
0046-read-input.                                                 
                                                                 
    read file-in at end                                          
       set end-of-input         to true                          
    end-read                                                     
                                                                 
    if not end-of-input                                          
       move file-in-rec         to extract-record                
       add 1                    to ws-recs-in                    
    end-if                                                       
                                                                 
                                                                 
    .                                                            
0046-exit.                                                       
    exit.                                                        
                                                                 
                                                                 
0050-insert-row.                                                 
                                                                 
*>    display ' Begin Insert row '                                 
                                                                 
    EXEC SQL                                                     
       insert into ROLL24_CPS (                                  
               carrier,                                          
               grouping,                                         
               state,                                            
               account,                                          
               exp_date,                                         
               eff_date,                                         
               year,                                             
               month,                                            
               report_cd1,                                       
               report_cd2,                                       
               report_cd3,                                       
               lf_net_benefits,                                  
               lf_net_premium,                                   
               lf_claims,                                        
               ah_net_benefits,                                  
               ah_net_premium,                                   
               ah_claims,                                        
               tot_net_premium,                                  
               tot_net_acct_commission,                          
               net_count,                                        
               account_name,                                     
               hi_cert_date)                                     
               values (                                          
           :EXT-CARRIER,                                         
           :EXT-GROUP,                                           
           :EXT-STATE,                                           
           :EXT-ACCOUNT,                                         
           :ext-exp-dt,                                          
           :ext-eff-dt,                                          
           :EXT-YEAR,                                            
           :EXT-MONTH,                                           
           :EXT-REPORT-CDE1,                                     
           :EXT-REPORT-CDE2,                                     
           :EXT-REPORT-CDE3,                                     
           :EXT-LF-BEN,                                          
           :EXT-LF-PREM,                                         
           :EXT-LF-CLMS,                                         
           :EXT-AH-BEN,                                          
           :EXT-AH-PREM,                                         
           :EXT-AH-CLMS,                                         
           :EXT-TOT-PREM,                                        
           :EXT-TOT-COMM,                                        
           :EXT-NET-COUNT,                                       
           :ext-account-name,                                    
           :EXT-HI-CERT-DT)                                      
    END-EXEC                                                     
    if sqlcode not = 0                                           
       display "Error: cannot insert row "                       
       display ' sql return code ' sqlcode                       
       display ' sql err mess    ' sqlerrmc                      
       display ' recs so far ' rec-cnt                           
       display ' offending rec ' extract-record                  
       goback                                                    
    end-if                                                       
                                                                 
    add 1 to rec-cnt                                             
                                                                 
    .                                                            
0050-exit.                                                       
    exit.                                                        
                                                                 
0060-finish-up.                                                  
                                                                 
    display ' Begin Commit '                                     
    EXEC SQL                                                     
*>        commit transaction                                       
        commit                                                   
    END-EXEC                                                     
    if sqlcode not = 0                                           
       display "Error: commit "                                  
       display ' sql return code ' sqlcode                       
       display ' sql err mess    ' sqlerrmc                      
       goback                                                    
    end-if                                                       
                                                                 
    display " Commit trans successful "                          
                                                                 
    display ' Begin Disconnect '                                 
    EXEC SQL                                                     
*>        commit work release                                      
        DISCONNECT ALL                                           
    END-EXEC                                                     
    if sqlcode not = 0                                           
       display "Error: commit release "                          
       display ' sql return code ' sqlcode                       
       display ' sql err mess    ' sqlerrmc                      
    end-if                                                       
                                                                 
    .                                                            
0060-exit.                                                       
    exit.                                                        
                                                                 
*> ------------------------------------------------------------------------------------------------------------------
*> The source line number references in the following sections are either of
*> the form <line-number> or <file-number>:<line-number>. The first form is
*> used as an abbreviation for 0:<line-number>.
*> The following is a key allowing the determination of the file name from
*> the <file-number>.
*>  
*>          0: SQLROLL24B.cbl
*>          1: /apps/prod/cid1p/copy/SQLCA
*>  
*> ------------------------------------------------------------------------------------------------------------------
*> DATA MAP KEY
*>               Sec(Section) Fil = File Section                Type Flags: column O    ---> O = Occurs Item
*>                            Wor = Working-Storage Section                 column R    ---> R = Redefines
*>                            Loc = Local-Storage Section                   column X/G  ---> X = External
*>                            Rep = Report Section                                           G = Global
*>                            Lin = Linkage Section                         
*> ------------------------------------------------------------------------------------------------------------------
*> Data map for Program-Id: SQLROLL24B
*> ------------------------------------------------------------------------------------------------------------------
*>     Line    Name                                                  Size Offset      Sec Flags Data Type
*>                                                                                        O R X
*>                                                                                            G
*> ------------------------------------------------------------------------------------------------------------------
*>       32 01 FILE-IN-REC                                            249             Fil       Display
*>      1:7 01 SQLCA                                                  320             Wor     G Group
*>      1:8   05 SQLCAID                                                8 (000000000)         G Display
*>      1:9   05 SQLCABC                                                4 (000000008)         G Native Binary
*>     1:10   05 SQLCODE                                                4 (000000012)         G Native Binary
*>     1:11   05 SQLERRM                                              256 (000000016)         G Group
*>     1:12     49 SQLERRML                                             2 (000000016)         G Native Binary
*>     1:13     49 SQLERRMC                                           254 (000000018)         G Display
*>     1:14   05 SQLERRP                                                8 (000000272)         G Display
*>     1:15   05 SQLERRD                                                4 (000000280)     O   G Native Binary
*>     1:16   05 SQLWARN                                                8 (000000304)         G Group
*>     1:17     10 SQLWARN0                                             1 (000000304)         G Display
*>     1:18     10 SQLWARN1                                             1 (000000305)         G Display
*>     1:19     10 SQLWARN2                                             1 (000000306)         G Display
*>     1:20     10 SQLWARN3                                             1 (000000307)         G Display
*>     1:21     10 SQLWARN4                                             1 (000000308)         G Display
*>     1:22     10 SQLWARN5                                             1 (000000309)         G Display
*>     1:23     10 SQLWARN6                                             1 (000000310)         G Display
*>     1:24     10 SQLWARN7                                             1 (000000311)         G Display
*>     1:25   05 SQLSTATE                                               5 (000000312)         G Display
*>     1:26   05 SQLEXT                                                 3 (000000317)         G Packed Decimal
*>       40 77 REC-CNT                                                  7             Wor       Display Numeric
*>       41 77 WS-RECS-IN                                               7             Wor       Display Numeric
*>       42 77 EOF-SW                                                   1             Wor       Display
*>       43   88 END-OF-INPUT                                                                   
*>       45 01 P                                                        4             Wor       Pointer
*>       46 01 KIXSYS                                                   7             Wor       Display
*>       47 01 VAR-PTR                                                  4             Wor       Pointer
*>       48 01 ENV-VAR-LEN                                              2             Wor       Binary
*>       49 01 RC                                                       4             Wor       Binary
*>       51 01 WS-KIXSYS                                               50             Wor       Group
*>       52   05 WS-KIX-FIL1                                           10 (000000000)           Display
*>       53   05 WS-KIX-APPS                                           10 (000000010)           Display
*>       54   05 WS-KIX-ENV                                            10 (000000020)           Display
*>       55   05 WS-KIX-MYENV                                          10 (000000030)           Display
*>       56   05 WS-KIX-SYS                                            10 (000000040)           Display
*>       62 01 SVR                                                     32             Wor       Display
*>       63 01 USR                                                     32             Wor       Display
*>       64 01 PASS                                                    32             Wor       Display
*>       65 01 USR-PASS                                                64             Wor       Display
*>       66 01 WS-DISP-CODE                                            11             Wor       Display Numeric
*>       68 01 EXTRACT-RECORD                                         249             Wor       Group
*>       69   05 EXT-CARRIER                                            1 (000000000)           Display
*>       70   05 F                                                      1 (000000001)           Display
*>       71   05 EXT-GROUP                                              6 (000000002)           Display
*>       72   05 F                                                      1 (000000008)           Display
*>       73   05 EXT-STATE                                              2 (000000009)           Display
*>       74   05 F                                                      1 (000000011)           Display
*>       75   05 EXT-ACCOUNT                                           10 (000000012)           Display
*>       76   05 F                                                      1 (000000022)           Display
*>       77   05 EXT-EXP-DT                                            10 (000000023)           Display
*>       78   05 F                                                      1 (000000033)           Display
*>       79   05 EXT-EFF-DT                                            10 (000000034)           Display
*>       80   05 F                                                      1 (000000044)           Display
*>       81   05 EXT-YEAR                                               4 (000000045)           Display Numeric
*>       82   05 F                                                      1 (000000049)           Display
*>       83   05 EXT-MONTH                                              2 (000000050)           Display Numeric
*>       84   05 F                                                      1 (000000052)           Display
*>       85   05 EXT-REPORT-CDE1                                       10 (000000053)           Display
*>       86   05 F                                                      1 (000000063)           Display
*>       87   05 EXT-REPORT-CDE2                                       10 (000000064)           Display
*>       88   05 F                                                      1 (000000074)           Display
*>       89   05 EXT-REPORT-CDE3                                       10 (000000075)           Display
*>       90   05 F                                                      1 (000000085)           Display
*>       91   05 EXT-LF-BEN                                            14 (000000086)           Display
*>       92   05 F                                                      1 (000000100)           Display
*>       93   05 EXT-LF-PREM                                           12 (000000101)           Display
*>       94   05 F                                                      1 (000000113)           Display
*>       95   05 EXT-LF-CLMS                                           12 (000000114)           Display
*>       96   05 F                                                      1 (000000126)           Display
*>       97   05 EXT-AH-BEN                                            14 (000000127)           Display
*>       98   05 F                                                      1 (000000141)           Display
*>       99   05 EXT-AH-PREM                                           12 (000000142)           Display
*>      100   05 F                                                      1 (000000154)           Display
*>      101   05 EXT-AH-CLMS                                           12 (000000155)           Display
*>      102   05 F                                                      1 (000000167)           Display
*>      103   05 EXT-TOT-PREM                                          14 (000000168)           Display
*>      104   05 F                                                      1 (000000182)           Display
*>      105   05 EXT-TOT-COMM                                          12 (000000183)           Display
*>      106   05 F                                                      1 (000000195)           Display
*>      107   05 EXT-NET-COUNT                                          9 (000000196)           Display
*>      108   05 F                                                      1 (000000205)           Display
*>      109   05 EXT-ACCOUNT-NAME                                      30 (000000206)           Display
*>      110   05 F                                                      1 (000000236)           Display
*>      111   05 EXT-HI-CERT-DT                                        10 (000000237)           Display
*>      112   05 F                                                      1 (000000247)           Display
*>      113   05 EXT-EOR                                                1 (000000248)           Display
*>      118 01 SQLCONNECT-PARMS                                       320             Wor       Group
*>      119   05 P-SQL-SERVER                                          30 (000000000)           Display
*>      120   05 P-SQL-DATABASE                                        30 (000000030)           Display
*>      121   05 P-CONNECT-RETURN-CODE                                  4 (000000060)           Native Binary
*>      122   05 P-SQL-RETURN-MESSAGE                                 256 (000000064)           Display
*>      125 01 VAR                                                     30             Lin       Display
*> ------------------------------------------------------------------------------------------------------------------
*> --I: #14 Compiling SQLROLL24B.cbl
