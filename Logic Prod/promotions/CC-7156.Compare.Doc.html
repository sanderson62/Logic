<html>
<head>
<title>Compare Module List</title>
</head>
<body style="background-color:PowderBlue;"><div align="center"><h2>Compares for CC-7156-PEMA.ini</h2>
<h3>Processed on - 04/25/2019</h3></div>
<a name="topper"></a>
<a href="#inifile">INI File</a><br>
<a href="#EL691S.bms">EL691S.bms</a><br>
<a href="#ERCARCH">ERCARCH</a><br>
<a href="#EL691.cl2">EL691.cl2</a><br>
<h3>INI FILE As submitted by programmer, followed by log information <h3>
<pre>

[2018080300002]
[/apps/test/cid1s/jcl/daily_jobs/;/apps/prod/cid1p/jcl/daily_jobs/]
[/apps/test/cid1s/jcl/monthly_jobs/;/apps/prod/cid1p/jcl/monthly_jobs/]
[/apps/test/cid1s/jcl/quarterly_jobs/;/apps/prod/cid1p/jcl/quarterly_jobs/]
[/apps/test/cid1s/jcl/yearly_jobs/;/apps/prod/cid1p/jcl/yearly_jobs/]
[/export/home/pema/bin/;/export/home/mtpadmin/bin/]
[/data/test/seqfiles/;/data/seqfiles/]
[/apps/test/cid1s/sys/webroot/;/apps/prod/cid1p/sys/webroot/]
[/apps/test/cid1s/sys/webroot/balancesheet/;/apps/prod/cid1p/sys/webroot/balancesheet/]
[/apps/test/cid1s/sys/webroot/balancesheet/images/;/apps/prod/cid1p/sys/webroot/balancesheet/images/]
[/apps/test/cid1s/sys/webroot/balancesheet/javascript/;/apps/prod/cid1p/sys/webroot/balancesheet/javascript/]
[/apps/test/cid1s/sys/webroot/balancesheet/style/;/apps/prod/cid1p/sys/webroot/balancesheet/style/]
[/apps/test/cid1s/maps/;/apps/prod/cid1p/maps/]
EL691S.bms=
EL691S.map=
EL691S=
[/apps/test/cid1s/copy/;/apps/prod/cid1p/copy/]
ERCARCH=
[/apps/test/cid1s/emails/;/apps/prod/cid1p/emails/]
[/apps/test/cid1s/parmlib/;/apps/prod/cid1p/parmlib/]
[/apps/test/cid1s/src/batch/;/apps/prod/cid1p/src/batch/]
[/apps/test/cid1s/src/online/;/apps/prod/cid1p/src/online/]
EL691.cl2=
EL691.cbl=
EL691.lst=
[/apps/test/cid1s/exe/bat/;/apps/prod/cid1p/staging/exe_bat/]
[/apps/test/cid1s/exe/onl/;/apps/prod/cid1p/staging/exe_onl/]
EL691.gnt=
Archive Process Successfull using - perl /export/home/mtpadmin/bin/mtp_archive.pl CC-7156-PEMA.ini
Move Process Successfull using - perl /export/home/mtpadmin/bin/mtp_move.pl CC-7156-PEMA.ini
Promote process successfull and verified using - perl /export/home/mtpadmin/bin/mtp_verify.pl CC-7156-PEMA.ini
Archived module - /apps/prod/cid1p/maps/archive/EL691S.bms.20190425
Archived module - /apps/prod/cid1p/maps/archive/EL691S.map.20190425
Archived module - /apps/prod/cid1p/maps/archive/EL691S.20190425
Archived module - /apps/prod/cid1p/copy/archive/ERCARCH.20190425
Archived module - /apps/prod/cid1p/src/online/archive/EL691.cl2.20190425
Archived module - /apps/prod/cid1p/src/online/archive/EL691.cbl.20190425
Archived module - /apps/prod/cid1p/src/online/archive/EL691.lst.20190425
Archived module - /apps/prod/cid1p/exe/onl/archive/EL691.gnt.20190425
moved module - /apps/prod/cid1p/maps/EL691S.bms
moved module - /apps/prod/cid1p/maps/EL691S.map
moved module - /apps/prod/cid1p/maps/EL691S
moved module - /apps/prod/cid1p/copy/ERCARCH
moved module - /apps/prod/cid1p/src/online/EL691.cl2
moved module - /apps/prod/cid1p/src/online/EL691.cbl
moved module - /apps/prod/cid1p/src/online/EL691.lst
moved module - /apps/prod/cid1p/staging/exe_onl/EL691.gnt

</pre>
<h3><a name="EL691.cl2">EL691.cl2</a><br><a href="#topper">Back to Top</a><br><pre>

0a1
>       $SET SQL(dbman=ODBC, TARGETDB=MSSQLSERVER, NOAUTOCOMMIT)
28a30
> 102918* 102918  CR2018080300002  PEMA  ADD VOID OB LETTER OPTION
36c38,121
< 00022                                  EJECT
---
> 102918 77  c1                          pic s9(5) comp-3 value +0.
> 102918 77  n1                          pic s999  comp-3 value +0.
> 102918 77  w-comment-line-cnt          pic s999 comp-3 value +0.
> 102918 77  ws-cert-note-generic-key-len pic s9(4) comp value +34.
> 102918 77  note-count                  pic s999 comp-3 value +0.
> 102918 77  ws-build-note-sw            pic x value ' '.
> 102918     88  finished-with-notes      value 'Y'.
> 102918 77  ws-ercnot-sw                pic x  value spaces.
> 102918     88  ercnot-startbr            value 'Y'.
> 102918
> 102918 01  P pointer.
> 102918 01  KIXSYS                      pic X(7)  VALUE Z"KIXSYS".
> 102918 01  var-ptr pointer.
> 102918 01  env-var-len                 pic 9(4)  binary.
> 102918 01  rc                          pic 9(9)  binary.
> 102918
> 102918 01  WS-KIXSYS.
> 102918     05  WS-KIX-FIL1             PIC X(10).
> 102918     05  WS-KIX-APPS             PIC X(10).
> 102918     05  WS-KIX-ENV              PIC X(10).
> 102918     05  WS-KIX-MYENV            PIC X(10).
> 102918     05  WS-KIX-SYS              PIC X(10).
> 
>        EXEC SQL
>           INCLUDE SQLDA
>        END-EXEC
>       
>        EXEC SQL
>           INCLUDE SQLCA
>        END-EXEC
> 
>        EXEC SQL
>           BEGIN DECLARE SECTION
>        END-EXEC
> 
>        01  sqlcmd                      pic x(1024).
>        01  WS-MOE-DATE                 pic x(10).
>        01  svr                         pic x(32).
>        01  usr                         pic x(32).
>        01  pass                        pic x(32).
>        01  usr-pass                    pic x(64).
>        01  ws-sql-code                 pic s9(7) value zeros.
>        01  ws-dis-sql-code             pic -9999999 value zeros.
> 
>       ***-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_***
>       ***                                                            ***
>       ***  These indicators are used to determine if a variable      ***
>       ***  is passed nulls from sql. The indicator will be -1        ***
>       ***  if the value on sql is nulls and +0 if the value is       ***
>       ***  something other than nulls. Here is an example on how     ***
>       ***  to use the indicator variables.                           ***
>       ***                                                            ***
>       ***     EXEC SQL                                               ***
>       ***        fetch keyword into                                  ***
>       ***           :db-Complete-dt :nu-Complete-date,               ***
>       ***           :db-app-by     :nu-app-by,                       ***
>       ***           :db-app-date   :nu-app-date,                     ***
>       ***           :db-app-batch  :nu-app-batch                     ***
>       ***     END-EXEC                                               ***
>       ***                                                            ***
>       ***_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-***
> 
>        01  indicator-vaiables-for-nulls.
>            05  nu-Complete-date        pic s9(4) comp value +0.
> 
>        01  key-word-key-data.
>            05  kd-unique-id            pic 9(7).
>            05  kd-cert-no              pic x(11).
> 
>        01  key-word-table-data.
>            05  db-req-date             pic x(10).
>            05  db-doc-type             pic x(30).
>            05  db-Cert-no              pic x(11).
>            05  db-Print-dt             pic x(10).
>            05  db-Cert-exp-dt          pic x(10).
>            05  db-cert-state           pic xx.
>            05  db-key-word-type        pic x(30).
>            05  db-key-word-value       pic x(30).
>            05  db-complete-dt          pic x(10).
> 
>        EXEC SQL
>           END DECLARE SECTION
>        END-EXEC
> 
38a124,130
> 102918     12  ws-sql-update-sw        pic x value ' '.
> 102918         88  sql-update-succeeded    value 'Y'.
> 102918         88  sql-update-failed       value 'N'.
> 102918     12  ws-connect-sw           pic x  value ' '.
> 102918         88  connected-to-db        value 'Y'.
> 102918     12  ws-cert-sw              pic x value ' '.
> 102918         88  cert-found             value 'Y'.
69a162
> 102918         88  resp-lengtherr               value +22.
82a176,177
> 102918     12  w-stop-letter-comment   pic x(126) value spaces.
> 102918     12  w-cert-note-comment     pic x(70) value spaces.
166a262,269
> 
> 102918 01  w-comment-line-1            pic x(63) value spaces.
> 102918 01  w-comment-line-2            pic x(63) value spaces.
> 102918 01  cert-note-records-holder.
> 102918     05  cert-note-record occurs 500.
> 102918         10  filler              pic x(48).
> 102918         10  cnr-rest            pic x(102).
> 
288,289c391,393
< 122612         16  FILLER              PIC X(59).                       
< 00235                                  EJECT                            
---
> 102918         16  pi-create-date         pic x(08).
> 102918         16  pi-initial-print-date  pic xx.
> 102918         16  FILLER              PIC X(49).                       
322a427
> 102918     12  ER-0249                 PIC  X(04) VALUE '0249'.
330a436,440
> 102918     12  ER-7330                 PIC  X(04) VALUE '7330'.
> 102918     12  ER-7331                 PIC  X(04) VALUE '7331'.
> 102918     12  ER-7332                 PIC  X(04) VALUE '7332'.
> 102918     12  ER-7333                 PIC  X(04) VALUE '7333'.
> 102918     12  ER-7334                 PIC  X(04) VALUE '7334'.
331a442
> 102918     12  ER-7364                 PIC  X(04) VALUE '7364'.
337,338c448,449
< 00281                                  EJECT
< 00282      COPY ELCAID.
---
> 
> 00282                                  COPY ELCAID.
342,351c453,460
< 00286                                  EJECT
< 00287      COPY ELCATTR.
< 00288                                  EJECT
< 00289      COPY ELCDATE.
< 00290                                  EJECT
< 100813     COPY ELCTEXT.
< 100813                                 EJECT
< 00291      COPY ELCNWA.
< 00292                                  EJECT
< 00293      COPY ELCEMIB.
---
> 
> 00287                                  COPY ELCATTR.
> 00289                                  COPY ELCDATE.
> 100813                                 COPY ELCTEXT.
> 00291                                  COPY ELCNWA.
> 00293                                  COPY ELCEMIB.
>                                        COPY ERCCNOT.
> 
353,362c462,467
< 00295                                  EJECT
< 00296      COPY ELCLOGOF.
< 00297                                  EJECT
< 00298      COPY ELCSCTM.
< 00299                                  EJECT
< 00300      COPY ELCSCRTY.
< 00301                                  EJECT
< 00302
< 00303      COPY EL691S.
< 00304                                  EJECT
---
> 
> 00296                                  COPY ELCLOGOF.
> 00298                                  COPY ELCSCTM.
> 00300                                  COPY ELCSCRTY.
> 00303                                  COPY EL691S.
> 
365,378c470,476
< 00307
< 00308      COPY ERCARCH.
< 00309
< 00310      COPY ERCARCT.
< 00311      
< 00312      COPY ERCCNOT.
< 00313      
< 00314      COPY ELCCERT.
< 122612
< 122612     COPY ELCEOBC.
< 122612
< 122612     COPY ERCNOTE.
< 00315                                  EJECT
< 00316
---
> 00308                                  COPY ERCARCH.
> 00310                                  COPY ERCARCT.
> 00314                                  COPY ELCCERT.
> 122612                                 COPY ELCEOBC.
> 122612                                 COPY ERCNOTE.
> 102918 01  var                         pic x(30).
> 
381a480
> 
397c496,511
< 00335
---
> 
> 102918     set P to address of KIXSYS
> 102918     CALL "getenv" using by value P returning var-ptr
> 102918     if var-ptr = null then
> 102918        display ' kixsys not set '
> 102918     else
> 102918        set address of var to var-ptr
> 102918        move 0 to env-var-len
> 102918        inspect var tallying env-var-len
> 102918          for characters before X'00' 
> 102918        unstring var (1:env-var-len) delimited by '/'
> 102918           into WS-KIX-FIL1 WS-KIX-APPS WS-KIX-ENV WS-KIX-MYENV
> 102918              WS-KIX-SYS
> 102918        end-unstring
> 102918     end-if
> 
698c812,833
< 00612
---
> 
> 102918     if (stopdtel > zeros)
> 102918        and (PI-ARCHIVE-STOPPED = 'Y')
> 102918        and (pi-initial-print-date <> low-values)
> 102918        if obvyni not = 'Y' AND 'N'
> 102918           move -1               to obvynl
> 102918           move al-uabon         to obvyna
> 102918           move er-7364          to emi-error
> 102918           perform 9900-error-format
> 102918                                 thru 9900-exit
> 102918        end-if
> 102918     end-if
> 
> 102918     if obvynl > zeros
> 102918        and pi-archive-stopped <> 'Y'
> 102918        move -1                  to stopdtel
> 102918        move al-uabon            to stopdtea
> 102918        move er-7333             to emi-error
> 102918        perform 9900-error-format
> 102918                                 thru 9900-exit
> 102918     end-if
> 
701a837
> 102918      or obvynl > 0
722c858
< 00636                                COMMENTA
---
> 102918*                              COMMENTA
734,742c870,882
< 00648
< 00649      IF REPLYL GREATER ZERO
< 00650          MOVE W-RECEIVED-DATE    TO  LA-REPLY-DATE
< 00651          IF W-RECEIVED-DATE NOT EQUAL LOW-VALUES
< 00652              PERFORM 4000-ADD-CERT-NOTE THRU 4099-EXIT
< 122612             PERFORM 4500-UPDATE-BILL-NOTE THRU 4500-EXIT
< 00653          END-IF
< 00654      END-IF.
< 00655
---
> 
> 00649      IF REPLYL GREATER ZERO  *> its really received date
> 00650         MOVE W-RECEIVED-DATE     TO LA-REPLY-DATE
> 00651         IF W-RECEIVED-DATE <> LOW-VALUES
> 102918           move w-cert-note-msg  to w-comment-line-1
> 102918           move +1               to w-comment-line-cnt
> 00652            PERFORM 4000-ADD-CERT-NOTE
>                                        THRU 4099-EXIT
> 122612           PERFORM 4500-UPDATE-BILL-NOTE
>                                        THRU 4500-EXIT
> 00653         END-IF
> 00654      END-IF
> 
754c894,963
< 00667
---
> 
> 102918     perform 1620-read-elcert    thru 1620-exit
> 102918
> 102918     IF (OBVYNL > ZERO)
> 102918        and (obvyni <> la-void-onbase-yn)
> 102918        if (obvyni = 'N')
> 102918           and (la-void-onbase-yn = spaces)
> 102918           continue
> 102918        else
> 102918           if la-initial-print-date <> low-values
> 102918              perform 1600-update-obkeywords
> 102918                                 thru 1600-exit
> 102918           end-if
> 102918        end-if
> 102918        MOVE OBVYNI              TO LA-VOID-ONBASE-YN
> 102918     end-if
> 102918
> 102918     if (not cert-found)
> 102918        or (sql-update-failed)
> 102918        or ((la-initial-print-date = low-values)
> 102918              and
> 102918            (la-void-onbase-yn = 'Y'))
> 102918        exec cics unlock
> 102918           dataset (W-ARCH-FILE-ID)
> 102918        end-exec
> 102918        if connected-to-db
> 102918           move ' '              to ws-connect-sw
> 102918           display ' about to disconnect '
> 102918           exec sql
> 102918              disconnect
> 102918           end-exec
> 102918        end-if
> 102918     end-if
> 102918
> 102918     if not cert-found
> 102918        move er-0249             to emi-error
> 102918        move -1                  to maintl
> 102918        perform 9900-error-format thru 9900-exit
> 102918        go to 8200-send-dataonly
> 102918     end-if
> 102918
> 102918     if sql-update-failed
> 102918        move er-7331             to emi-error
> 102918        move -1                  to maintl
> 102918        perform 9900-error-format thru 9900-exit
> 102918        go to 8200-send-dataonly
> 102918     end-if
> 102918
> 102918     if (la-void-onbase-yn = 'Y')
> 102918        and (la-initial-print-date = low-values)
> 102918        move er-7334             to emi-error
> 102918        move -1                  to maintl
> 102918        perform 9900-error-format thru 9900-exit
> 102918        go to 8200-send-dataonly
> 102918     end-if
> 102918
> 102918     if sql-update-succeeded
> 102918        display ' about to commit work '
> 102918        exec sql
> 102918           commit work
> 102918        end-exec
> 102918     end-if
> 102918     if connected-to-db
> 102918        display ' about to disconnect all '
> 102918        exec sql
> 102918           disconnect
> 102918        end-exec
> 102918        move ' ' to ws-connect-sw
> 102918     end-if
> 
766c975,983
< 00679
---
> 
> 102918     if (commentl > zeros)
> 102918        and (commenti not = spaces)
> 102918        move commenti            to w-cert-note-comment
> 102918        perform 4160-check-comment thru 4160-exit
> 102918        PERFORM 4000-ADD-CERT-NOTE
> 102918                                 THRU 4099-EXIT
> 102918     end-if
> 
778c995
< 00691      MOVE COMMENTI        TO  LT-COMMENT-LINE (LC-NDX).
---
> 00691      MOVE COMMENTI        TO  LT-COMMENT-LINE (LC-NDX)
842a1060
> 102918                                    pi-create-date
847a1066
> 102918                                     pi-create-date
853a1073
> 102918         move low-values         to pi-initial-print-date
854a1075,1076
> 102918         move la-initial-print-date
> 102918                                 to pi-initial-print-date
917c1139,1147
< 00823
---
> 
> 102918     if LA-VOID-ONBASE-YN not = spaces
> 102918        move LA-VOID-ONBASE-YN   to obvyno
> 102918     end-if
> 
> 102918     if la-onbase-unique-id numeric
> 102918        move la-onbase-unique-id to obuido
> 102918     end-if
> 
1037,1039c1267,1478
< 100813
< 00897
< 00898  3000-READ-FOR-UPDATE SECTION.
---
> 
> 102918 1600-update-obkeywords.
> 102918
> 102918     if not connected-to-db
> 102918        perform 1700-CONNECT-TO-DB
> 102918                                 thru 1700-exit
> 102918     end-if
> 102918
> 102918*    perform 1620-read-elcert    thru 1620-exit
> 102918*    if not cert-found
> 102918*       go to 1600-exit
> 102918*    end-if
> 102918
> 102918     if obvyni = 'N'
> 102918        if la-onbase-unique-id numeric
> 102918           and la-onbase-unique-id > 0
> 102918           perform 1610-void-void thru 1610-exit
> 102918           go to 1600-exit
> 102918        end-if
> 102918     end-if
> 102918
> 102918***  If I get here I assume they are voiding the letter
> 102918***  I am using a stored procedure so I can get back the
> 102918***  unique id from the insert and update the erarch
> 102918***  record with it.  May come in handy down the road
> 102918
> 102918     if obvyni = 'Y'
> 102918        and (la-onbase-unique-id not numeric
> 102918           or la-onbase-unique-id = zeros)
> 102918        continue
> 102918     else
> 102918        go to 1600-exit
> 102918     end-if
> 102918
> 102918     move 'CID Certs'            to db-doc-type
> 102918     move 'Status'               to db-key-word-type
> 102918     move 'V'                    to db-key-word-value
> 102918     move cm-state               to db-cert-state
> 102918     move cm-cert-prime          to db-cert-no
> 102918     move cm-lf-loan-expire-dt   to dc-bin-date-1
> 102918     if cm-ah-loan-expire-dt > cm-lf-loan-expire-dt
> 102918        move cm-ah-loan-expire-dt
> 102918                                 to dc-bin-date-1
> 102918     end-if
> 102918     move ' '                    to dc-option-code
> 102918     perform 9500-LINK-DATE-CONVERT thru 9500-exit
> 102918     if no-conversion-error
> 102918        move dc-greg-date-a-edit to db-cert-exp-dt
> 102918        inspect db-cert-exp-dt
> 102918           converting '/' to '-'
> 102918     end-if
> 102918     move la-initial-print-date  to dc-bin-date-1
> 102918     move ' '                    to dc-option-code
> 102918     perform 9500-LINK-DATE-CONVERT thru 9500-exit
> 102918     if no-conversion-error
> 102918        move dc-greg-date-a-edit to db-print-dt
> 102918        inspect db-print-dt
> 102918           converting '/' to '-'
> 102918     end-if
> 102918
> 102918     EXEC SQL
> 102918        CALL sp_OBKeyWordChgs_ADD
> 102918           @DocType       =  :db-doc-type,
> 102918           @CertNo        =  :db-cert-no,
> 102918           @PrintDt       =  :db-print-dt,
> 102918           @CertExpDt     =  :db-cert-exp-dt,
> 102918           @CertSt        =  :db-cert-state,
> 102918           @KeyWordType   =  :db-key-word-type,
> 102918           @KeyWordValue  =  :db-key-word-value,
> 102918           @RetValue      = :kd-unique-id OUT
> 102918     END-EXEC
> 102918
> 102918     if sqlcode not = 0
> 102918        move sqlcode             to ws-sql-code
> 102918        move ws-sql-code         to ws-dis-sql-code
> 102918        display ' Error: Cannot INSERT row ' kd-unique-id
> 102918        display ' sql return code        ' ws-dis-sql-code
> 102918        display ' sql err mess           ' sqlerrmc
> 102918        set sql-update-failed to true
> 102918     else
> 102918        move kd-unique-id        to la-onbase-unique-id
> 102918                                    obuido
> 102918        set sql-update-succeeded to true
> 102918     end-if
> 102918
> 102918     .
> 102918 1600-exit.
> 102918     exit.
> 102918
> 102918 1610-void-void.
> 102918
> 102918     move la-onbase-unique-id    to kd-unique-id
> 102918     EXEC SQL
> 102918        SELECT
> 102918           RequestDate,
> 102918           KeyWordType,
> 102918           KeyWordValue,
> 102918           CompletionDate
> 102918        INTO
> 102918           :db-req-date,
> 102918           :db-key-word-type,
> 102918           :db-key-word-value,
> 102918           :db-complete-dt  :nu-Complete-date
> 102918        FROM
> 102918           OBKeyWordChgs
> 102918        where
> 102918           :kd-unique-id = UniqueID
> 102918     END-EXEC
> 102918
> 102918     if sqlcode not = 0
> 102918        move sqlcode             to ws-sql-code
> 102918        move ws-sql-code         to ws-dis-sql-code
> 102918        display ' Error: Cannot read row ' kd-unique-id
> 102918        display ' sql return code        ' ws-dis-sql-code
> 102918        display ' sql err mess           ' sqlerrmc
> 102918        go to 1610-exit
> 102918     end-if
> 102918     if nu-complete-date = -1
> 102918        display ' complete date is null '
> 102918     end-if
> 102918     if nu-complete-date = -1  *> isnull
> 102918        and db-key-word-type = 'Status'
> 102918        and obvyni <> 'Y'
> 102918        and db-key-word-value = 'V'
> 102918
> 102918        EXEC SQL
> 102918           DELETE
> 102918              OBKeyWordChgs
> 102918           WHERE
> 102918              UniqueID = :kd-unique-id
> 102918        END-EXEC
> 102918
> 102918        if sqlcode = 0
> 102918           display ' delete succeeded '
> 102918           set sql-update-succeeded to true
> 102918           move zeros            to la-onbase-unique-id
> 102918        else
> 102918           display ' delete not successful ' sqlcode
> 102918           set sql-update-failed to true
> 102918        end-if
> 102918     end-if
> 102918
> 102918     .
> 102918 1610-exit.
> 102918     exit.
> 102918        
> 102918 1620-read-elcert.
> 102918
> 102918     move la-company-cd          to elcert-key
> 102918     move la-carrier-a2          to elcert-carrier
> 102918     move la-grouping-a2         to elcert-grouping
> 102918     move la-state-a2            to elcert-state
> 102918     move la-account-a2          to elcert-account
> 102918     move la-effect-date-a2      to elcert-eff-dt
> 102918     move la-cert-no-a2          to elcert-cert-no
> 102918
> 102918     exec cics read
> 102918        dataset    ('ELCERT')
> 102918        ridfld     (elcert-key)
> 102918        SET        (ADDRESS OF CERTIFICATE-MASTER)                    
> 102918        resp       (w-response)
> 102918     end-exec
> 102918
> 102918     if resp-normal
> 102918        set cert-found to true
> 102918     end-if
> 102918
> 102918     .
> 102918 1620-exit.
> 102918     exit.
> 102918
> 102918 1700-CONNECT-TO-DB.
> 102918
> 102918     move 'NTSQLTST2_PEMA'       to svr
> 102918     move 'sa'                   to usr
> 102918     move 'sql2008r2'            to pass
> 102918
> 102918     if ws-kix-myenv = 'cid1p'
> 102918        move 'NTCSO2_Logic'      to svr
> 102918        move 'sa'                to usr
> 102918        move 'ntcso2'            to pass
> 102918     end-if
> 102918
> 102918     string
> 102918         usr delimited space
> 102918         "." delimited size
> 102918         pass delimited space into usr-pass
> 102918     end-string
> 102918
> 102918     EXEC SQL
> 102918        CONNECT TO :svr USER :usr-pass
> 102918     END-EXEC
> 102918
> 102918     if sqlcode not = 0
> 102918        move sqlcode             to ws-sql-code
> 102918        move ws-sql-code         to ws-dis-sql-code
> 102918        display ' Error: Cannot Connect  ' kd-unique-id
> 102918        display ' sql return code        ' ws-dis-sql-code
> 102918        display ' sql err mess           ' sqlerrmc
> 102918        move er-7332             to emi-error
> 102918        perform 9900-error-format thru 9900-exit
> 102918        go to 8200-send-dataonly
> 102918     end-if
> 102918
> 102918     set connected-to-db to true
> 102918     display ' good connection '
> 102918
> 102918     .
> 102918 1700-EXIT.
> 102918     EXIT.
> 
> 00898  3000-READ-FOR-UPDATE.
1062c1501
< 00921  3100-REWRITE SECTION.
---
> 00921  3100-REWRITE.
1081c1520
< 00940  3200-READ-ARCT-FOR-UPDATE  SECTION.
---
> 00940  3200-READ-ARCT-FOR-UPDATE.
1123c1562
< 00982  3300-REWRITE-ARCT SECTION.
---
> 00982  3300-REWRITE-ARCT.
1134c1573
< 00993  3350-INSERT-ARCT SECTION.
---
> 00993  3350-INSERT-ARCT.
1146c1585
< 01005  4000-ADD-CERT-NOTE  SECTION.
---
> 01005  4000-ADD-CERT-NOTE.
1150c1589,1593
< 01009                                                                   
---
> 102918     move spaces                 to cert-note-records-holder
> 102918                                    ws-build-note-sw
> 102918                                    ws-ercnot-sw
> 102918     move +0                     to c1
> 
1170,1237c1613,1817
< 01029
< 01030
< 01031      EXEC CICS HANDLE CONDITION                                   
< 01032           NOTFND(4010-ENDBR)                                      
< 01033           ENDFILE(4010-ENDBR)                                     
< 01034      END-EXEC.                                                    
< 01035                                                                   
< 01036      EXEC CICS STARTBR                                            
< 01037           DATASET(ERCNOT-FILE-ID)                                 
< 01038           RIDFLD(ERCNOT-KEY)                                      
< 01039           KEYLENGTH(ERCNOT-START-LENGTH)                          
< 01040           GENERIC                                                 
< 01041           GTEQ                                                    
< 01042      END-EXEC.                                                    
< 01043                                                                   
< 01044  4001-LOOP.
< 01045      EXEC CICS READNEXT                                           
< 01046           SET(ADDRESS OF CERT-NOTE-FILE)                          
< 01047           DATASET(ERCNOT-FILE-ID)                                 
< 01048           RIDFLD(ERCNOT-KEY)                                      
< 01049      END-EXEC.                                                    
< 01050                                                                   
< 01051      IF CZ-COMPANY-CD NOT = SV-COMPANY-CD                         
< 01052          GO TO 4010-ENDBR                                         
< 01053      END-IF.                                                      
< 01054                                                                   
< 01055      IF (CZ-CARRIER = SV-CARRIER)                                 
< 01056         AND (CZ-GROUPING = SV-GROUPING)                           
< 01057         AND (CZ-STATE = SV-STATE)                                 
< 01058         AND (CZ-ACCOUNT = SV-ACCOUNT)                             
< 01059         AND (CZ-CERT-EFF-DT = SV-EFF-DT)                          
< 01060         AND (CZ-CERT-NO = SV-CERT-NO)                             
< 01061         AND (CZ-RECORD-TYPE = SV-REC-TYP)                                
< 01062           MOVE CZ-NOTE-SEQUENCE TO SV-NOTE-SEQUENCE
< 01063           GO TO 4001-LOOP                                         
< 01064      END-IF.        
< 01065                                         
< 01066  4010-ENDBR.                                                      
< 01067                                                                   
< 01068      EXEC CICS ENDBR                                              
< 01069           DATASET(ERCNOT-FILE-ID)                                 
< 01070      END-EXEC.                                                    
< 01071      
< 01072      MOVE SV-PRIOR-KEY           TO  ERCNOT-KEY.
< 01073      MOVE SPACES                 TO  CERT-NOTE-FILE.              
< 01074      ADD 1                       TO  ERCNOT-SEQ.                  
< 01075      MOVE ERCNOT-KEY             TO  CZ-CONTROL-PRIMARY.          
< 01076      MOVE  'CZ'                  TO  CZ-RECORD-ID.                
< 01077      MOVE W-CERT-NOTE-MSG        TO  CZ-NOTE.                     
< 01078      MOVE PI-PROCESSOR-ID        TO  CZ-LAST-MAINT-USER. 
< 01079      MOVE W-SAVE-BIN-DATE        TO  CZ-LAST-MAINT-DT.
< 01080      MOVE EIBTIME                TO  CZ-LAST-MAINT-HHMMSS.
< 01081                                                                   
< 01082      EXEC CICS WRITE                                              
< 01083           DATASET(ERCNOT-FILE-ID)                                 
< 01084           FROM(CERT-NOTE-FILE)                                    
< 01085           RIDFLD(ERCNOT-KEY)                                      
< 01086           RESP(W-RESPONSE)                                       
< 01087      END-EXEC.                                                    
< 01088
< 01089      IF RESP-NORMAL
< 01090          PERFORM 4800-CERTIFICATE-UPDATE THRU 4899-EXIT
< 01091      END-IF.
< 01092  
< 01093  4099-EXIT.
< 01094      EXIT.
< 01095      
< 122612
---
> 
> 
> 102918     EXEC CICS STARTBR
> 102918        DATASET    ('ERCNOT')
> 102918        RIDFLD     (ercnot-key)
> 102918        GTEQ
> 102918        RESP       (W-RESPONSE)
> 102918     END-EXEC
> 102918
> 102918     IF RESP-NORMAL
> 102918        set ercnot-startbr to true
> 102918*       display ' resp normal startbr '
> 102918        perform until finished-with-notes
> 102918           EXEC CICS READNEXT
> 102918              DATASET    ('ERCNOT')
> 102918              RIDFLD     (ercnot-key)
> 102918              INTO       (cert-note-file)
> 102918              resp       (w-response)
> 102918           end-exec
> 102918           if (resp-normal)
> 102918              and (cz-control-primary (1:33) =
> 102918                 sv-prior-key (1:33))
> 102918              if cz-record-type = '1'
> 102918                 add +1 to c1
> 102918                 move cert-note-file
> 102918                                 to cert-note-record (c1)
> 102918              end-if
> 102918           else
> 102918              set finished-with-notes to true
> 102918           end-if
> 102918        end-perform
> 102918     end-if
> 102918
> 102918     if ercnot-startbr                        
> 102918*       display ' about to endbr ercnot '     
> 102918        exec cics endbr                       
> 102918           dataset    ('ERCNOT')              
> 102918        end-exec                              
> 102918     end-if                                   
> 102918     move c1                     to note-count
> 102918
> 102918     if c1 = +0
> 102918        perform 4100-add-note    thru 4100-exit
> 102918     else
> 102918        perform 4120-delete-cert-notes
> 102918                                 thru 4120-exit
> 102918        if resp-normal
> 102918           perform 4100-add-note thru 4100-exit
> 102918           if resp-normal
> 102918              perform 4140-put-back-cert-notes
> 102918                                 thru 4140-exit
> 102918              if resp-normal
> 102918                 display 'NOTE SUCCESSFULLY ADDED'
> 102918              else
> 102918                 display ' something wrong with put back '
> 102918              end-if
> 102918           else
> 102918              display ' something went wrong with adding note '
> 102918           end-if
> 102918        else
> 102918           display ' something went wrong with generic delete '
> 102918        end-if
> 102918     end-if
> 102918
> 102918     .
> 102918 4099-EXIT.
> 102918     EXIT.
> 102918
> 102918
> 102918 4100-add-note.
> 102918
> 102918***  Need to check how long the note is
> 102918
> 102918     if w-comment-line-cnt = +0
> 102918        go to 4100-exit
> 102918     end-if
> 102918
> 102918     move 'CZ'                to cert-note-file
> 102918     move sv-prior-key        to cz-control-primary
> 102918     move '1'                 to cz-record-type
> 102918     move +1                  to cz-note-sequence
> 102918     move w-save-bin-date     to cz-last-maint-dt
> 102918     move eibtime             to cz-last-maint-hhmmss
> 102918     move pi-processor-id     to cz-last-maint-user
> 102918     move w-comment-line-1    to cz-note
> 102918
> 102918     .
> 102918 4100-write.
> 102918
> 102918     exec cics write
> 102918        dataset   ('ERCNOT')
> 102918        from      (cert-note-file)
> 102918        ridfld    (cz-control-primary)
> 102918        resp      (w-response)
> 102918     end-exec
> 102918     if not resp-normal
> 102918        display ' error-ercnot-write ' w-response ' '
> 102918           cz-control-primary (2:33)
> 102918        go to 4100-exit
> 102918     else
> 102918        display 'NOTE SUCCESSFULLY ADDED'
> 102918     end-if
> 102918
> 102918     if w-comment-line-cnt > +1
> 102918        move w-comment-line-2    to cz-note
> 102918        add +1 to cz-note-sequence
> 102918        move +0                  to w-comment-line-cnt
> 102918        go to 4100-write
> 102918     end-if
> 102918
> 102918     .
> 102918 4100-exit.
> 102918     exit.
> 102918
> 102918
> 102918
> 102918 4120-delete-cert-notes.
> 102918 
> 102918     move sv-prior-key (1:33)    to ercnot-key
> 102918     move '1'                    to ercnot-rec-typ
> 102918     move +0                     to ercnot-seq
> 102918     exec cics delete
> 102918        dataset    ('ERCNOT')
> 102918        keylength  (ws-cert-note-generic-key-len)
> 102918        ridfld     (ercnot-key (1:34))
> 102918        generic
> 102918        resp       (w-response)
> 102918     end-exec
> 102918 
> 102918     .
> 102918 4120-exit.
> 102918     exit.
> 102918
> 102918 4140-put-back-cert-notes.
> 102918
> 102918     perform varying c1 from +1 by +1 until
> 102918        c1 > note-count
> 102918        move cert-note-record (c1)
> 102918                                 to cert-note-file
> 102918        add +2                   to cz-note-sequence
> 102918*       display ' about to write ' cz-control-primary (2:19) ' '
> 102918*          cz-control-primary (23:11) ' ' cz-note-sequence ' '
> 102918*           cz-record-type ' ' cz-note-information
> 102918        exec cics write
> 102918           dataset ('ERCNOT')
> 102918           FROM    (cert-note-file)
> 102918           ridfld  (cz-control-primary)
> 102918           resp    (w-response)
> 102918        end-exec
> 102918        if not resp-normal
> 102918           display ' error-ercnot-write subsequ ' w-response ' '
> 102918              cz-control-primary (2:33)
> 102918           move +999             to c1
> 102918        end-if
> 102918     end-perform
> 102918
> 102918    .
> 102918 4140-exit.
> 102918     exit.
> 102918
> 102918 4160-check-comment.
> 102918
> 102918     string
> 102918        w-cert-note-comment ' ' delimited by '  '
> 102918        la-form-a3 ' ' delimited by size
> 102918        la-processor-cd ' ' delimited by size
> 102918        pi-create-date delimited by size
> 102918           into w-stop-letter-comment
> 102918     end-string
> 102918
> 102918     perform varying n1 from +126 by -1 until
> 102918        w-stop-letter-comment(n1:1) <> space
> 102918     end-perform
> 102918     if n1 < +64
> 102918        move +1                  to w-comment-line-cnt
> 102918        move w-stop-letter-comment
> 102918                                 to w-comment-line-1
> 102918        go to 4160-exit
> 102918     end-if
> 102918
> 102918     move +2                     to w-comment-line-cnt
> 102918
> 102918     perform varying n1 from n1 by -1 until
> 102918        ((w-stop-letter-comment(n1:1) = ' ')
> 102918            and
> 102918         (n1 < +64))
> 102918        or (n1 < +1)
> 102918     end-perform
> 102918
> 102918     if n1 < +1
> 102918        move w-stop-letter-comment(1:63)
> 102918                                 to w-comment-line-1
> 102918        move w-stop-letter-comment(64:63)
> 102918                                 to w-comment-line-2
> 102918     else
> 102918        move w-stop-letter-comment(1:n1)
> 102918                                 to w-comment-line-1
> 102918        move w-stop-letter-comment(n1 + 1:126 - n1)
> 102918                                 to w-comment-line-2
> 102918     end-if
> 102918
> 102918     .
> 102918 4160-exit.
> 102918     exit.
> 

</pre>
<h3><a name="EL691S.bms">EL691S.bms</a><br><a href="#topper">Back to Top</a><br><pre>

80a81
> 
87a89,90
>          DFHMDF POS=(08,61),LENGTH=001,ATTRB=(ASKIP,DRK),INITIAL=' '    00134
> 
96c99,100
<          DFHMDF POS=(09,66),LENGTH=001,ATTRB=(ASKIP,NORM)               00093
---
>          DFHMDF POS=(09,65),LENGTH=001,ATTRB=(ASKIP,NORM)               00093
> 
100a105
> 
105a111
> 
106a113
> 
109a117
> 
116a125
> 
120a130
>          DFHMDF POS=(15,31),LENGTH=001,ATTRB=(ASKIP,DRK),INITIAL=' '    00134
123a134
> 
127a139
>          DFHMDF POS=(16,31),LENGTH=001,ATTRB=(ASKIP,DRK),INITIAL=' '    00134
130c142,146
<          DFHMDF POS=(16,55),LENGTH=001,ATTRB=(ASKIP,DRK),INITIAL=' '    00127
---
>          DFHMDF POS=(16,55),LENGTH=021,ATTRB=(ASKIP,NORM),             -
>                INITIAL='  ONBASE VOID Y OR N:'
> OBVYN    DFHMDF POS=(16,77),LENGTH=001,ATTRB=(UNPROT,NORM)
>          DFHMDF POS=(16,79),LENGTH=001,ATTRB=(ASKIP,DRK),INITIAL=' '    00134
> 
134a151
>          DFHMDF POS=(17,31),LENGTH=001,ATTRB=(ASKIP,DRK),INITIAL=' '    00134
137a155,159
>          DFHMDF POS=(17,57),LENGTH=010,ATTRB=(ASKIP,NORM),             -
>                INITIAL='UNIQUE ID:'
> OBUID    DFHMDF POS=(17,68),LENGTH=005,ATTRB=(ASKIP,NORM)              -
>                PICOUT='ZZZ99'
> 

</pre>
<h3><a name="ERCARCH">ERCARCH</a><br><a href="#topper">Back to Top</a><br><pre>

30a31
> 102918* 102918  CR2018080300002  PEMA  ADD ONBASE STUFF
126c127,129
<                16  FILLER                  PIC  X(08).
---
> 102918         16  LA-VOID-ONBASE-YN       PIC  X.
> 102918         16  LA-ONBASE-UNIQUE-ID     PIC S9(5) COMP-3.
> 102918         16  FILLER                  PIC  X(04).

</pre>
</body></html>