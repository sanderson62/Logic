<html>
<head>
<title>Compare Module List</title>
</head>
<body style="background-color:PowderBlue;"><div align="center"><h2>Compares for CC-7074-PEMA.ini</h2>
<h3>Processed on - 02/05/2019</h3></div>
<a name="topper"></a>
<a href="#inifile">INI File</a><br>
<a href="#WSMESS01.cl2">WSMESS01.cl2</a><br>
<a href="#WSMESS02.cl2">WSMESS02.cl2</a><br>
<a href="#WSMESS03.cl2">WSMESS03.cl2</a><br>
<a href="#SOCK08.cl2">SOCK08.cl2</a><br>
<h3>INI FILE As submitted by programmer, followed by log information <h3>
<pre>

[2017020300002]
[/apps/test/cid1s/jcl/daily_jobs/;/apps/prod/cid1p/jcl/daily_jobs/]
[/apps/test/cid1s/jcl/monthly_jobs/;/apps/prod/cid1p/jcl/monthly_jobs/]
[/apps/test/cid1s/jcl/quarterly_jobs/;/apps/prod/cid1p/jcl/quarterly_jobs/]
[/apps/test/cid1s/jcl/yearly_jobs/;/apps/prod/cid1p/jcl/yearly_jobs/]
[/export/home/pema/bin/;/export/home/mtpadmin/bin/]
[/data/test/seqfiles/;/data/seqfiles/]
[/apps/test/cid1s/sys/webroot/;/apps/prod/cid1p/sys/webroot/]
[/apps/test/cid1s/sys/webroot/balancesheet/;/apps/prod/cid1p/sys/webroot/balancesheet/]
[/apps/test/cid1s/sys/webroot/balancesheet/images/;/apps/prod/cid1p/sys/webroot/balancesheet/images/]
[/apps/test/cid1s/sys/webroot/balancesheet/javascript/;/apps/prod/cid1p/sys/webroot/balancesheet/javascript/]
[/apps/test/cid1s/sys/webroot/balancesheet/style/;/apps/prod/cid1p/sys/webroot/balancesheet/style/]
[/apps/test/cid1s/maps/;/apps/prod/cid1p/maps/]
[/apps/test/cid1s/copy/;/apps/prod/cid1p/copy/]
[/apps/test/cid1s/emails/;/apps/prod/cid1p/emails/]
[/apps/test/cid1s/parmlib/;/apps/prod/cid1p/parmlib/]
[/apps/test/cid1s/src/batch/;/apps/prod/cid1p/src/batch/]
[/apps/test/cid1s/src/online/;/apps/prod/cid1p/src/online/]
WSMESS01.cl2=
WSMESS01.cbl=
WSMESS01.lst=
WSMESS02.cl2=
WSMESS02.cbl=
WSMESS02.lst=
WSMESS03.cl2=New
WSMESS03.cbl=New
WSMESS03.lst=New
SOCK08.cl2=
SOCK08.cbl=
SOCK08.lst=
[/apps/test/cid1s/exe/bat/;/apps/prod/cid1p/staging/exe_bat/]
[/apps/test/cid1s/exe/onl/;/apps/prod/cid1p/staging/exe_onl/]
WSMESS01.gnt=
WSMESS02.gnt=
WSMESS03.gnt=New
SOCK08.gnt=
Archive Process Successfull using - perl /export/home/mtpadmin/bin/mtp_archive.pl CC-7074-PEMA.ini
Move Process Successfull using - perl /export/home/mtpadmin/bin/mtp_move.pl CC-7074-PEMA.ini
Promote process successfull and verified using - perl /export/home/mtpadmin/bin/mtp_verify.pl CC-7074-PEMA.ini
Archived module - /apps/prod/cid1p/src/online/archive/WSMESS01.cl2.20190205
Archived module - /apps/prod/cid1p/src/online/archive/WSMESS01.cbl.20190205
Archived module - /apps/prod/cid1p/src/online/archive/WSMESS01.lst.20190205
Archived module - /apps/prod/cid1p/src/online/archive/WSMESS02.cl2.20190205
Archived module - /apps/prod/cid1p/src/online/archive/WSMESS02.cbl.20190205
Archived module - /apps/prod/cid1p/src/online/archive/WSMESS02.lst.20190205
Archived module - /apps/prod/cid1p/src/online/archive/SOCK08.cl2.20190205
Archived module - /apps/prod/cid1p/src/online/archive/SOCK08.cbl.20190205
Archived module - /apps/prod/cid1p/src/online/archive/SOCK08.lst.20190205
Archived module - /apps/prod/cid1p/exe/onl/archive/WSMESS01.gnt.20190205
Archived module - /apps/prod/cid1p/exe/onl/archive/WSMESS02.gnt.20190205
Archived module - /apps/prod/cid1p/exe/onl/archive/SOCK08.gnt.20190205
moved module - /apps/prod/cid1p/src/online/WSMESS01.cl2
moved module - /apps/prod/cid1p/src/online/WSMESS01.cbl
moved module - /apps/prod/cid1p/src/online/WSMESS01.lst
moved module - /apps/prod/cid1p/src/online/WSMESS02.cl2
moved module - /apps/prod/cid1p/src/online/WSMESS02.cbl
moved module - /apps/prod/cid1p/src/online/WSMESS02.lst
moved module - /apps/prod/cid1p/src/online/WSMESS03.cl2
moved module - /apps/prod/cid1p/src/online/WSMESS03.cbl
moved module - /apps/prod/cid1p/src/online/WSMESS03.lst
moved module - /apps/prod/cid1p/src/online/SOCK08.cl2
moved module - /apps/prod/cid1p/src/online/SOCK08.cbl
moved module - /apps/prod/cid1p/src/online/SOCK08.lst
moved module - /apps/prod/cid1p/staging/exe_onl/WSMESS01.gnt
moved module - /apps/prod/cid1p/staging/exe_onl/WSMESS02.gnt
moved module - /apps/prod/cid1p/staging/exe_onl/WSMESS03.gnt
moved module - /apps/prod/cid1p/staging/exe_onl/SOCK08.gnt

</pre>
<h3><a name="SOCK08.cl2">SOCK08.cl2</a><br><a href="#topper">Back to Top</a><br><pre>

27a28
> 100917* 100917   2017020300002   PEMA  Add message003
38c39
<        77 ws-send-msg-size             pic s9(8) comp value 256.
---
> 100917 77 ws-send-msg-size             pic s9(8) comp value 512.
41c42
<        77 ws-send-buf                  pic x(256) VALUE SPACES.
---
> 100917 77 ws-send-buf                  pic x(512) VALUE SPACES.
248a250,251
> 100917 01  ws-mess003-length           pic s9(4) comp value +1024.
> 100917 01  WS-MESS003-PASS-AREA        PIC X(1024).
275,278c278,281
<            display 'SOCK08:transaction data =', CLIENT-IN-DATA '**'
<            display 'SOCK08:socket number    =', GIVE-TAKE-SOCKET.
<            display 'SOCK08:socket name      =', lstn-name ' '
<               lstn-subname
---
>       *    display 'SOCK08:transaction data =', CLIENT-IN-DATA '**'
>       *    display 'SOCK08:socket number    =', GIVE-TAKE-SOCKET.
>       *    display 'SOCK08:socket name      =', lstn-name ' '
>       *       lstn-subname
301,304d303
<            display ' current date/time '
<               ws-fn-mo '/' ws-fn-da '/' ws-fn-ccyy ' - '
<                  ws-fn-hours ':' ws-fn-minutes ':' ws-fn-seconds
< 
356,358d354
<            display 'SOCK08:sequence number  =', ws-seq-num.
<            display 'SOCK08:send buffer      =', ws-send-buf(1:25)
< 
392a389,393
> 100917        when 'message003'
> 100917           perform 3000-link-mess003
> 100917                                 thru 3000-exit
> 100917           move ws-mess003-pass-area
> 100917                                 to ws-return-string
407c408
<            display 'SOCK08:About to recv '
---
> 100917     move spaces                 to ws-recv-buf
428,432c429
<            display 'SOCK08:Good recv  '
<            display 'SOCK08:return code      = ', return-code
<            display 'SOCK08:receive buffer   = ', ws-recv-buf(1:51)
< 
< 021516     move +256                   to ws-send-msg-size
---
> 100917     move +512                   to ws-send-msg-size
447,449d443
<            display 'SOCK08:About to send      ' ws-send-buf
<            display 'SOCK08:sequence number  =', ws-seq-num.
<            display ' msg size ' ws-send-msg-size
481d474
<            display 'SOCK08:done'
515a509,522
> 
> 100917 3000-link-mess003.
> 100917
> 100917     move soc-client-in-data     to ws-mess003-pass-area
> 100917
> 100917     EXEC CICS LINK
> 100917          PROGRAM  ('WSMESS03')
> 100917          COMMAREA (WS-MESS003-PASS-AREA)
> 100917          LENGTH   (ws-mess003-length)
> 100917     END-EXEC.
> 100917
> 100917     .
> 100917 3000-exit.
> 100917     exit.

</pre>
<h3><a name="WSMESS01.cl2">WSMESS01.cl2</a><br><a href="#topper">Back to Top</a><br><pre>

28a29
> 080817* 080817   2017020300002   PEMA  Limit and ben code assign changes.
86a88,92
> 080817 77  ws-error-sub                pic 999  value zeros.
> 080817 77  ws-error-sup                pic x(25) value spaces.
> 080817 77  ws-form-limit-name          pic x(50) value spaces.
> 080817 77  l1                          pic s999 comp-3 value +0.
> 080817 77  ws-extension-days           pic 999 value zeros.
204a211,233
> 080817 01  ws-limit-issue-age          pic 999.
> 080817 01  ws-att-age                  pic 999.
> 080817 01  form-limit-table.
> 080817     05  ws-limit-name           pic x(50).
> 080817     05  ws-limit-cov-type       pic xx.
> 080817     05  ws-limit-lo-age         pic 999.
> 080817     05  ws-limit-hi-age         pic 999.
> 080817     05  ws-limit-att-age        pic 999.
> 080817     05  ws-limit-max-term       pic 999.
> 080817     05  ws-limit-max-jnt-term   pic 999.
> 080817     05  ws-limit-max-mo-ben     pic 9(5).
> 080817     05  ws-limit-max-tot-ben    pic 9(7).
> 080817
> 080817 01  state-benefit-code-table.
> 080817     05  ws-sbc-state            pic xx.
> 080817     05  ws-sbc-cov-type         pic xx.
> 080817     05  ws-sbc-sin-jnt          pic x.
> 080817     05  ws-sbc-dismember        pic x.
> 080817     05  ws-sbc-retroelim        pic x.
> 080817     05  ws-sbc-wait-days        pic 999.
> 080817     05  ws-sbc-max-bens         pic 999.
> 080817     05  ws-sbc-logic-ben-code   pic xx.
> 
209,240d237
<        01  ws-TX-lf-benefit-code-table.
<            05  ws-tx-lf-table.
<                10  filler              pic x(5) value 'GSN01'.
< 
<                10  filler              pic x(5) value 'GJN03'.
< 
<            05  filler redefines ws-tx-lf-table occurs 02.
<                10  ws-fl-lf-ben-type   pic x.
<                10  ws-fl-lf-sin-jnt    pic x.
<                10  ws-fl-lf-dismemb    pic x.
<                10  ws-fl-lf-ben-code   pic xx.
< 
<        01  ws-TX-ah-benefit-code-table.
<            05  ws-tx-ah-table.
<                10  filler              pic x(8) value 'ASYR1401'.
<                10  filler              pic x(8) value 'ASYR3004'.
<                10  filler              pic x(8) value 'ASYE1405'.
<                10  filler              pic x(8) value 'ASYE3002'.
< 
<                10  filler              pic x(8) value 'AJYR1454'.
<                10  filler              pic x(8) value 'AJYR3055'.
<                10  filler              pic x(8) value 'AJYE1456'.
<                10  filler              pic x(8) value 'AJYE3057'.
< 
<            05  filler redefines ws-tx-ah-table occurs 08.
<                10  ws-fl-ah-ben-type   pic x.
<                10  ws-fl-ah-sin-jnt    pic x.
<                10  ws-fl-ah-fullterm   pic x.
<                10  ws-fl-ah-ret-elim   pic x.
<                10  ws-fl-ah-elim-days  pic xx.
<                10  ws-fl-ah-ben-code   pic xx.
< 
370,405c367,408
<            05  ws-errors-table.
<                10  filler              pic x(50) value
<                '0000Transaction successfully completed'.
<                10  filler              pic x(50) value
<                '0101Problem with amounts'.
<                10  filler              pic x(50) value
<                '0102Problem with dates'.
<                10  filler              pic x(50) value
<                '0103Issue age outside limits'.
<                10  filler              pic x(50) value
<                '0104Attained age outside limits'.
<                10  filler              pic x(50) value
<                '0105Term is not valid must be gt 0 and lt 361'.
<                10  filler              pic x(50) value
<                '0106Term is outside limits'.
<                10  filler              pic x(50) value
<                '0107Amount is outside limits'.
<                10  filler              pic x(50) value
<                '0108Loan term must be ge insurance term'.
<                10  filler              pic x(50) value
<                '0109Total benefit is outside limits'.
<                10  filler              pic x(50) value
<                '0110Rates found were zero'.
<                10  filler              pic x(50) value
<                '0111Rate table was not found'.
<                10  filler              pic x(50) value
<                '0112Rate file not open'.
<                10  filler              pic x(50) value
<                '0113Premium is out of tolerence'.
<                10  filler              pic x(50) value
<                '0114Duplicate contract and VIN on Logic'.
<                10  filler              pic x(50) value
<                '0115Problem with loan or insurance term'.
< 071017         10  filler              pic x(50) value
< 071017         '0116Total of payments incorrect '.
< 071017     05  filler redefines ws-errors-table occurs 17.
---
>            05  ws-errors-table.                                           
>                10  filler              pic x(50) value                    
>                '0000Transaction successfully completed'.                  
>                10  filler              pic x(50) value                    
>                '0101Problem with amounts'.                                
>                10  filler              pic x(50) value                    
>                '0102Problem with dates'.                                  
>                10  filler              pic x(50) value                    
>                '0103Issue age outside limits'.                            
>                10  filler              pic x(50) value                    
>                '0104Attained age outside limits'.                         
>                10  filler              pic x(50) value                    
>                '0105Term is not valid must be gt 0 and lt 361'.           
>                10  filler              pic x(50) value                    
>                '0106Term is outside limits'.                              
>                10  filler              pic x(50) value                    
>                '0107Amount is outside limits'.                            
>                10  filler              pic x(50) value                    
>                '0108Loan term must be ge insurance term'.                 
>                10  filler              pic x(50) value                    
>                '0109Total benefit is outside limits'.                     
>                10  filler              pic x(50) value                    
>                '0110Rates found were zero'.                               
>                10  filler              pic x(50) value                    
>                '0111Rate table was not found'.                            
>                10  filler              pic x(50) value                    
>                '0112Rate file not open'.                                  
>                10  filler              pic x(50) value                    
>                '0113Premium is out of tolerence'.                         
>                10  filler              pic x(50) value                    
>                '0114Duplicate contract and VIN on Logic'.                 
>                10  filler              pic x(50) value                    
>                '0115Problem with loan or insurance term'.                 
> 071017         10  filler              pic x(50) value                    
> 071017         '0116Total of payments incorrect '.                        
> 080817         10  filler              pic x(50) value                    
> 080817         '0117No Limits or age outside limits'.                     
> 080817         10  filler              pic x(50) value                    
> 080817         '0118Life benefit code not found '.                        
> 080817         10  filler              pic x(50) value                    
> 080817         '0119Disab benefit code not found '.                       
> 071017     05  filler redefines ws-errors-table occurs 20.
460,461c463,464
<            perform 0100-process-message
<                                        thru 0100-exit
---
>            perform 0010-process-message
>                                        thru 0010-exit
482,485d484
<            display ' current date/time '
<               ws-fn-mo '/' ws-fn-da '/' ws-fn-ccyy ' - '
<                  ws-fn-hours ':' ws-fn-minutes ':' ws-fn-seconds
< 
512d510
<                  move '0113;Invalid company id ' to ws-return-string
513a512,515
>                  move 18               to ws-error-sub
>                  move client-id        to ws-error-sup
>                  perform 0180-error-handle
>                                        thru 0180-exit
515a518,525
> 080817     move spaces                 to ws-return-string
> 080817     move ';'                    to ws-sc1
> 080817                                    ws-sc2
> 080817                                    ws-sc3
> 080817                                    ws-sc4
> 080817                                    ws-sc5
> 080817                                    ws-sc6
> 080817                                    ws-sc7
520a531,566
>        0010-process-message.
> 
>            perform 0110-unstring       thru 0110-exit
>            perform 0120-format-message thru 0120-exit
> 
>            perform 0020-edit-received  thru 0020-exit
>            perform 0025-assign-ben-cd  thru 0025-exit
> 
>            perform 0050-get-account    thru 0050-exit
>            if ws-rate-lf-ah = 'L'
>               perform 0090-check-qc-lf-limits
>                                        thru 0090-exit
>            else
>               perform 0095-check-qc-ah-limits
>                                        thru 0095-exit
>            end-if                                       
> 
>            perform 0030-get-rate       thru 0030-exit
>            if (contract-no-assigned)
>                   or
>               (error-in-one-coverage)
>               continue
>            else
>               perform 0060-check-for-dup
>                                        thru 0060-exit
>               perform 0070-open-cursor thru 0070-exit
>               perform 0080-process-input
>                                        thru 0080-exit
>            end-if
>            perform 0040-format-buffer  thru 0040-exit
>            set contract-no-assigned to true
> 
>            .
>        0010-exit.
>            exit.
> 
570c616,619
<               move '0102;Problem with Eff Date' to ws-return-string
---
>               move 3                   to ws-error-sub
>               move '- Eff Date'        to ws-error-sup
>               perform 0180-error-handle
>                                        thru 0180-exit
575c624,627
<               move '0102;Future Effective Date' to ws-return-string
---
>               move 3                   to ws-error-sub
>               move '- Future Eff'      to ws-error-sup
>               perform 0180-error-handle
>                                        thru 0180-exit
598,599c650,653
<               move '0102;Problem with 1st pmt Date'
<                                        to ws-return-string
---
>               move 3                   to ws-error-sub
>               move '- 1st Pmt Dt'      to ws-error-sup
>               perform 0180-error-handle
>                                        thru 0180-exit
605,606c659,662
<               move '0102;1st Pmt Date not > Eff Dt '
<                                        to ws-return-string
---
>               move 3                   to ws-error-sub
>               move '- 1st Pmt !> Eff dt' to ws-error-sup
>               perform 0180-error-handle
>                                        thru 0180-exit
625,626c681,684
<                  move '0102;Problem with 1st pmt Date'
<                                        to ws-return-string
---
>                  move 3                to ws-error-sub
>                  move '- 1st Pmt Dt'   to ws-error-sup
>                  perform 0180-error-handle
>                                        thru 0180-exit
646,647c704,707
<               move '0102;Problem with calculating exp date'
<                                     to ws-return-string
---
>               move 3                   to ws-error-sub
>               move '- Expire Dt'       to ws-error-sup
>               perform 0180-error-handle
>                                        thru 0180-exit
669,670c729,732
<               move '0102;Problem with Pri Birth Date'
<                                        to ws-return-string
---
>               move 3                   to ws-error-sub
>               move '- Pri DOB '        to ws-error-sup
>               perform 0180-error-handle
>                                        thru 0180-exit
697,698c759,762
<                  move '0102;Problem with Cob Birth Date'
<                                        to ws-return-string
---
>                  move 3                to ws-error-sub
>                  move '- Cob DOB '     to ws-error-sup
>                  perform 0180-error-handle
>                                        thru 0180-exit
715d778
<               display ' issue age = 'ws-issue-age
717,718c780,783
<               move '0102;Problem with Pri Age calculation'
<                                        to ws-return-string
---
>               move 3                   to ws-error-sub
>               move '- Pri DOB '        to ws-error-sup
>               perform 0180-error-handle
>                                        thru 0180-exit
736d800
<                  display ' cob   age = 'ws-cob-age
738,739c802,805
<                  move '0102;Problem with Cob Age calculation'
<                                        to ws-return-string
---
>                  move 3                to ws-error-sub
>                  move '- Cob DOB '     to ws-error-sup
>                  perform 0180-error-handle
>                                        thru 0180-exit
746,747d811
<               display ' Using Co borrower age ' ws-issue-age
<                  ' ' ws-cob-age
753c817
<       **  Validate passed total of payments. loan term * payment      **
---
>       **  Calculate extension days.                                   **
757,759c821,837
< 080117*    if ws-rate-lf-ah = 'A'
< 080117*       GO TO 0020-EXIT
< 080117*    END-IF
---
>            move zeros                  to ws-extension-days
>            move ws-bin-eff-dt          to dc-bin-date-1
>            move ws-bin-1st-pmt-dt      to dc-bin-date-2
>            move '1'                    to dc-option-code
>            perform 9700-date-link      thru 9700-exit
>            if no-conversion-error
>               if dc-elapsed-days > 31
>                  compute ws-extension-days =
>                     dc-elapsed-days - 30
>               end-if
>            end-if
> 
>       **==============================================================**
>       **                                                              **
>       **  Validate passed total of payments. loan term * payment      **
>       **                                                              **
>       **==============================================================**
764,773c842,850
<            display '    my tot pmts ' ws-calc-tot-pmts
<            display ' their tot pmts ' ws-rate-tot-pmts
< 
< 080117     if ((ws-calc-tot-pmts - ws-rate-tot-pmts) > 1.00)
< 080117                     or
< 080117        ((ws-rate-tot-pmts - ws-calc-tot-pmts) > 1.00)
< 080117*    if ws-calc-tot-pmts <> ws-rate-tot-pmts
<                move '0116;Total of payments incorrect '
<                                        to ws-return-string
<                go to 0300-RETURN-CICS
---
>            if ((ws-calc-tot-pmts - ws-rate-tot-pmts) > 1.00)
>                            or
>               ((ws-rate-tot-pmts - ws-calc-tot-pmts) > 1.00)
>       *    if ws-calc-tot-pmts <> ws-rate-tot-pmts
>               move 17                  to ws-error-sub
>               move spaces              to ws-error-sup
>               perform 0180-error-handle
>                                        thru 0180-exit
>               go to 0300-RETURN-CICS
782,839c859,967
<       **==============================================================**
<       **                                                              **
<       **     Eventually, depending on how well this project takes off **
<       **  we should figure out a much better way to assign benefit    **
<       **  codes. For now since we only have 1 or 2 accounts in TX it  **
<       **  will be hard coded.                                         **
<       **                                                              **
<       **==============================================================**
< 
<            if ws-rate-benefit-type = 'L'
<               if ws-rate-sin-jnt-ind = 'S'
<                  move '01'             to ws-rate-benefit-cd
<               else
<                  move '03'             to ws-rate-benefit-cd
<               end-if
<            else
<               if ws-rate-sin-jnt-ind = 'J'
<                  if ws-rate-retro-elim = 'R'
<                     if ws-rate-waiting-days = 14
<                        move '54'       to ws-rate-benefit-cd
<                     else
<                        if ws-rate-waiting-days = 30
<                           move '55'    to ws-rate-benefit-cd
<                        end-if
<                     end-if
<                  else
<                     if ws-rate-retro-elim = 'E'
<                        if ws-rate-waiting-days = 14
<                           move '56'    to ws-rate-benefit-cd
<                        else
<                           if ws-rate-waiting-days = 30
<                              move '57' to ws-rate-benefit-cd
<                           end-if
<                        end-if
<                     end-if
<                  end-if
<               else
<                  if ws-rate-retro-elim = 'R'
<                     if ws-rate-waiting-days = 14
<                        move '01'       to ws-rate-benefit-cd
<                     else
<                        if ws-rate-waiting-days = 30
<                           move '04'    to ws-rate-benefit-cd
<                        end-if
<                     end-if
<                  else
<                     if ws-rate-retro-elim = 'E'
<                        if ws-rate-waiting-days = 14
<                           move '05'    to ws-rate-benefit-cd
<                        else
<                           if ws-rate-waiting-days = 30
<                              move '02' to ws-rate-benefit-cd
<                           end-if
<                        end-if
<                     end-if
<                  end-if
<               end-if
<            end-if
---
> 080817     if not connected-to-db
> 080817        perform 6000-connect-to-db thru 6000-exit
> 080817     end-if
> 080817
> 080817     if ws-rate-benefit-type = 'A'
> 080817        go to 0025-get-ah-ben
> 080817     end-if
> 080817
> 080817     move ws-rate-state          to ws-sbc-state
> 080817     evaluate true
> 080817        when raw-ben-code (1:1) = 'N'
> 080817           move 'NP'             to ws-sbc-cov-type
> 080817        when raw-ben-code (1:1) = 'T'
> 080817           move 'NT'             to ws-sbc-cov-type
> 080817        when raw-ben-code (1:1) = 'L'
> 080817           move 'LL'             to ws-sbc-cov-type
> 080817        when other
> 080817           move 'GP'             to ws-sbc-cov-type
> 080817     end-evaluate
> 080817
> 080817     move ws-rate-sin-jnt-ind    to ws-sbc-sin-jnt
> 080817     move ws-rate-dismemberment  to ws-sbc-dismember
> 080817
> 080817     EXEC SQL
> 080817        SELECT
> 080817           LogicBenCode
> 080817        INTO
> 080817           :ws-sbc-logic-ben-code
> 080817        FROM
> 080817           BenefitCodeMapping
> 080817        WHERE
> 080817           State           = :ws-sbc-state
> 080817           and CovType     = :ws-sbc-cov-type
> 080817           and SinJnt      = :ws-sbc-sin-jnt
> 080817           and Dismem      = :ws-sbc-dismember
> 080817     end-exec
> 080817
> 080817     if sqlcode not = 0
> 080817        display "Error: cannot find lf benefit code "
> 080817           ws-sbc-state ' ' ws-sbc-cov-type ' ' ws-sbc-sin-jnt
> 080817           ' ' ws-sbc-dismember
> 080817        display ' sql return code ' sqlcode
> 080817        display ' sql err mess    ' sqlerrmc
> 080817        move 19                  to ws-error-sub
> 080817        move spaces              to ws-error-sup
> 080817        string
> 080817           ws-sbc-state ' '
> 080817           ws-sbc-cov-type ' '
> 080817           ws-sbc-sin-jnt ' '
> 080817           ws-sbc-dismember
> 080817           delimited by size into ws-error-sup
> 080817        perform 0180-error-handle
> 080817                                 thru 0180-exit
> 080817        go to 0300-return-cics
> 080817     end-if
> 080817
> 080817     move ws-sbc-logic-ben-code  to ws-rate-benefit-cd
> 080817     go to 0025-exit
> 080817
> 080817     .
> 080817 0025-get-ah-ben.
> 080817
> 080817     move ws-rate-state          to ws-sbc-state
> 080817     move 'DI'                   to ws-sbc-cov-type
> 080817     move ws-rate-sin-jnt-ind    to ws-sbc-sin-jnt
> 080817     move ws-rate-retro-elim     to ws-sbc-retroelim
> 080817     move ws-rate-waiting-days   to ws-sbc-wait-days
> 080817     move ws-rate-crit-per       to ws-sbc-max-bens
> 080817
> 080817     EXEC SQL
> 080817        SELECT
> 080817           LogicBenCode
> 080817        INTO
> 080817           :ws-sbc-logic-ben-code
> 080817        FROM
> 080817           BenefitCodeMapping
> 080817        WHERE
> 080817           State           = :ws-sbc-state
> 080817           and CovType     = :ws-sbc-cov-type
> 080817           and SinJnt      = :ws-sbc-sin-jnt
> 080817           and RetroElim   = :ws-sbc-retroelim
> 080817           and WaitDays    = :ws-sbc-wait-days
> 080817           and MaxBens     = :ws-sbc-max-bens
> 080817     end-exec
> 080817
> 080817     if sqlcode not = 0
> 080817        display "Error: cannot find ah benefit code "
> 080817           ws-sbc-state ' ' ws-sbc-cov-type ' ' ws-sbc-sin-jnt
> 080817           ' ' ws-sbc-retroelim ' ' ws-sbc-wait-days ' '
> 080817           ws-sbc-max-bens
> 080817
> 080817        display ' sql return code ' sqlcode
> 080817        display ' sql err mess    ' sqlerrmc
> 080817        move 20                  to ws-error-sub
> 080817        move spaces              to ws-error-sup
> 080817        string
> 080817           ws-sbc-state ' '
> 080817           ws-sbc-cov-type ' '
> 080817           ws-sbc-sin-jnt ' '
> 080817           ws-sbc-retroelim ' '
> 080817           ws-sbc-wait-days ' '
> 080817           ws-sbc-max-bens
> 080817           delimited by size into ws-error-sup
> 080817        perform 0180-error-handle
> 080817                                 thru 0180-exit
> 080817        go to 0300-return-cics
> 080817     end-if
> 080817
> 080817     move ws-sbc-logic-ben-code  to ws-rate-benefit-cd
847,848d974
<            perform 0050-get-account    thru 0050-exit
< 
855c981,982
<                                           cp-term-or-ext-days
---
> 
>            move ws-extension-days      to cp-term-or-ext-days
860,866c987,993
< 080117        if raw-ben-code (1:1) = 'N' or 'T'
< 080117           move ws-rate-benefit  to cp-original-benefit
< 080117                                    cp-rating-benefit-amt
< 080117        else
< 080117           move ws-rate-tot-pmts to cp-original-benefit
< 080117                                    cp-rating-benefit-amt
< 080117        end-if
---
>               if raw-ben-code (1:1) = 'N' or 'T'
>                  move ws-rate-benefit  to cp-original-benefit
>                                           cp-rating-benefit-amt
>               else
>                  move ws-rate-tot-pmts to cp-original-benefit
>                                           cp-rating-benefit-amt
>               end-if
869,870c996,997
< 080117        move ws-rate-benefit     to cp-original-benefit
< 080117                                    cp-rating-benefit-amt
---
>               move ws-rate-benefit     to cp-original-benefit
>                                           cp-rating-benefit-amt
900c1027,1029
<            if no-cp-error
---
>            if (no-cp-error)
>               or (cp-return-code = '8' or '9' or 'A' or 'B' or 'C')
>               move '0'                 to cp-return-code
914,925c1043
<       *    if ws-rate-benefit-type = 'L'
<       *       move cp-original-benefit to ws-max-benefit
<       *    else
<       *       compute ws-max-benefit =
<       *          cp-original-term * cp-original-benefit
<       *    end-if
< 
<            if ws-rate-benefit-type = 'L'
<               move cp-r-max-tot-ben    to ws-max-benefit
<            else
<               move cp-r-max-mon-ben    to ws-max-benefit
<            end-if
---
>            move cp-original-benefit    to ws-max-benefit
1047a1166,1183
> 080817     move am-comment-line (1)    to ws-form-limit-name
> 080817     move spaces                 to ws-limit-name
> 080817     perform varying l1 from +50 by -1 until
> 080817        (l1 < +1)
> 080817        or (ws-form-limit-name (l1:1) <> ' ')
> 080817     end-perform
> 080817     if l1 > +3
> 080817        perform varying l1 from l1 by -1 until
> 080817           (l1 < +1)
> 080817           or (ws-form-limit-name (l1:1) = ' ')
> 080817        end-perform
> 080817        if l1 > +3
> 080817           subtract +1 from l1
> 080817           move ws-form-limit-name (1:l1)
> 080817                                 to ws-limit-name
> 080817        end-if
> 080817     end-if
> 
1082,1084d1217
<            display ' about to startbr ' ws-cm-key (2:19) ' '
<               ws-rate-eff-date  ' ' ws-cm-key (23:11)
<               
1144d1276
<                  MOVE 'BLEW SUFFIX TABLE ' to ws-return-string
1146c1278,1282
<                  go to 0300-RETURN-CICS
---
>                  move 15               to ws-error-sub
>                  move spaces           to ws-error-sup
>                  perform 0180-error-handle
>                                        thru 0180-exit
>                  go to 0300-return-cics
1234,1235d1369
<                  display ' got a hit ' sql-contr-no ' '
<                     sql-contr-suffix
1245,1267d1378
<            if ws-tbl-last-suffix = low-values
<               display ' tbl last suffix = LV '
<            else
<               if ws-tbl-last-suffix = spaces
<                  display ' tbl last suffix = SPACES '
<               else
<                  display ' tbl last suffix = ' ws-tbl-last-suffix
<               end-if
<            end-if
< 
<            if ws-last-suffix = low-values
<               display ' last suffix = LV '
<            else
<               if ws-last-suffix = spaces
<                  display ' last suffix = SPACES '
<               else
<                  display ' last suffix = ' ws-last-suffix
<               end-if
<            end-if
< 
<            if sqlcode = 100
<               display ' Normal end of record set '
<            end-if
1279d1389
<                  MOVE 'BLEW SUFFIX TABLE ' to ws-return-string
1281c1391,1395
<                  go to 0300-RETURN-CICS
---
>                  move 15               to ws-error-sub
>                  move spaces           to ws-error-sup
>                  perform 0180-error-handle
>                                        thru 0180-exit
>                  go to 0300-return-cics
1299,1323c1413,1571
<        0100-process-message.
< 
<            perform 0110-unstring       thru 0110-exit
<            perform 0120-format-message thru 0120-exit
< 
<            perform 0020-edit-received  thru 0020-exit
<            perform 0025-assign-ben-cd  thru 0025-exit
< 
<            perform 0030-get-rate       thru 0030-exit
<            if (contract-no-assigned)
<                   or
<               (error-in-one-coverage)
<               continue
<            else
<               perform 0060-check-for-dup
<                                        thru 0060-exit
<               perform 0070-open-cursor thru 0070-exit
<               perform 0080-process-input
<                                        thru 0080-exit
<            end-if
<            perform 0040-format-buffer  thru 0040-exit
<            set contract-no-assigned to true
< 
<            .
<        0100-exit.
---
> 080817 0090-check-qc-lf-limits.
> 080817
> 080817     if not connected-to-db
> 080817        perform 6000-connect-to-db thru 6000-exit
> 080817     end-if
> 080817
> 080817     if ws-rate-ben-code (1:1) = 'L'
> 080817        move 'LL'                to ws-limit-cov-type
> 080817     else
> 080817        move 'RL'                to ws-limit-cov-type
> 080817     end-if
> 080817
> 080817     move ws-rate-age            to ws-limit-issue-age
> 080817
> 080817     EXEC SQL
> 080817        SELECT distinct top 1
> 080817           AttainedAge,
> 080817           MaxTerm,
> 080817           MaxTotBen
> 080817        INTO
> 080817           :ws-limit-att-age,
> 080817           :ws-limit-max-term,
> 080817           :ws-limit-max-tot-ben
> 080817        FROM
> 080817           FormLimits
> 080817        WHERE
> 080817           Limit           = :ws-limit-name
> 080817           and CovType     = :ws-limit-cov-type
> 080817           and LoIssueAge <= :ws-limit-issue-age
> 080817           and HiIssueAge >= :ws-limit-issue-age
> 080817     end-exec
> 080817
> 080817     if sqlcode not = 0
> 080817        display "Error: cannot find lf limits " ws-limit-name ' '
> 080817        ws-limit-cov-type ' ' ws-limit-issue-age
> 080817        display ' sql retrun code ' sqlcode
> 080817        display ' sql err mess    ' sqlerrmc
> 080817        move 18                  to ws-error-sub
> 080817        move ws-limit-name       to ws-error-sup
> 080817        perform 0180-error-handle
> 080817                                 thru 0180-exit
> 080817        go to 0300-return-cics
> 080817     end-if
> 080817
> 080817     if ws-rate-benefit <= ws-limit-max-tot-ben
> 080817        continue
> 080817     else
> 080817        move 8                   to ws-error-sub
> 080817        move '- Lf Benefit '     to ws-error-sup
> 080817        perform 0180-error-handle
> 080817                                 thru 0180-exit
> 080817        go to 0300-return-cics
> 080817     end-if
> 080817
> 080817     if ws-rate-ins-term <= ws-limit-max-term
> 080817        continue
> 080817     else
> 080817        move 7                   to ws-error-sub
> 080817        move '- Lf Term '        to ws-error-sup
> 080817        perform 0180-error-handle
> 080817                                 thru 0180-exit
> 080817        go to 0300-return-cics
> 080817     end-if
> 080817     if ws-att-age <= ws-limit-att-age
> 080817        continue
> 080817     else
> 080817        move 5                   to ws-error-sub
> 080817        move ws-att-age          to ws-error-sup
> 080817        perform 0180-error-handle
> 080817                                 thru 0180-exit
> 080817        go to 0300-return-cics
> 080817     end-if
> 080817
> 080817     .
> 080817 0090-exit.
> 080817     exit.
> 080817
> 080817 0095-check-qc-ah-limits.
> 080817
> 080817     if not connected-to-db
> 080817        perform 6000-connect-to-db thru 6000-exit
> 080817     end-if
> 080817
> 080817     move 'DI'                   to ws-limit-cov-type
> 080817     move ws-rate-age            to ws-limit-issue-age
> 080817
> 080817     EXEC SQL
> 080817        SELECT
> 080817           AttainedAge,
> 080817           MaxTerm,
> 080817           MaxMoBen,
> 080817           MaxTotBen
> 080817        INTO
> 080817           :ws-limit-att-age,
> 080817           :ws-limit-max-term,
> 080817           :ws-limit-max-mo-ben,
> 080817           :ws-limit-max-tot-ben
> 080817        FROM
> 080817           FormLimits
> 080817        WHERE
> 080817           Limit           = :ws-limit-name
> 080817           and CovType     = :ws-limit-cov-type
> 080817           and LoIssueAge <= :ws-limit-issue-age
> 080817           and HiIssueAge >= :ws-limit-issue-age
> 080817     end-exec
> 080817
> 080817     if sqlcode not = 0
> 080817        display "Error: cannot find ah limits " ws-limit-name
> 080817        display ' sql retrun code ' sqlcode
> 080817        display ' sql err mess    ' sqlerrmc
> 080817        move 18                  to ws-error-sub
> 080817        move ws-limit-name       to ws-error-sup
> 080817        perform 0180-error-handle
> 080817                                 thru 0180-exit
> 080817        go to 0300-return-cics
> 080817     end-if
> 080817
> 080817     if ws-rate-benefit <= ws-limit-max-mo-ben
> 080817        continue
> 080817     else
> 080817        move 8                   to ws-error-sub
> 080817        move '- Ah Benefit '     to ws-error-sup
> 080817        perform 0180-error-handle
> 080817                                 thru 0180-exit
> 080817        go to 0300-return-cics
> 080817     end-if
> 080817
> 080817     if (ws-rate-benefit * ws-rate-ins-term)
> 080817           <= ws-limit-max-tot-ben
> 080817        continue
> 080817     else
> 080817        move 10                  to ws-error-sub
> 080817        move '- Ah Tot Benefit ' to ws-error-sup
> 080817        perform 0180-error-handle
> 080817                                 thru 0180-exit
> 080817        go to 0300-return-cics
> 080817     end-if
> 080817
> 080817     if ws-rate-ins-term <= ws-limit-max-term
> 080817        continue
> 080817     else
> 080817        move 7                   to ws-error-sub
> 080817        move '- Ah Term '        to ws-error-sup
> 080817        perform 0180-error-handle
> 080817                                 thru 0180-exit
> 080817        go to 0300-return-cics
> 080817     end-if
> 080817     if ws-att-age <= ws-limit-att-age
> 080817        continue
> 080817     else
> 080817        move 5                   to ws-error-sub
> 080817        move ws-att-age          to ws-error-sup
> 080817        perform 0180-error-handle
> 080817                                 thru 0180-exit
> 080817        go to 0300-return-cics
> 080817     end-if
> 080817
> 080817     .
> 080817 0095-exit.
1361,1363d1608
<            display ' made 0110 ' raw-total-payments ' '
<            raw-period-payment
< 
1402,1403c1647,1648
<            display ' ben  in *' ws-work-in '*'
<            display ' ben  out *' ws-work-out '*'
---
>       *    display ' ben  in *' ws-work-in '*'
>       *    display ' ben  out *' ws-work-out '*'
1408,1409c1653,1654
<            display ' tot pmts  in *' ws-work-in '*'
<            display ' tot pmts  out *' ws-work-out '*'
---
>       *    display ' tot pmts  in *' ws-work-in '*'
>       *    display ' tot pmts  out *' ws-work-out '*'
1414,1415c1659,1660
<            display ' prem in *' ws-work-in '*'
<            display ' prem out *' ws-work-out '*'
---
>       *    display ' prem in *' ws-work-in '*'
>       *    display ' prem out *' ws-work-out '*'
1420,1421c1665,1666
<            display ' pmt  in *' ws-work-in '*'
<            display ' pmt  out *' ws-work-out '*'
---
>       *    display ' pmt  in *' ws-work-in '*'
>       *    display ' pmt  out *' ws-work-out '*'
1426,1428c1671,1673
<            display ' rate loan term *' ws-rate-loan-term '*'
<            display ' ln term in *' ws-work-in '*'
<            display ' ln term out *' ws-work-out '*'
---
>       *    display ' rate loan term *' ws-rate-loan-term '*'
>       *    display ' ln term in *' ws-work-in '*'
>       *    display ' ln term out *' ws-work-out '*'
1433,1435c1678,1680
<            display ' rate ins  term *' ws-rate-ins-term '*'
<            display ' ins term in *' ws-work-in '*'
<            display ' ins term out *' ws-work-out '*'
---
>       *    display ' rate ins  term *' ws-rate-ins-term '*'
>       *    display ' ins term in *' ws-work-in '*'
>       *    display ' ins term out *' ws-work-out '*'
1440,1441c1685,1686
<            display ' wait day in *' ws-work-in '*'
<            display ' wait day out *' ws-work-out '*'
---
>       *    display ' wait day in *' ws-work-in '*'
>       *    display ' wait day out *' ws-work-out '*'
1446,1447c1691,1692
<            display ' crit per in *' ws-work-in '*'
<            display ' crit per out *' ws-work-out '*'
---
>       *    display ' crit per in *' ws-work-in '*'
>       *    display ' crit per out *' ws-work-out '*'
1452,1453c1697,1698
<            display ' ins apr  in *' ws-work-in '*'
<            display ' ins apr  out *' ws-work-out '*'
---
>       *    display ' ins apr  in *' ws-work-in '*'
>       *    display ' ins apr  out *' ws-work-out '*'
1544a1790,1804
> 080817 0180-error-handle.
> 
> 080817     move ws-table-error-no (ws-error-sub)
> 080817                                 to ws-return-error-no
> 080817     move spaces                 to ws-return-error-mess
> 080817     string
> 080817        ws-table-error-mess (ws-error-sub)
> 080817        ws-error-sup
> 080817        delimited by '  ' into ws-return-error-mess
> 080817     end-string
> 080817
> 080817     .
> 080817 0180-exit.
> 080817     exit.
> 
1546a1807
> 080817     perform 0400-disconnect     thru 0400-exit
1554a1816,1828
> 080817 0400-disconnect.
> 080817
> 080817     if connected-to-db
> 080817        EXEC SQL
> 080817            disconnect all
> 080817        END-EXEC
> 080817        move ' ' to ws-connect-sw
> 080817     end-if
> 080817
> 080817     .
> 080817 0400-exit.
> 080817     exit.
> 
1585,1586d1858
< 
<            display ' About to connect to ' svr ' ' usr-pass

</pre>
<h3><a name="WSMESS02.cl2">WSMESS02.cl2</a><br><a href="#topper">Back to Top</a><br><pre>

17a18
> 020617*     Premium Quote                                              *
27a29
> 080817* 080817   2017020300002   PEMA  Limit and ben code assign changes.
38,40c40,42
<        77 ws-seq-num                   pic s9(8) comp value 0.
<        77 ws-flags                     pic s9(8) comp value 0.
<        77 WS-COMP-CD                   PIC X  VALUE LOW-VALUES.
---
>        77  ws-seq-num                  pic s9(8) comp value 0.
>        77  ws-flags                    pic s9(8) comp value 0.
>        77  WS-COMP-CD                  PIC X  VALUE LOW-VALUES.
42,51c44,54
<        77 WS-SAVE-ACCOUNT              PIC X(10)  VALUE SPACES.
<        77 WS-BIN-ORIG-EFF-DT           PIC XX  VALUE LOW-VALUES.
<        77 WS-ORIG-EFF-DT               PIC X(10)  VALUE SPACES.
<        77 WS-EFF-DATE                  PIC X(10)  VALUE SPACES.
<        77 WS-lf-exp-date               PIC X(10)  VALUE SPACES.
<        77  ws-ah-exp-date              pic x(10)  value spaces.
<        77 X1                           PIC S999 COMP-3 VALUE +0.
<        77 S1                           PIC S999 COMP-3 VALUE +0.
<        77 S2                           PIC S999 COMP-3 VALUE +0.
<        77 S3                           PIC S999 COMP-3 VALUE +0.
---
>        77  WS-SAVE-ACCOUNT             PIC X(10)  VALUE SPACES.
>        77  WS-BIN-ORIG-EFF-DT          PIC XX  VALUE LOW-VALUES.
>        77  WS-ORIG-EFF-DT              PIC X(10)  VALUE SPACES.
>        77  WS-EFF-DATE                 PIC X(10)  VALUE SPACES.
> 080817 77  WS-lf-exp-date              PIC X(10)  VALUE SPACES.
> 080817 77  ws-ah-exp-date              pic x(10)  value spaces.
>        77  ws-loan-exp-date            pic x(10)  value spaces.
>        77  X1                          PIC S999 COMP-3 VALUE +0.
>        77  S1                          PIC S999 COMP-3 VALUE +0.
>        77  S2                          PIC S999 COMP-3 VALUE +0.
>        77  S3                          PIC S999 COMP-3 VALUE +0.
53,59c56,62
<        77 WS-BUILD-SW                  PIC X.
<           88  TIME-TO-BUILD               VALUE 'Y'.
<        77 WS-SAVE-ERACCT               PIC X(2000).
<        77 WS-DIS-RESP                  PIC 9(05) VALUE ZEROS.
<        77 WS-PERFORM-SW                PIC X VALUE SPACES.
<           88  GET-RATES                    VALUE 'R'.
<           88  GET-ACT-ACCTS                VALUE 'A'.
---
>        77  WS-BUILD-SW                 PIC X.
>            88  TIME-TO-BUILD               VALUE 'Y'.
>        77  WS-SAVE-ERACCT              PIC X(2000).
>        77  WS-DIS-RESP                 PIC 9(05) VALUE ZEROS.
>        77  WS-PERFORM-SW               PIC X VALUE SPACES.
>            88  GET-RATES                    VALUE 'R'.
>            88  GET-ACT-ACCTS                VALUE 'A'.
61,67c64,73
<        77 ws-bin-eff-dt                pic xx  value low-values.
<        77  ws-bin-exp-dt               pic xx  value low-values.
<        77 ws-bin-1st-pmt-dt            pic xx  value low-values.
<        77 ws-bin-pri-birth-dt          pic xx  value low-values.
<        77 ws-bin-cob-birth-dt          pic xx  value low-values.
<        77 WS-DISP-AMT                  PIC Z,ZZZ,Z99.99.
<        77 ws-disp-rate                 pic z9.99999.
---
>        77  ws-bin-eff-dt               pic xx  value low-values.
>        77  ws-bin-lf-exp-dt            pic xx  value low-values.
>        77  ws-bin-ah-exp-dt            pic xx  value low-values.
>        77  ws-bin-loan-exp-dt          pic xx  value low-values.
>        77  ws-bin-1st-pmt-dt           pic xx  value low-values.
>        77  ws-bin-pri-birth-dt         pic xx  value low-values.
>        77  ws-bin-cob-birth-dt         pic xx  value low-values.
>        77  ws-limit-att-age-dt         pic xx  value low-values.
>        77  WS-DISP-AMT                 PIC Z,ZZZ,Z99.99.
>        77  ws-disp-rate                pic z9.99999.
87c93,108
<        
---
> 080817 77  ws-error-sub                pic 999  value zeros.
> 080817 77  ws-error-sup                pic x(25) value spaces.
> 080817 77  ws-form-limit-name          pic x(50) value spaces.
> 080817 77  l1                          pic s999 comp-3 value +0.
>        77  tx-discount-rate            pic s9v9(5) comp-3 value .00292.
>        77  ws-discount-rate            pic s99v9(5) comp-3 value +0.
>        77  temp-discount-rate          PIC S9V9(11) comp-3 value +0.
>        77  ws-rate-type                pic x.
>            88  sp-rate                   value 'S'.
>            88  mob-rate                  value 'M'.
>        77  ws-recalc-lf                pic x value ' '.
>            88  recalc-lf                  value 'Y'.
>        77  ws-recalc-di                pic x value ' '.
>            88  recalc-di                  value 'Y'.
>        77  ws-temp-lf-term             pic s999v99 comp-3 value +0.       
> 
100a122,123
>        01  ws-new-lf-term              pic 999 value zeros.
>        01  ws-new-ah-term              pic 999 value zeros.
104a128,129
>        01  LIFE-FACTOR                 PIC S9(7)V9(11) COMP-3 value +0.
>        01  SINGLE-FACTOR               PIC S9(7)V9(11) COMP-3 value +0.
111a137,142
>        01  V-TO-M                      PIC S9(7)V9(11) COMP-3 value +0.
>        01  X-TO-N                      PIC S9(7)V9(11) COMP-3 value +0.
>        01  V-TO-N                      PIC S9(7)V9(11) COMP-3 value +0.
>        01  X-TO-M                      PIC S9(7)V9(11) COMP-3 value +0.
>        01  V-TO-N-M                    PIC S9(7)V9(11) COMP-3 value +0.
>        01  X                           PIC S9(4)V9(11) COMP-3 value +0.
112a144
>        01  mnthly-rate                 pic s9(7)v9(11) comp-3 value +0.
117a150,153
>        01  dispmt                      pic s9(7)v99    comp-3 value +0.
>        01  lifepmt1                    pic s9(7)v99    comp-3 value +0.
>        01  lifepmt2                    pic s9(7)v99    comp-3 value +0.
>        01  newpmt                      pic s9(7)v99    comp-3 value +0.
149,209d184
<        01  ws-FL-lf-benefit-code-table.
<            05  ws-fl-lf-table.
<                10  filler              pic x(5) value 'RSN3K'.
<                10  filler              pic x(5) value 'LSN3O'.
<                10  filler              pic x(5) value 'NSN3S'.
<                10  filler              pic x(5) value 'TSN3X'.
< 
<                10  filler              pic x(5) value 'RSY3M'.
<                10  filler              pic x(5) value 'LSY3Q'.
<                10  filler              pic x(5) value 'NSY3U'.
<                10  filler              pic x(5) value 'TSY3Z'.
< 
<                10  filler              pic x(5) value 'RJN3L'.
<                10  filler              pic x(5) value 'LJN3P'.
<                10  filler              pic x(5) value 'NJN3T'.
<                10  filler              pic x(5) value 'TJN3Y'.
< 
<                10  filler              pic x(5) value 'RJY3N'.
<                10  filler              pic x(5) value 'LJY3R'.
<                10  filler              pic x(5) value 'NJY3V'.
<                10  filler              pic x(5) value 'TJY4A'.
< 
<            05  filler redefines ws-fl-lf-table occurs 16.
<                10  ws-fl-lf-ben-type   pic x.
<                10  ws-fl-lf-sin-jnt    pic x.
<                10  ws-fl-lf-dismemb    pic x.
<                10  ws-fl-lf-ben-code   pic xx.
< 
<        01  ws-FL-ah-benefit-code-table.
<            05  ws-fl-ah-table.
<                10  filler              pic x(8) value 'ASYR1401'.
<                10  filler              pic x(8) value 'ASYR0703'.
<                10  filler              pic x(8) value 'ASYR3004'.
<                10  filler              pic x(8) value 'ASYE1405'.
<                10  filler              pic x(8) value 'ASYE3002'.
< 
<                10  filler              pic x(8) value 'ASNR145C'.
<                10  filler              pic x(8) value 'ASNR075G'.
<                10  filler              pic x(8) value 'ASNR305D'.
<                10  filler              pic x(8) value 'ASNE145E'.
<                10  filler              pic x(8) value 'ASNE305F'.
< 
<                10  filler              pic x(8) value 'AJYR1454'.
<                10  filler              pic x(8) value 'AJYR0753'.
<                10  filler              pic x(8) value 'AJYR3055'.
<                10  filler              pic x(8) value 'AJYE1456'.
<                10  filler              pic x(8) value 'AJYE3057'.
< 
<                10  filler              pic x(8) value 'AJNR145H'.
<                10  filler              pic x(8) value 'AJNR075L'.
<                10  filler              pic x(8) value 'AJNR305I'.
<                10  filler              pic x(8) value 'AJNE145J'.
<                10  filler              pic x(8) value 'AJNE305K'.
<            05  filler redefines ws-fl-ah-table occurs 20.
<                10  ws-fl-ah-ben-type   pic x.
<                10  ws-fl-ah-sin-jnt    pic x.
<                10  ws-fl-ah-fullterm   pic x.
<                10  ws-fl-ah-ret-elim   pic x.
<                10  ws-fl-ah-elim-days  pic xx.
<                10  ws-fl-ah-ben-code   pic xx.
< 
259c234,236
<            05  nu-app-status           pic s9(4) comp value +0.
---
>            05  nu-partial-cov          pic s9(4) comp value +0.
>            05  nu-check-elig           pic s9(4) comp value +0.
>            05  nu-allow-trunc          pic s9(4) comp value +0.
273a251,281
> 080817 01  ws-limit-issue-age          pic 999.
>        01  ws-att-age                  pic 999v99.
> 080817 01  ws-pri-att-age              pic 999v99.
> 080817 01  ws-cob-att-age              pic 999v99.
> 080817 01  form-limit-table.
> 080817     05  ws-limit-name           pic x(50).
> 080817     05  ws-limit-cov-type       pic xx.
> 080817     05  ws-limit-lo-age         pic 999.
> 080817     05  ws-limit-hi-age         pic 999.
> 080817     05  ws-limit-att-age        pic 999.
> 080817     05  ws-limit-max-term       pic 999.
> 080817     05  ws-limit-max-jnt-term   pic 999.
> 080817     05  ws-limit-max-mo-ben     pic 9(5).
> 080817     05  ws-limit-max-tot-ben    pic 9(7).
> 080817     05  ws-limit-partial-cov    pic s9(4) comp-5.
>            05  ws-limit-check-elig     pic s9(4) comp-5.
>            05  ws-limit-elig-max-term  pic 999.
>            05  ws-limit-allow-truncated pic s9(4) comp-5.
> 080817
> 080817 01  state-benefit-code-table.
>            05  ws-sbc-min-amt          pic 999999.
> 080817     05  ws-sbc-state            pic xx.
> 080817     05  ws-sbc-cov-type         pic xx.
>            05  ws-sbc-ben-amt          pic 999999.
> 080817     05  ws-sbc-sin-jnt          pic x.
> 080817     05  ws-sbc-dismember        pic x.
> 080817     05  ws-sbc-retroelim        pic x.
> 080817     05  ws-sbc-wait-days        pic 999.
> 080817     05  ws-sbc-max-bens         pic 999.
> 080817     05  ws-sbc-logic-ben-code   pic xx.
> 
302a311,348
>        01  filler.
>            05  ws-test-bin-dt          pic xx.
>            05  ws-comp-bin-dt redefines ws-test-bin-dt
>                                        pic s9(4) comp.
>        01  ws-disp-bin-dt              pic 9(9) value zeros.
>        01  ws-rate-file-stuff.
>            12  ERRATE-KEY.
>                16  RATE-COMPANY-CD     PIC X        VALUE SPACE.
>                16  RATE-STATE-CODE.
>                    20  RATE-ST-CODE    PIC  XX      VALUE SPACES.
>                    20  RATE-ST-CLASS   PIC  XX      VALUE SPACES.
>                    20  RATE-ST-DEV     PIC  XXX     VALUE SPACES.
>                16  RATE-L-AH-CODE.
>                    20  RATE-L-AH       PIC  X       VALUE SPACE.
>                    20  RATE-LAH-NUM    PIC  XX      VALUE ZEROS.
>                16  RATE-LIMITS.
>                    20  RATE-HIGH-AGE   PIC  99      VALUE ZEROS.
>                    20  RATE-HIGH-AMT   PIC  9(6)    VALUE ZEROS.
>                    20  RATE-FUTURE     PIC  XX      VALUE SPACES.
>                    20  RATE-SEX        PIC  X       VALUE '9'.
>                16  RATE-EXPIRY-DATE    PIC 9(11)    COMP-3.
> 
>            12  SAVE-ERRATE-KEY.
>                16  SVRT-COMPANY-CD     PIC X        VALUE SPACE.
>                16  SVRT-STATE-CODE.
>                    20  SVRT-ST-CODE    PIC  XX      VALUE SPACES.
>                    20  SVRT-ST-CLASS   PIC  XX      VALUE SPACES.
>                    20  SVRT-ST-DEV     PIC  XXX     VALUE SPACES.
>                16  SVRT-L-AH-CODE.
>                    20  SVRT-L-AH       PIC  X       VALUE SPACE.
>                    20  SVRT-LAH-NUM    PIC  XX      VALUE ZEROS.
>                16  SVRT-LIMITS.
>                    20  SVRT-HIGH-AGE   PIC  99      VALUE ZEROS.
>                    20  SVRT-HIGH-AMT   PIC  9(6)    VALUE ZEROS.
>                    20  SVRT-FUTURE     PIC  XX      VALUE SPACES.
>                    20  SVRT-SEX        PIC  X       VALUE '9'.
>                16  SVRT-EXPIRY-DATE    PIC  9(11)   COMP-3.
>      
343a390
>            05  ws-rate-loan-pmt        pic 9(7)v99.
367a415,438
>        01  ws-lf-limits.
>            05  ws-lf-limit-lo-age         pic 999.
>            05  ws-lf-limit-hi-age         pic 999.
>            05  ws-lf-limit-att-age        pic 999.
>            05  ws-lf-limit-max-term       pic 999.
>            05  ws-lf-limit-max-benefit    pic 9(7).
>            05  ws-lf-limit-partial-cov    pic s9(4) comp-5.
>            05  ws-lf-limit-check-elig     pic s9(4) comp-5.
>            05  ws-lf-limit-elig-max-term  pic 999.
>            05  ws-lf-limit-allow-truncated pic s9(4) comp-5.
> 
>        01  ws-di-limits.
>            05  ws-di-limit-lo-age         pic 999.
>            05  ws-di-limit-hi-age         pic 999.
>            05  ws-di-limit-att-age        pic 999.
>            05  ws-di-limit-max-term       pic 999.
>            05  ws-di-limit-max-jnt-term   pic 999.
>            05  ws-di-limit-max-mo-ben     pic 9(5).
>            05  ws-di-limit-max-tot-ben    pic 9(7).
>            05  ws-di-limit-partial-cov    pic s9(4) comp-5.
>            05  ws-di-limit-check-elig     pic s9(4) comp-5.
>            05  ws-di-limit-elig-max-term  pic 999.
>            05  ws-di-limit-allow-truncated pic s9(4) comp-5.
> 
371c442
<            05  ws-return-error-mess    pic x(46).
---
>            05  ws-return-error-mess    pic x(150).
399a471,489
>            05  ws-sc16                 pic x.
>            05  ws-return-loan-exp-dt   pic x(10).
>            05  ws-sc17                 pic x.
>            05  ws-return-limit-name    pic x(50).
>            05  ws-sc18                 pic x.
>            05  ws-return-rate-class    pic xx.
>            05  ws-sc19                 pic x.
>            05  ws-return-loan-pmt      pic zzz,z99.99.
>            05  ws-sc20                 pic x.
>            05  ws-return-principal     pic zzz,z99.99.
>            05  ws-sc21                 pic x.
>            05  ws-return-lf-term       pic zz9.
>            05  ws-sc22                 pic x.
>            05  ws-return-ah-term       pic zz9.
>            05  ws-sc23                 pic x.
>            05  ws-return-lf-bencd      pic xx.
>            05  ws-sc24                 pic x.
>            05  ws-return-max-bens      pic 99.
> 
450,482c540,629
<                10  filler              pic x(50) value
<                '0000Transaction successfully completed'.
<                10  filler              pic x(50) value
<                '0101Problem with amounts'.
<                10  filler              pic x(50) value
<                '0102Problem with dates'.
<                10  filler              pic x(50) value
<                '0103Issue age outside limits'.
<                10  filler              pic x(50) value
<                '0104Attained age outside limits'.
<                10  filler              pic x(50) value
<                '0105Term is not valid must be gt 0 and lt 361'.
<                10  filler              pic x(50) value
<                '0106Term is outside limits'.
<                10  filler              pic x(50) value
<                '0107Amount is outside limits'.
<                10  filler              pic x(50) value
<                '0108Loan term must be ge insurance term'.
<                10  filler              pic x(50) value
<                '0109Total benefit is outside limits'.
<                10  filler              pic x(50) value
<                '0110Rates found were zero'.
<                10  filler              pic x(50) value
<                '0111Rate table was not found'.
<                10  filler              pic x(50) value
<                '0112Rate file not open'.
<                10  filler              pic x(50) value
<                '0113Premium is out of tolerence'.
<                10  filler              pic x(50) value
<                '0114Duplicate contract and VIN on Logic'.
<                10  filler              pic x(50) value
<                '0115Problem with loan or insurance term'.
<            05  filler redefines ws-errors-table occurs 16.
---
>                10  filler              pic x(130) value                    
>                '0000Transaction successfully completed'.                  
>                10  filler              pic x(130) value                    
>                '0101Amount entered contains invalid characters. Please c
>       -        'orrect and re-submit'.
>                10  filler              pic x(130) value                    
>                '0102Date entered is invalid. Please correct and re-submi
>       -        't'.
>                10  filler              pic x(130) value                    
>                '0103Customer age exceeds age limit. Not eligible for cov
>       -        'erage'.
>                10  filler              pic x(130) value                    
>                '0104Customer will exceed age limit during term of covera
>       -        'ge. Not eligible for coverage'.
>                10  filler              pic x(130) value                    
>                '0105Invalid loan term. Term must be more than 0 and less
>       -        ' than 360'.
>                10  filler              pic x(130) value
>                '0106Insurance term exceeds maximum term allowed. Loan is
>       -        ' not eligible for credit insurance'.
>                10  filler              pic x(130) value
>                '0107Insurance term exceeds maximum term allowed. Loan is
>       -        ' not eligible for Joint credit disability insurance'.
>                10  filler              pic x(130) value
>                '0108Insurance term exceeds maximum term allowed. Loan is
>       -        ' not eligible for credit disability insurance'.
>                10  filler              pic x(130) value
>                '0109Total of payments exceeds maximum allowed. Loan is n
>       -        'ot eligible for credit insurance'.
>                10  filler              pic x(130) value                    
>                '0110Monthly payment exceeds maximum allowed. Loan is not
>       -        ' eligible for disability insurance'.
>                10  filler              pic x(130) value                    
>                '0111Loan term cannot be less than insurance term. Loan i
>       -        's not eligible for credit insurance'.
>                10  filler              pic x(130) value                    
>                '0112Term times monthly payment exceeds Maximum total dis
>       -        'ability benefit. Loan is not eligible for credit disabil
>       -        'ity insurance'.
>                10  filler              pic x(130) value
>                '0113Cannot rate based on existing loan terms'.
>                10  filler              pic x(130) value                    
>                '0114Cannot rate life coverage based on existing loan ter
>       -        'ms'.
>                10  filler              pic x(130) value                    
>                '0115Cannot rate disability coverage based on existing lo
>       -        'an terms'.
>                10  filler              pic x(130) value                    
>                '0116Problem with rate file. Unable to rate'.              
>                10  filler              pic x(130) value                    
>                '0117Calculated premium is outside of tolerance'.          
>                10  filler              pic x(130) value                    
>                '0118This appears to be a duplicate record. Unable to rat
>       -        'e'.
>                10  filler              pic x(130) value                    
>                '0119Loan term and insurance term cannot be zero. Unable 
>       -        'to rate'.
>                10  filler              pic x(130) value                    
>                '0120Loan term and insurance term cannot be zero. Unable 
>       -        'to rate'.
>                10  filler              pic x(130) value
>                '0121Cannot locate limit table. Unable to rate'.
>                10  filler              pic x(130) value
>                '0122Invalid company id '.
>                10  filler              pic x(130) value                    
>                '0123Cannot locate life benefit code. Unable to rate'.     
>                10  filler              pic x(130) value                    
>                '0124Cannot locate disability benefit code. Unable to rat
>       -        'e'.
>                10  filler              pic x(130) value                    
>                '0125Calculated total of payments do not match submitted 
>       -        'total of payments. Unable to rate'.
>                10  filler              pic x(130) value                    
>                '0126Life and Disability Terms must be the same'.
>                10  filler              pic x(130) value                    
>                '0127Loan term and insurance term must be the same on Gro
>       -        'ss coverages'.
>                10  filler              pic x(130) value                    
>                '0128Total of payments does not match benefit amount prov
>       -        'ided on Gross coverage. Unable to rate'.
>                10  filler              pic x(130) value                    
>                '0129Calculated amount financed does not match provided a
>       -        'mount financed. Unable to rate'.
>                10  filler              pic x(130) value
>                '0130Insurance term exceeds maximum eligibility term. Loa
>       -        'n is not eligible for credit insurance'.
>                10  filler              pic x(130) value
>                '0131Amount exceeds maximum eligibility amount. Loan is n
>       -        'ot eligible for credit insurance'.
>            05  filler redefines ws-errors-table occurs 32.
484c631
<                10  ws-table-error-mess pic x(46).
---
>                10  ws-table-error-mess pic x(126).
500a648
>                                         COPY ERCRATE.
520,523c668,669
<            display ' mess002 area ' ws-mess002-pass-area
<            perform 0100-process-message
<                                        thru 0100-exit
<            display ' raw after unstring ' raw-message002-area
---
>            perform 0010-process-message
>                                        thru 0010-exit
543,546d688
<            display ' current date/time '
<               ws-fn-mo '/' ws-fn-da '/' ws-fn-ccyy ' - '
<                  ws-fn-hours ':' ws-fn-minutes ':' ws-fn-seconds
< 
573d714
<                  move '0113;Invalid company id ' to ws-return-string
574a716,720
>                  move 23               to ws-error-sub
>                  move client-id        to ws-error-sup
>                  perform 0180-error-handle
>                                        thru 0180-exit
>       *          move '0113;Invalid company id ' to ws-return-string
577a724,753
>            move 1                      to ws-error-sub
>            move low-values             to ws-bin-lf-exp-dt
>                                           ws-bin-ah-exp-dt
>                                           ws-bin-loan-exp-dt
>            move spaces                 to ws-return-string
>            move ';'                    to ws-sc1
>                                           ws-sc2
>                                           ws-sc3
>                                           ws-sc4
>                                           ws-sc5
>                                           ws-sc6
>                                           ws-sc7
>                                           ws-sc8
>                                           ws-sc9
>                                           ws-sc10
>                                           ws-sc11
>                                           ws-sc12
>                                           ws-sc13
>                                           ws-sc14
>                                           ws-sc15
>                                           ws-sc16
>                                           ws-sc17
>                                           ws-sc18
>                                           ws-sc19
>                                           ws-sc20
>                                           ws-sc21
>                                           ws-sc22
>                                           ws-sc23
>                                           ws-sc24
> 
581a758,801
>        0010-process-message.
> 
>            perform 0110-unstring       thru 0110-exit
>            perform 0120-format-message thru 0120-exit
> 
>            perform 0020-edit-received  thru 0020-exit
> 
>            perform 0050-get-account    thru 0050-exit
>            perform 0090-get-limits     thru 0090-exit
> 
>            perform 0025-assign-ben-cd  thru 0025-exit
>            perform 0030-get-lf-rate    thru 0030-exit
>            perform 0035-get-ah-rate    thru 0035-exit
> 
>            if ws-rate-in-lf-ben-code (1:1) = 'N' or 'T'
>               perform 0200-calc-NP-payment 
>                                        thru 0200-exit
>            else
>               perform 0250-calc-GP-payment
>                                        thru 0250-exit
>            end-if
> 
>       *    go to 0010-exit
> 
>            if (contract-no-assigned)
>                   or
>               (error-in-one-coverage)
>               continue
>            else
>               perform 0190-final-limit-check
>                                        thru 0190-exit
>               perform 0060-check-for-dup
>                                        thru 0060-exit
>               perform 0070-open-cursor thru 0070-exit
>               perform 0080-process-input
>                                        thru 0080-exit
>            end-if
>            perform 0040-format-buffer  thru 0040-exit
>            set contract-no-assigned to true
> 
>            .
>        0010-exit.
>            exit.
> 
625c845,848
<               move '0102;Problem with Eff Date' to ws-return-string
---
>               move 3                   to ws-error-sub
>               move '- Eff Date'        to ws-error-sup
>               perform 0180-error-handle
>                                        thru 0180-exit
630c853,856
<               move '0102;Future Effective Date' to ws-return-string
---
>               move 3                   to ws-error-sub
>               move '- Future Eff'      to ws-error-sup
>               perform 0180-error-handle
>                                        thru 0180-exit
653,654c879,882
<               move '0102;Problem with 1st pmt Date'
<                                        to ws-return-string
---
>               move 3                   to ws-error-sub
>               move '- 1st Pmt Dt'      to ws-error-sup
>               perform 0180-error-handle
>                                        thru 0180-exit
660,661c888,891
<               move '0102;1st Pmt Date not > Eff Dt '
<                                        to ws-return-string
---
>               move 3                   to ws-error-sub
>               move '- 1st Pmt !> Eff dt' to ws-error-sup
>               perform 0180-error-handle
>                                        thru 0180-exit
680,681c910,913
<                  move '0102;Problem with 1st pmt Date'
<                                        to ws-return-string
---
>                  move 3                to ws-error-sub
>                  move '- 1st Pmt Dt'   to ws-error-sup
>                  perform 0180-error-handle
>                                        thru 0180-exit
703a936,949
>       *    if d = 31
>       *       move 30 to d
>       *    end-if
> 
>       **==============================================================**
>       **                                                              **
>       **  Sometimes a lf term is passed to this module                **
>       **   even thought there is no life coverage. I try and rate it  **
>       **                                                              **
>       **==============================================================**
> 
>            if ws-rate-in-lf-ben-code = spaces
>               move zeros               to ws-rate-lf-term
>            end-if
704a951,952
>            .
>        0020-calc-lf-exp.
710a959,985
>            if ws-rate-lf-term > 0
>               move ws-bin-1st-pmt-dt   to dc-bin-date-1
>               compute dc-elapsed-months = ws-rate-lf-term - 1
>               move +0                  to dc-elapsed-days
>               move '6'                 to dc-option-code
>               perform 9700-date-link   thru 9700-exit
>               if no-conversion-error
>                  move dc-bin-date-2    to ws-bin-lf-exp-dt
>                  move dc-greg-date-a-edit
>                                        to ws-lf-exp-date
>               else
>                  move 3                to ws-error-sub
>                  move '- Lf Exp Dt'    to ws-error-sup
>                  perform 0180-error-handle
>                                        thru 0180-exit
>                  go to 0300-RETURN-CICS
>               end-if
>            end-if
> 
>            .
>        0020-calc-ah-exp.
>       **==============================================================**
>       **                                                              **
>       **  Calculate the ah expiration date to be passed back.         **
>       **                                                              **
>       **==============================================================**
> 
712c987
<            compute dc-elapsed-months = ws-rate-lf-term - 1
---
>            compute dc-elapsed-months = ws-rate-ah-term - 1
717,718c992,993
<               move dc-bin-date-2       to ws-bin-exp-dt
<               move dc-greg-date-a-edit to ws-lf-exp-date
---
>               move dc-bin-date-2       to ws-bin-ah-exp-dt
>               move dc-greg-date-a-edit to ws-ah-exp-date
720,721c995,998
<               move '0102;Problem with calculating exp date'
<                                     to ws-return-string
---
>               move 3                   to ws-error-sub
>               move '- Ah Exp Dt'       to ws-error-sup
>               perform 0180-error-handle
>                                        thru 0180-exit
724a1002,1004
>            .
>        0020-calc-loan-exp.
> 
727c1007
<       **  Calculate the ah expiration date to be passed back.         **
---
>       **  Calculate the loan expiration date to be passed back.       **
732c1012
<            compute dc-elapsed-months = ws-rate-ah-term - 1
---
>            compute dc-elapsed-months = ws-rate-loan-term - 1
737,738c1017,1018
<               move dc-bin-date-2       to ws-bin-exp-dt
<               move dc-greg-date-a-edit to ws-ah-exp-date
---
>               move dc-bin-date-2       to ws-bin-loan-exp-dt
>               move dc-greg-date-a-edit to ws-loan-exp-date
740,741c1020,1023
<               move '0102;Problem with calculating exp date'
<                                     to ws-return-string
---
>               move 3                   to ws-error-sub
>               move '- Loan Exp Dt'     to ws-error-sup
>               perform 0180-error-handle
>                                        thru 0180-exit
763,764c1045,1048
<               move '0102;Problem with Pri Birth Date'
<                                        to ws-return-string
---
>               move 3                   to ws-error-sub
>               move '- Pri DOB '        to ws-error-sup
>               perform 0180-error-handle
>                                        thru 0180-exit
791,792c1075,1078
<                  move '0102;Problem with Cob Birth Date'
<                                        to ws-return-string
---
>                  move 3                to ws-error-sub
>                  move '- Cob DOB '     to ws-error-sup
>                  perform 0180-error-handle
>                                        thru 0180-exit
809d1094
<               display ' issue age = 'ws-issue-age
811,812c1096,1125
<               move '0102;Problem with Pri Age calculation'
<                                        to ws-return-string
---
>               move 3                   to ws-error-sub
>               move '- Pri DOB '        to ws-error-sup
>               perform 0180-error-handle
>                                        thru 0180-exit
>               go to 0300-RETURN-CICS
>            end-if
> 
>            .
>        0020-calc-pri-att-age.
>       **==============================================================**
>       **                                                              **
>       **  Calculate primary borrowers age at expiration date          **
>       **                                                              **
>       **==============================================================**
> 
>            move ws-bin-pri-birth-dt    to dc-bin-date-1
>            move ws-bin-lf-exp-dt       to dc-bin-date-2
>            if ws-bin-ah-exp-dt > dc-bin-date-2
>               move ws-bin-ah-exp-dt    to dc-bin-date-2
>            end-if
>            move '1'                    to dc-option-code
>            perform 9700-date-link      thru 9700-exit
>            if no-conversion-error
>               compute ws-pri-att-age =
>                  dc-elapsed-months / +12
>            else
>               move 3                   to ws-error-sub
>               move '- Pri DOB '        to ws-error-sup
>               perform 0180-error-handle
>                                        thru 0180-exit
815a1129,1130
>            .
>        0020-calc-cob-age.
830d1144
<                  display ' cob   age = 'ws-cob-age
832,833c1146,1149
<                  move '0102;Problem with Cob Age calculation'
<                                        to ws-return-string
---
>                  move 3                to ws-error-sub
>                  move '- Cob DOB '     to ws-error-sup
>                  perform 0180-error-handle
>                                        thru 0180-exit
840,841d1155
<               display ' Using Co borrower age ' ws-issue-age
<                  ' ' ws-cob-age
845a1160,1232
>        0020-calc-cob-att-age.
>       **==============================================================**
>       **                                                              **
>       **  Calculate co borrowers age at expiration date               **
>       **                                                              **
>       **==============================================================**
> 
>            move zeros                  to ws-cob-att-age
>            if ws-bin-cob-birth-dt not = low-values
>               move ws-bin-cob-birth-dt to dc-bin-date-1
>               move ws-bin-lf-exp-dt    to dc-bin-date-2
>               if ws-bin-ah-exp-dt > dc-bin-date-2
>                  move ws-bin-ah-exp-dt to dc-bin-date-2
>               end-if
>               move '1'                 to dc-option-code
>               perform 9700-date-link   thru 9700-exit
>               if no-conversion-error
>                  compute ws-cob-att-age =
>                     dc-elapsed-months / +12
>               else
>                  move 3                to ws-error-sub
>                  move '- Cob DOB '     to ws-error-sup
>                  perform 0180-error-handle
>                                        thru 0180-exit
>                  go to 0300-RETURN-CICS
>               end-if
>            end-if
> 
>            move ws-cob-att-age         to ws-att-age
>            if ws-pri-att-age > ws-att-age
>               move ws-pri-att-age      to ws-att-age
>            end-if
> 
>            .
>        0020-val-terms.
>       **==============================================================**
>       **                                                              **
>       **  Validate life and dis terms                                 **
>       **                                                              **
>       **==============================================================**
> 
>            if (ws-rate-lf-term > 0)
>               and (ws-rate-ah-term > 0)
>               if ws-rate-lf-term <> ws-rate-ah-term
>                  move 27               to ws-error-sub
>                  move ' '              to ws-error-sup
>                  perform 0180-error-handle
>                                        thru 0180-exit
>                  go to 0300-RETURN-CICS
>               end-if
>            end-if
> 
>       **==============================================================**
>       **                                                              **
>       **  Validate Loan term against insurance term.                  **
>       **                                                              **
>       **==============================================================**
> 
>            if ((ws-rate-in-lf-ben-code (1:1) = 'G')
>               and (ws-rate-lf-term > 0)
>               and (ws-rate-lf-term <> ws-rate-loan-term))
>                         or
>               ((ws-rate-in-lf-ben-code (i:1) = ' ')
>               and (ws-rate-ah-term > 0)
>               and (ws-rate-ah-term <> ws-rate-loan-term))
>               move 28               to ws-error-sub
>               move ' '              to ws-error-sup
>               perform 0180-error-handle
>                                        thru 0180-exit
>               go to 0300-RETURN-CICS
>            end-if
> 
>            .
850a1238,1300
>            if not connected-to-db
>               perform 6000-connect-to-db thru 6000-exit
>            end-if
> 
>            move ws-rate-state          to ws-sbc-state
> 
>            evaluate true
>               when ws-rate-in-lf-ben-code (1:1) = 'N'
>                  move 'NP'             to ws-sbc-cov-type
>               when ws-rate-in-lf-ben-code (1:1) = 'T'
>                  move 'NT'             to ws-sbc-cov-type
>               when ws-rate-in-lf-ben-code (1:1) = 'L'
>                  move 'LL'             to ws-sbc-cov-type
>               when ws-rate-in-lf-ben-code (1:1) = ' '
>                  go to 0025-get-ah-ben
>               when other
>                  move 'GP'             to ws-sbc-cov-type
>            end-evaluate
> 
>            move ws-rate-loan-amt       to ws-sbc-ben-amt
>            move ws-rate-sin-jnt-lf     to ws-sbc-sin-jnt
>            move ws-rate-dismemberment  to ws-sbc-dismember
> 
>            EXEC SQL
>               SELECT TOP (1)
>                  MIN(BenefitAmt) as LessAmt,
>                  LogicBenCode
>               INTO
>                  :ws-sbc-min-amt,
>                  :ws-sbc-logic-ben-code
>               FROM
>                  BenefitCodeMapping
>               WHERE
>                  State           = :ws-sbc-state
>                  and CovType     = :ws-sbc-cov-type
>                  and SinJnt      = :ws-sbc-sin-jnt
>                  and Dismem      = :ws-sbc-dismember
>                  and BenefitAmt  > :ws-sbc-ben-amt
>               GROUP BY
>                  LogicBenCode
>               ORDER BY
>                  LessAmt
>            end-exec
> 
>            if sqlcode not = 0 and 1
>               display "Error: cannot find lf benefit code "
>                  ws-sbc-state ' ' ws-sbc-cov-type ' ' ws-sbc-sin-jnt
>                  ' ' ws-sbc-dismember
>               display ' sql return code ' sqlcode
>               display ' sql err mess    ' sqlerrmc
>               move 24                  to ws-error-sub
>               move spaces to ws-error-sup
>               string
>                  ws-sbc-state ' '
>                  ws-sbc-cov-type ' '
>                  ws-sbc-sin-jnt ' '
>                  ws-sbc-dismember
>                  delimited by size into ws-error-sup
>               perform 0180-error-handle
>                                        thru 0180-exit
>               go to 0300-return-cics
>            end-if
> 
853,856c1303
<       **     Eventually, depending on how well this project takes off **
<       **  we should figure out a much better way to assign benefit    **
<       **  codes. For now since we only have 1 or 2 accounts in TX it  **
<       **  will be hard coded.                                         **
---
>       ** The below code already works, just want to try some stuff    **
860,965c1307,1401
<       ***____________________________________________________________***
<       **|                                                            |**
<       **|   Get the lf benefit code first.                           |**
<       **|                                                            |**
<       ***____________________________________________________________***
<            if ws-rate-state = 'FL'
<               if ws-rate-in-lf-ben-code <> spaces
<                  PERFORM varying b1 from +1 by +1 until
<                     (b1 > +16)
<                     or ((ws-fl-lf-ben-type (b1)
<                                        = ws-rate-in-lf-ben-code (1:1))
<                      and (ws-fl-lf-sin-jnt (b1)
<                                        = ws-rate-sin-jnt-lf)
<                      and (ws-fl-lf-dismemb (b1)
<                                        = ws-rate-dismemberment))
<                  end-perform
<                  if b1 < +17
<                     display ' found lf ben code ' ws-rate-vin ' '
<                        ws-fl-lf-ben-code (b1)
<                     move ws-fl-lf-ben-code (b1)
<                                        to ws-rate-lf-benefit-cd
<                  else
<                     display ' lf benefit code not found ' ws-rate-vin
<                       ' '  ws-rate-in-lf-ben-code ' ' ws-rate-earn-meth
<                       ' ' ws-rate-sin-jnt-lf ' ' ws-rate-dismemberment
<                     GO TO 0025-EXIT
<                  end-if
<               end-if
<               if ws-rate-in-ah-ben-code <> spaces
<                  PERFORM varying b1 from +1 by +1 until
<                     (b1 > +20)
<                     or ((ws-fl-ah-ben-type (b1)
<                                        = ws-rate-in-ah-ben-code (1:1))
<                        and (ws-fl-ah-sin-jnt (b1)
<                                        = ws-rate-sin-jnt-ah)
<                        and (ws-fl-ah-fullterm (b1)
<                                        = ws-rate-fullterm)
<                        and (ws-fl-ah-ret-elim (b1)
<                                        = ws-rate-retro-elim)
<                        and (ws-fl-ah-elim-days (b1)
<                                        = ws-rate-waiting-days))
<                  end-perform
<               if b1 < +21
<                  display ' found ah ben code ' ws-rate-vin ' '
<                     ws-fl-ah-ben-code (b1)
<                  move ws-fl-ah-ben-code (b1)
<                                        to ws-rate-ah-benefit-cd
<                  GO TO 0025-EXIT
<               else
<                  display ' ah benefit code not found ' ws-rate-vin ' '
<                     ws-rate-in-ah-ben-code ' '
<                     ws-rate-earn-meth ' ' ws-rate-sin-jnt-ah ' '
<                     ws-rate-fullterm ' ' ws-rate-retro-elim ' '
<                     ws-rate-waiting-days
<                  GO TO 0025-EXIT
<               end-if
<            END-If
< 
<            if ws-rate-in-lf-ben-code <> spaces
<               if ws-rate-sin-jnt-lf = 'S'
<                  move '01'             to ws-rate-lf-benefit-cd
<               else
<                  move '03'             to ws-rate-lf-benefit-cd
<               end-if
<            else
<               if ws-rate-sin-jnt-ah = 'J'
<                  if ws-rate-retro-elim = 'R'
<                     if ws-rate-waiting-days = 14
<                        move '54'       to ws-rate-ah-benefit-cd
<                     else
<                        if ws-rate-waiting-days = 30
<                           move '55'    to ws-rate-ah-benefit-cd
<                        end-if
<                     end-if
<                  else
<                     if ws-rate-retro-elim = 'E'
<                        if ws-rate-waiting-days = 14
<                           move '56'    to ws-rate-ah-benefit-cd
<                        else
<                           if ws-rate-waiting-days = 30
<                              move '57' to ws-rate-ah-benefit-cd
<                           end-if
<                        end-if
<                     end-if
<                  end-if
<               else
<                  if ws-rate-retro-elim = 'R'
<                     if ws-rate-waiting-days = 14
<                        move '01'       to ws-rate-ah-benefit-cd
<                     else
<                        if ws-rate-waiting-days = 30
<                           move '04'    to ws-rate-ah-benefit-cd
<                        end-if
<                     end-if
<                  else
<                     if ws-rate-retro-elim = 'E'
<                        if ws-rate-waiting-days = 14
<                           move '05'    to ws-rate-ah-benefit-cd
<                        else
<                           if ws-rate-waiting-days = 30
<                              move '02' to ws-rate-ah-benefit-cd
<                           end-if
<                        end-if
<                     end-if
<                  end-if
<               end-if
---
>       *    EXEC SQL
>       *       SELECT
>       *          LogicBenCode
>       *       INTO
>       *          :ws-sbc-logic-ben-code
>       *       FROM
>       *          BenefitCodeMapping
>       *       WHERE
>       *          State           = :ws-sbc-state
>       *          and CovType     = :ws-sbc-cov-type
>       *          and SinJnt      = :ws-sbc-sin-jnt
>       *          and Dismem      = :ws-sbc-dismember
>       *          and BenefitAmt  > :ws-sbc-ben-amt
>       *    end-exec
>       *
>       *    if sqlcode not = 0
>       *       display "Error: cannot find lf benefit code "
>       *          ws-sbc-state ' ' ws-sbc-cov-type ' ' ws-sbc-sin-jnt
>       *          ' ' ws-sbc-dismember
>       *       display ' sql return code ' sqlcode
>       *       display ' sql err mess    ' sqlerrmc
>       *       move 19                  to ws-error-sub
>       *       move spaces to ws-error-sup
>       *       string
>       *          ws-sbc-state ' '
>       *          ws-sbc-cov-type ' '
>       *          ws-sbc-sin-jnt ' '
>       *          ws-sbc-dismember
>       *          delimited by size into ws-error-sup
>       *       perform 0180-error-handle
>       *                                thru 0180-exit
>       *       go to 0300-return-cics
>       *    end-if
> 
>            move ws-sbc-logic-ben-code  to ws-rate-lf-benefit-cd
> 
>            .
>        0025-get-ah-ben.
> 
>            if ws-rate-in-ah-ben-code (1:1) = ' '
>               go to 0025-exit
>            end-if
> 
>            move ws-rate-state          to ws-sbc-state
>            move 'DI'                   to ws-sbc-cov-type
>            move ws-rate-loan-amt       to ws-sbc-ben-amt
>            move ws-rate-sin-jnt-ah     to ws-sbc-sin-jnt
>            move ws-rate-retro-elim     to ws-sbc-retroelim
>            move ws-rate-waiting-days   to ws-sbc-wait-days
>            move ws-rate-crit-per       to ws-sbc-max-bens
> 
>            EXEC SQL
>               SELECT TOP (1)
>                  MIN(BenefitAmt) as LessAmt,
>                  LogicBenCode
>               INTO
>                  :ws-sbc-min-amt,
>                  :ws-sbc-logic-ben-code
>               FROM
>                  BenefitCodeMapping
>               WHERE
>                  State           = :ws-sbc-state
>                  and CovType     = :ws-sbc-cov-type
>                  and SinJnt      = :ws-sbc-sin-jnt
>                  and RetroElim   = :ws-sbc-retroelim
>                  and WaitDays    = :ws-sbc-wait-days
>                  and MaxBens     = :ws-sbc-max-bens
>                  and BenefitAmt  > :ws-sbc-ben-amt
>               GROUP BY
>                  LogicBenCode
>               ORDER BY
>                  LessAmt
>            end-exec
> 
>            if sqlcode not = 0
>               display "Error: cannot find ah benefit code "
>                  ws-sbc-state ' ' ws-sbc-cov-type ' ' ws-sbc-sin-jnt
>                  ' ' ws-sbc-retroelim ' ' ws-sbc-wait-days ' '
>                  ws-sbc-max-bens
> 
>               display ' sql return code ' sqlcode
>               display ' sql err mess    ' sqlerrmc
>               move 25                  to ws-error-sub
>               move spaces              to ws-error-sup
>               string
>                  ws-sbc-state ' '
>                  ws-sbc-cov-type ' '
>                  ws-sbc-sin-jnt ' '
>                  ws-sbc-retroelim ' '
>                  ws-sbc-wait-days ' '
>                  ws-sbc-max-bens
>                  delimited by size into ws-error-sup
>               perform 0180-error-handle
>                                        thru 0180-exit
>               go to 0300-return-cics
967a1404,1405
>            move ws-sbc-logic-ben-code  to ws-rate-ah-benefit-cd
> 
974c1412,1415
<            perform 0050-get-account    thru 0050-exit
---
>            if (ws-rate-in-lf-ben-code (1:1) = ' ')
>               or (ws-rate-lf-term = zeros)
>               go to 0030-exit
>            end-if
1004a1446,1453
>            if (cp-original-term = zeros)
>               and (cp-loan-term = zeros)
>               move 20                  to ws-error-sub
>               move '-Lf term'          to ws-error-sup
>               perform 0180-error-handle
>                                        thru 0180-exit
>               go to 0300-return-cics
>            end-if
1013c1462
<            
---
> 
1016,1020c1465,1489
<            if no-cp-error
<               move cp-premium-rate     to lf-rate
<                                           ws-rate-lf-rate
<               move cp-r-max-tot-ben    to ws-max-lf-benefit
<            else
---
>            evaluate true
>               when cp-return-code = '7'
>                  move 0                to cp-return-code
>                  move 14               to ws-error-sub
>                  move '-Lf Rates'      to ws-error-sup
>                  perform 0180-error-handle
>                                        thru 0180-exit
>                  go to 0300-return-cics
>               when cp-return-code = '6'
>                  move 0                to cp-return-code
>                  move 15               to ws-error-sub
>                  move '-Lf Rates'      to ws-error-sup
>                  perform 0180-error-handle
>                                        thru 0180-exit
>                  go to 0300-return-cics
>               when cp-return-code = 'D'
>                  move 0                to cp-return-code
>                  move 17               to ws-error-sub
>                  move ' '              to ws-error-sup
>                  perform 0180-error-handle
>                                        thru 0180-exit
>                  go to 0300-return-cics
>            end-evaluate
> 
>            if cp-error-occured
1021a1491,1517
>               move 17                  to ws-error-sub
>               move '-Lf rate'          to ws-error-sup
>               perform 0180-error-handle
>                                        thru 0180-exit
>               go to 0300-return-cics
>            end-if
> 
>            move 'S'                    to ws-rate-type
>            move +0                     to ws-discount-rate
> 
>            if (rt-discount-option <> ' ')
>               and (rt-discount-ob-rate > zeros)
>               move rt-discount-ob-rate to cp-premium-rate
>               move rt-discount-rate    to ws-discount-rate
>               if ws-discount-rate > 1
>                  if cp-state = 'PA'
>                     compute ws-discount-rate rounded =
>                        ws-discount-rate / 100
>                  else
>                     compute ws-discount-rate rounded = 
>                        ws-discount-rate / 1200
>                  end-if
>               end-if
>               set mob-rate to true
>            else
>               move rt-l-rate (cp-original-term)
>                                        to cp-premium-rate
1023a1520,1546
>            if cp-premium-rate not numeric
>               move zeros to cp-premium-rate
>            end-if
> 
>       **==============================================================**
>       **                                                              **
>       **      The below chunk of code is for those states that have   **
>       **   the SP equivalent of a discounted MOB rate stored in       **
>       **   Logic. All it does is calc a 12 month rate to be used      **
>       **   with the QC formulas because they expect that. I did this  **
>       **   so we wouldn't have a ton of hard coded formulas that      **
>       **   basically do the same thing.                               **
>       **                                                              **
>       **==============================================================**
> 
>            if (ws-rate-in-lf-ben-code (1:1) = 'G')
>               and (cp-state = 'IN' OR 'MT' OR 'ND' OR 'NJ' OR 'PA')
>               display ' converting MOB to SP ' cp-premium-rate
>               compute cp-premium-rate rounded = 
>                  cp-premium-rate / cp-loan-term * 12
>               display ' new rate FOR ' CP-STATE ' ' cp-premium-rate
>            end-if
> 
>            move cp-premium-rate        to lf-rate
>                                           ws-rate-lf-rate
>            move zeros                  to ws-max-lf-benefit
> 
1029a1553,1557
>            move zeros to ws-rate-ah-rate
>            if ws-rate-in-ah-ben-code (1:1) = ' '
>               go to 0035-exit
>            end-if
> 
1065a1594,1602
>            if (cp-original-term = zeros)
>               and (cp-loan-term = zeros)
>               move 21                  to ws-error-sub
>               move '-DI term'          to ws-error-sup
>               perform 0180-error-handle
>                                        thru 0180-exit
>               go to 0300-return-cics
>            end-if
> 
1077,1090c1614,1644
<            if no-cp-error
<               move cp-premium-rate     to ah-rate
<                                           ws-rate-ah-rate
<               move cp-r-max-mon-ben    to ws-max-ah-benefit
<               display ' ah rate no error ' cp-premium-rate
<            else
<               DISPLAY ' Error with AH Rate call ' cp-state ' '
<                 cp-class-code ' ' cp-deviation-code ' ' cp-benefit-type
<                 ' ' cp-benefit-cd ' '
<                 cp-original-benefit ' ' cp-issue-age cp-company-id ' '
<                 cp-original-term ' ' cp-loan-term ' ' cp-earning-method
<                 ' ' cp-return-code
<               
<               move zeros               to ah-rate
---
>            evaluate true
>               when cp-return-code = '7'
>                  move '0'              to cp-return-code
>                  move 14               to ws-error-sub
>                  move '-Ah Rates'      to ws-error-sup
>                  perform 0180-error-handle
>                                        thru 0180-exit
>                  go to 0300-return-cics
>               when cp-return-code = '6'
>                  move '0'              to cp-return-code
>                  move 16               to ws-error-sub
>                  move ' '              to ws-error-sup
>                  perform 0180-error-handle
>                                        thru 0180-exit
>                  go to 0300-return-cics
>               when cp-return-code = 'D'
>                  move '0'              to cp-return-code
>                  move 17               to ws-error-sub
>                  move ' '              to ws-error-sup
>                  perform 0180-error-handle
>                                        thru 0180-exit
>                  go to 0300-return-cics
>            end-evaluate
> 
>            if cp-error-occured
>               move zeros               to lf-rate
>               move 17                  to ws-error-sub
>               move '-DI rate'          to ws-error-sup
>               perform 0180-error-handle
>                                        thru 0180-exit
>               go to 0300-return-cics
1092a1647,1653
>            move rt-ah-rate (cp-original-term)
>                                        to cp-premium-rate
> 
>           move cp-premium-rate         to ah-rate
>                                           ws-rate-ah-rate
>           move zeros                   to ws-max-ah-benefit
> 
1099c1660
<            move spaces                 to ws-return-string
---
>       *    move spaces                 to ws-return-string
1117a1679,1688
>                                           ws-sc16
>                                           ws-sc17
>                                           ws-sc18
>                                           ws-sc19
>                                           ws-sc20
>                                           ws-sc21
>                                           ws-sc22
>                                           ws-sc23
>                                           ws-sc24
> 
1130a1702,1709
>               move zeros               to ws-return-principal
>               move ws-rate-lf-term     to ws-return-lf-term
> 
>               move ws-rate-ah-term     to ws-return-ah-term
>               move ws-rate-in-lf-ben-code
>                                        to ws-return-lf-bencd
>               move ws-rate-crit-per    to ws-return-max-bens
> 
1134a1714
>               move ws-loan-exp-date    to ws-return-loan-exp-dt
1139a1720
>               move ws-rate-loan-pmt    to ws-return-loan-pmt
1141a1723,1724
>               move ws-limit-name       to ws-return-limit-name
>               move am-cal-table        to ws-return-rate-class
1171,1172c1754,1755
<               when cp-return-code = 'H'
<                  move +9               to s1
---
>       *       when cp-return-code = 'H'
>       *          move +9               to s1
1180a1764,1765
>               when cp-return-code = 'X'
>                  move +17              to s1
1208a1794,1796
>            if ws-rate-state = 'KY'
>               move '8'                 to ws-am-carrier
>            end-if
1233a1822,1839
>            move am-comment-line (1)    to ws-form-limit-name
>            move spaces                 to ws-limit-name
>            perform varying l1 from +50 by -1 until
>               (l1 < +1)
>               or (ws-form-limit-name (l1:1) <> ' ')
>            end-perform
>            if l1 > +3
>               perform varying l1 from l1 by -1 until
>                  (l1 < +1)
>                  or (ws-form-limit-name (l1:1) = ' ')
>               end-perform
>               if l1 > +3
>                  subtract +1 from l1
>                  move ws-form-limit-name (1:l1)
>                                        to ws-limit-name
>               end-if
>            end-if
> 
1254a1861,1863
>            if ws-rate-state = 'KY'
>               move '8'                 to ws-cm-carrier
>            end-if
1268,1270d1876
<            display ' about to startbr ' ws-cm-key (2:19) ' '
<               ws-rate-eff-date  ' ' ws-cm-key (23:11)
<               
1330d1935
<                  MOVE 'BLEW SUFFIX TABLE ' to ws-return-string
1332c1937,1941
<                  go to 0300-RETURN-CICS
---
>                  move 19               to ws-error-sub
>                  move spaces           to ws-error-sup
>                  perform 0180-error-handle
>                                        thru 0180-exit
>                  go to 0300-return-cics
1420,1421d2028
<                  display ' got a hit ' sql-contr-no ' '
<                     sql-contr-suffix
1431,1453d2037
<            if ws-tbl-last-suffix = low-values
<               display ' tbl last suffix = LV '
<            else
<               if ws-tbl-last-suffix = spaces
<                  display ' tbl last suffix = SPACES '
<               else
<                  display ' tbl last suffix = ' ws-tbl-last-suffix
<               end-if
<            end-if
< 
<            if ws-last-suffix = low-values
<               display ' last suffix = LV '
<            else
<               if ws-last-suffix = spaces
<                  display ' last suffix = SPACES '
<               else
<                  display ' last suffix = ' ws-last-suffix
<               end-if
<            end-if
< 
<            if sqlcode = 100
<               display ' Normal end of record set '
<            end-if
1465d2048
<                  MOVE 'BLEW SUFFIX TABLE ' to ws-return-string
1467c2050,2054
<                  go to 0300-RETURN-CICS
---
>                  move 19               to ws-error-sub
>                  move spaces           to ws-error-sup
>                  perform 0180-error-handle
>                                        thru 0180-exit
>                  go to 0300-return-cics
1485c2072
<        0100-process-message.
---
>        0090-get-limits.
1487,1488c2074,2115
<            perform 0110-unstring       thru 0110-exit
<            perform 0120-format-message thru 0120-exit
---
>            move zeros                  to ws-lf-limit-lo-age      
>                                           ws-lf-limit-hi-age      
>                                           ws-lf-limit-att-age     
>                                           ws-lf-limit-max-term    
>                                           ws-lf-limit-max-benefit 
>                                           ws-lf-limit-partial-cov
>                                           ws-lf-limit-check-elig
>                                           ws-lf-limit-elig-max-term
>                                           ws-lf-limit-allow-truncated
>                                           ws-di-limit-lo-age      
>                                           ws-di-limit-hi-age      
>                                           ws-di-limit-att-age     
>                                           ws-di-limit-max-term    
>                                           ws-di-limit-max-jnt-term
>                                           ws-di-limit-max-mo-ben  
>                                           ws-di-limit-max-tot-ben 
>                                           ws-di-limit-partial-cov
>                                           ws-di-limit-check-elig
>                                           ws-di-limit-elig-max-term
>                                           ws-di-limit-allow-truncated
> 
>            if (ws-rate-lf-term = zeros)
>               and (ws-rate-ah-term <> zeros)
>               move 'N '                to ws-rate-in-lf-ben-code
>            end-if
> 
>            perform 0092-get-lf-limits  thru 0092-exit
>            perform 0097-get-di-limits  thru 0097-exit
> 
>            if recalc-lf
>               perform 0020-calc-lf-exp
>            end-if
>            if recalc-di
>               perform 0020-calc-ah-exp
>               if ws-rate-ah-term < ws-rate-crit-per
>                  move zeros            to ws-rate-crit-per
>            end-if
> 
>            if recalc-lf or recalc-di
>               perform 0020-calc-pri-att-age
>               perform 0020-calc-cob-att-age
>            end-if
1490,1491c2117,2119
<            perform 0020-edit-received  thru 0020-exit
<            perform 0025-assign-ben-cd  thru 0025-exit
---
>            .
>        0090-exit.
>            exit.
1493,1494c2121,2125
<            perform 0030-get-lf-rate    thru 0030-exit
<            perform 0035-get-ah-rate    thru 0035-exit
---
>        0092-get-lf-limits.
> 
>            if not connected-to-db
>               perform 6000-connect-to-db thru 6000-exit
>            end-if
1496c2127,2136
<            perform 0200-calc-payment   thru 0200-exit 
---
>            evaluate true
>               when raw-lf-ben-code (1:1) = 'L' 
>                  move 'LL'             to ws-limit-cov-type
>               when raw-ah-ben-code (1:1) = ' '
>                  move 'LO'             to ws-limit-cov-type
>               when raw-lf-ben-code (1:1) = 'N' or 'G' or 'T'
>                  move 'RL'             to ws-limit-cov-type
>               when other   *> Assuming no life coverage
>                  go to 0092-exit
>            end-evaluate
1498c2138,2148
<       *    go to 0100-exit
---
>            move zeros                  to ws-limit-lo-age
>                                           ws-limit-hi-age
>                                           ws-limit-att-age
>                                           ws-limit-max-term
>                                           ws-limit-max-jnt-term
>                                           ws-limit-max-mo-ben
>                                           ws-limit-max-tot-ben
>                                           ws-limit-partial-cov
>                                           ws-limit-check-elig
>                                           ws-limit-elig-max-term
>                                           ws-limit-allow-truncated
1500,1502c2150,2255
<            if (contract-no-assigned)
<                   or
<               (error-in-one-coverage)
---
>            move ws-rate-age            to ws-limit-issue-age
> 
>            .
>        0092-get-life.
> 
>            move 30                     to ws-limit-issue-age
> 
>            EXEC SQL
>               SELECT
>                  AttainedAge
>               INTO
>                  :ws-limit-att-age
>               FROM
>                  FormLimits
>               WHERE
>                  Limit           = :ws-limit-name
>                  and CovType     = :ws-limit-cov-type
>                  and LoIssueAge <= :ws-limit-issue-age
>                  and HiIssueAge >= :ws-limit-issue-age
>            end-exec
> 
>            if sqlcode not = 0
>               display "Error: cannot find limitsa " ws-limit-name
>                  ' ' ws-limit-cov-type ' ' ws-limit-issue-age
>               display ' sql retrun code ' sqlcode
>               display ' sql err mess    ' sqlerrmc
>               if (ws-limit-cov-type = 'LO')
>                  and (raw-ah-ben-code (1:1) = ' ')
>                  move 'RL'             to ws-limit-cov-type
>                  go to 0092-get-life
>               else
>                  display "Error: cannot find limits " ws-limit-name
>                     ' ' ws-limit-cov-type ' ' ws-limit-issue-age
>                  display ' sql retrun code ' sqlcode
>                  display ' sql err mess    ' sqlerrmc
>                  move 22                  to ws-error-sub
>                  move ws-limit-name       to ws-error-sup
>                  perform 0180-error-handle
>                                           thru 0180-exit
>                  go to 0300-return-cics
>               end-if
>            end-if
> 
>            move ws-rate-age            to ws-limit-issue-age
> 
>            EXEC SQL
>               SELECT
>                  AttainedAge,
>                  MaxTerm,
>                  MaxTotBen,
>                  PartialCoverage,
>                  CheckEligibility,
>                  EligibilityMaxTerm,
>                  AllowTruncated
>               INTO
>                  :ws-limit-att-age,
>                  :ws-limit-max-term,
>                  :ws-limit-max-tot-ben,
>                  :ws-limit-partial-cov  :nu-partial-cov,
>                  :ws-limit-check-elig   :nu-check-elig,
>                  :ws-limit-elig-max-term,
>                  :ws-limit-allow-truncated  :nu-allow-trunc
>               FROM
>                  FormLimits
>               WHERE
>                  Limit           = :ws-limit-name
>                  and CovType     = :ws-limit-cov-type
>                  and LoIssueAge <= :ws-limit-issue-age
>                  and HiIssueAge >= :ws-limit-issue-age
>            end-exec
> 
>            if sqlcode not = 0
>               display "Error: cannot find limits for age "
>                  ws-limit-name ' ' ws-limit-cov-type ' '
>                  ws-limit-issue-age
>               display ' sql retrun code ' sqlcode
>               display ' sql err mess    ' sqlerrmc
>               move 4                   to ws-error-sub
>              move ws-limit-name        to ws-error-sup
>              perform 0180-error-handle thru 0180-exit
>              go to 0300-return-cics
>            end-if
> 
>       *    display ' good get on limit *'  ws-limit-name '*'
>       *       ws-limit-att-age '*' ws-limit-cov-type '*'
>       *         ws-limit-issue-age '*' ws-limit-att-age '*'
>       *         ws-limit-partial-cov '*' ws-limit-check-elig '*'
>       *         ws-limit-elig-max-term '*'
>       *         ws-limit-allow-truncated '*'
> 
>            move ws-limit-lo-age        to ws-lf-limit-lo-age
>            move ws-limit-hi-age        to ws-lf-limit-hi-age
>            move ws-limit-att-age       to ws-lf-limit-att-age
>            move ws-limit-max-term      to ws-lf-limit-max-term
>            move ws-limit-max-tot-ben   to ws-lf-limit-max-benefit
>            move ws-limit-partial-cov   to ws-lf-limit-partial-cov
>            move ws-limit-check-elig    to ws-lf-limit-check-elig
>            move ws-limit-elig-max-term to ws-lf-limit-elig-max-term
>            move ws-limit-allow-truncated
>                                        to ws-lf-limit-allow-truncated
> 
>            if ws-lf-limit-check-elig = 0
>               go to 0092-continue
>            end-if
> 
>            if ws-rate-loan-term <= ws-lf-limit-elig-max-term
1505,1509c2258,2262
<               perform 0060-check-for-dup
<                                        thru 0060-exit
<               perform 0070-open-cursor thru 0070-exit
<               perform 0080-process-input
<                                        thru 0080-exit
---
>               move 31                  to ws-error-sub
>               move ' '                 to ws-error-sup
>               perform 0180-error-handle
>                                        thru 0180-exit
>               go to 0300-return-cics
1511,1512c2264,2532
<            perform 0040-format-buffer  thru 0040-exit
<            set contract-no-assigned to true
---
> 
>            if ws-rate-loan-amt <= ws-lf-limit-max-benefit
>               continue
>            else
>               move 32                  to ws-error-sub
>               move '- Lf Benefit '     to ws-error-sup
>               perform 0180-error-handle
>                                        thru 0180-exit
>               go to 0300-return-cics
>            end-if
> 
>            .
>        0092-continue.
> 
>            move ' '                    to ws-recalc-lf
>            if ws-lf-limit-allow-truncated = 0
>               go to 0092-exit
>            end-if
> 
>            if ws-att-age <= ws-lf-limit-att-age
>               go to 0092-exit
>            end-if
> 
>       *****  Calculate the date in which they will turn the
>       *****  limit attained age.
> 
>            move ws-bin-pri-birth-dt to dc-bin-date-1
>            if (ws-bin-cob-birth-dt < dc-bin-date-1)
>               and (ws-bin-cob-birth-dt <> low-values)
>               move ws-bin-cob-birth-dt to dc-bin-date-1
>            end-if
>            move dc-bin-date-1          to ws-test-bin-dt
>            move ws-comp-bin-dt         to ws-disp-bin-dt
> 
>            compute dc-elapsed-months = (ws-lf-limit-att-age * 12)
>            move '6'                    to dc-option-code
>            move zeros                  to dc-elapsed-days
>            PERFORM 9700-date-link      thru 9700-exit
>            if no-conversion-error
>               move dc-bin-date-2       to ws-limit-att-age-dt
>            else
>               move low-values          to ws-limit-att-age-dt
>            end-if
> 
>            move dc-bin-date-2          to ws-test-bin-dt
>            move ws-comp-bin-dt         to ws-disp-bin-dt
> 
>            set recalc-lf to true
> 
>            compute ws-temp-lf-term = ws-rate-lf-term -
>               ((ws-att-age - ws-lf-limit-att-age) * 12)
> 
>            compute ws-rate-lf-term = ws-rate-lf-term -
>               ((ws-att-age - ws-lf-limit-att-age) * 12)
>            move 'T '                   to ws-rate-in-lf-ben-code
> 
>       *****  Calculate the new expiration date.
> 
>            perform 0020-calc-lf-exp
>            if ws-bin-lf-exp-dt > ws-limit-att-age-dt
>               subtract 1 from ws-rate-lf-term
>            end-if
> 
>       *    if ws-rate-loan-amt <= ws-limit-max-tot-ben
>       *       continue
>       *    else
>       *       move 8                   to ws-error-sub
>       *       move '- Lf Benefit '     to ws-error-sup
>       *       perform 0180-error-handle
>       *                                thru 0180-exit
>       *       go to 0300-return-cics
>       *    end-if
>       *
>       *    if ws-rate-lf-term <= ws-limit-max-term
>       *       continue
>       *    else
>       *       move 7                   to ws-error-sub
>       *       move '- Lf Term '        to ws-error-sup
>       *       perform 0180-error-handle
>       *                                thru 0180-exit
>       *       go to 0300-return-cics
>       *    end-if
>       *    if ws-att-age <= ws-limit-att-age
>       *       continue
>       *    else
>       *       move 5                   to ws-error-sub
>       *       move ws-att-age          to ws-error-sup
>       *       perform 0180-error-handle
>       *                                thru 0180-exit
>       *       go to 0300-return-cics
>       *    end-if
> 
>            .
>        0092-exit.
>            exit.
> 
>        0097-get-di-limits.
> 
>            if raw-ah-ben-code (1:1) = 'A'
>               move 'DI'                to ws-limit-cov-type
>            else   *>  Assuming no AH coverage
>               go to 0097-exit
>            end-if
> 
>            if not connected-to-db
>               perform 6000-connect-to-db thru 6000-exit
>            end-if
> 
>       ***  True = -1
> 
>            move 30                     to ws-limit-issue-age
> 
>            EXEC SQL
>               SELECT distinct top 1
>                  AttainedAge
>               INTO
>                  :ws-limit-att-age
>               FROM
>                  FormLimits
>               WHERE
>                  Limit           = :ws-limit-name
>                  and CovType     = :ws-limit-cov-type
>                  and LoIssueAge <= :ws-limit-issue-age
>                  and HiIssueAge >= :ws-limit-issue-age
>            end-exec
> 
>            if sqlcode not = 0
>               display "Error: cannot find limits " ws-limit-name
>               display ' sql retrun code ' sqlcode
>               display ' sql err mess    ' sqlerrmc
>               move 22                  to ws-error-sub
>               move ws-limit-name       to ws-error-sup
>               perform 0180-error-handle
>                                        thru 0180-exit
>               go to 0300-return-cics
>            end-if
> 
>            move ws-rate-age            to ws-limit-issue-age
> 
>            EXEC SQL
>               SELECT distinct top 1
>                  AttainedAge,
>                  MaxTerm,
>                  MaxJntTerm,
>                  MaxMoBen,
>                  MaxTotBen,
>                  PartialCoverage,
>                  CheckEligibility,
>                  EligibilityMaxTerm,
>                  AllowTruncated
>               INTO
>                  :ws-limit-att-age,
>                  :ws-limit-max-term,
>                  :ws-limit-max-jnt-term,
>                  :ws-limit-max-mo-ben,
>                  :ws-limit-max-tot-ben,
>                  :ws-limit-partial-cov   :nu-partial-cov,
>                  :ws-limit-check-elig    :nu-check-elig,
>                  :ws-limit-elig-max-term,
>                  :ws-limit-allow-truncated  :nu-allow-trunc
>               FROM
>                  FormLimits
>               WHERE
>                  Limit           = :ws-limit-name
>                  and CovType     = :ws-limit-cov-type
>                  and LoIssueAge <= :ws-limit-issue-age
>                  and HiIssueAge >= :ws-limit-issue-age
>            end-exec
> 
>            if sqlcode not = 0
>               display "Error: cannot find limits " ws-limit-name
>               display ' sql retrun code ' sqlcode
>               display ' sql err mess    ' sqlerrmc
>               move 4                   to ws-error-sub
>               move ws-limit-name       to ws-error-sup
>               perform 0180-error-handle
>                                        thru 0180-exit
>               go to 0300-return-cics
>            end-if
> 
>            move ws-limit-lo-age        to ws-di-limit-lo-age
>            move ws-limit-hi-age        to ws-di-limit-hi-age
>            move ws-limit-att-age       to ws-di-limit-att-age
>            move ws-limit-max-term      to ws-di-limit-max-term
>            move ws-limit-max-jnt-term  to ws-di-limit-max-jnt-term
>            move ws-limit-max-mo-ben    to ws-di-limit-max-mo-ben
>            move ws-limit-max-tot-ben   to ws-di-limit-max-tot-ben
>            move ws-limit-partial-cov   to ws-di-limit-partial-cov
>            move ws-limit-check-elig    to ws-di-limit-check-elig
>            move ws-limit-elig-max-term to ws-di-limit-elig-max-term
>            move ws-limit-allow-truncated
>                                        to ws-di-limit-allow-truncated
> 
>            if ws-di-limit-check-elig = 0
>               go to 0097-continue
>            end-if
> 
>            if ws-rate-loan-term <= ws-di-limit-elig-max-term
>               continue
>            else
>               move 31                  to ws-error-sub
>               move ' '                 to ws-error-sup
>               perform 0180-error-handle
>                                        thru 0180-exit
>               go to 0300-return-cics
>            end-if
> 
>       *    if (ws-rate-ah-term * ws-rate-per-pmt) <=
>       *                  ws-di-limit-max-tot-ben
>       *       continue
>       *    else
>       *       move 32                  to ws-error-sub
>       *       move '- Di ToT Ben '     to ws-error-sup
>       *       perform 0180-error-handle
>       *                                thru 0180-exit
>       *       go to 0300-return-cics
>       *    end-if
> 
>            .
>        0097-continue.
> 
>            move ' '                    to ws-recalc-di
>            if ws-di-limit-allow-truncated = 0
>               go to 0097-exit
>            end-if
> 
>            if ws-att-age <= ws-di-limit-att-age
>               go to 0097-exit
>            end-if
> 
>            compute ws-rate-ah-term = ws-rate-ah-term -
>               ((ws-att-age - ws-di-limit-att-age) * 12)
> 
>            set recalc-di to true
> 
>            if (ws-rate-lf-term > zeros)
>               and (ws-rate-ah-term <> ws-rate-lf-term)
>               move ws-rate-lf-term     to ws-rate-ah-term
>            end-if
> 
>       *    if ws-rate-per-pmt <= ws-limit-max-mo-ben
>       *       continue
>       *    else
>       *       move 8                   to ws-error-sub
>       *       move '- Ah Benefit '     to ws-error-sup
>       *       perform 0180-error-handle
>       *                                thru 0180-exit
>       *       go to 0300-return-cics
>       *    end-if
>       *
>       *    if ws-rate-ah-term <= ws-limit-max-term
>       *       continue
>       *    else
>       *       move 7                   to ws-error-sub
>       *       move '- Ah Term '        to ws-error-sup
>       *       perform 0180-error-handle
>       *                                thru 0180-exit
>       *       go to 0300-return-cics
>       *    end-if
>       *
>       *    if ws-att-age <= ws-limit-att-age
>       *       continue
>       *    else
>       *       move 5                   to ws-error-sub
>       *       move ws-att-age          to ws-error-sup
>       *       perform 0180-error-handle
>       *                                thru 0180-exit
>       *       go to 0300-return-cics
>       *    end-if
1515c2535
<        0100-exit.
---
>        0097-exit.
1589,1590c2609,2610
<            display ' ben  in *' ws-work-in '*'
<            display ' ben  out *' ws-work-out '*'
---
>       *    display ' ben  in *' ws-work-in '*'
>       *    display ' ben  out *' ws-work-out '*'
1595,1596c2615,2616
<            display ' ln term in *' ws-work-in '*'
<            display ' ln term out *' ws-work-out '*'
---
>       *    display ' ln term in *' ws-work-in '*'
>       *    display ' ln term out *' ws-work-out '*'
1601,1602c2621,2622
<            display ' lf  term in *' ws-work-in '*'
<            display ' lf  term out *' ws-work-out '*'
---
>       *    display ' lf  term in *' ws-work-in '*'
>       *    display ' lf  term out *' ws-work-out '*'
1607,1608c2627,2628
<            display ' ah  term in *' ws-work-in '*'
<            display ' ah  term out *' ws-work-out '*'
---
>       *    display ' ah  term in *' ws-work-in '*'
>       *    display ' ah  term out *' ws-work-out '*'
1613,1614c2633,2634
<            display ' wait day in *' ws-work-in '*'
<            display ' wait day out *' ws-work-out '*'
---
>       *    display ' wait day in *' ws-work-in '*'
>       *    display ' wait day out *' ws-work-out '*'
1619,1620c2639,2640
<            display ' crit per in *' ws-work-in '*'
<            display ' crit per out *' ws-work-out '*'
---
>       *    display ' crit per in *' ws-work-in '*'
>       *    display ' crit per out *' ws-work-out '*'
1625,1626c2645,2646
<            display ' crit per in *' ws-work-in '*'
<            display ' crit per out *' ws-work-out '*'
---
>       *    display ' pmts per yr *' ws-work-in '*'
>       *    display ' pmts per yr  *' ws-work-out '*'
1631,1632c2651,2652
<            display ' ins apr  in *' ws-work-in '*'
<            display ' ins apr  out *' ws-work-out '*'
---
>       *    display ' ins apr  in *' ws-work-in '*'
>       *    display ' ins apr  out *' ws-work-out '*'
1730c2750
<        0200-calc-payment.
---
>        0180-error-handle.
1732,1737c2752,2923
<       ***____________________________________________________________***
<       **(-                                                          -)**
<       **(-   Right now this works for FL net pay +2 only            -)**
<       **(-                                                          -)**
<       ***____________________________________________________________***
<            move 2                      to plus2
---
>            move ws-table-error-no (ws-error-sub)
>                                        to ws-return-error-no
>            move spaces                 to ws-return-error-mess
>            string
>               ws-table-error-mess (ws-error-sub)
>               ws-error-sup
>               delimited by '  ' into ws-return-error-mess
>            end-string
> 
>            .
>        0180-exit.
>            exit.
> 
>        0190-final-limit-check.
> 
>            if ws-rate-in-lf-ben-code (1:1) = ' '
>               go to 0190-final-ah
>            end-if
> 
>       *    display ' rate loan amt  ' ws-rate-loan-amt
>       *    display ' max lf benefit ' ws-max-lf-benefit
>       *    display ' lf prem        ' ws-rate-lf-prem
>       *    display ' ah prem        ' ws-rate-ah-prem
>       *    display ' lf limit max   ' ws-lf-limit-max-benefit
>       *    display ' att age        ' ws-att-age
>       *    display ' limit att age  ' ws-lf-limit-att-age
>       *    display ' rate lf term   ' ws-rate-lf-term
>       *    display ' limit max trm  ' ws-lf-limit-max-term
>            if ws-lf-limit-check-elig <> 0
>               if (ws-rate-loan-amt +
>                   ws-rate-lf-prem +
>                   ws-rate-ah-prem)  <= ws-lf-limit-max-benefit
>                  continue
>               else
>                  move 32               to ws-error-sub
>                  move '- Lf Benefit '  to ws-error-sup
>                  perform 0180-error-handle
>                                        thru 0180-exit
>                  go to 0300-return-cics
>               end-if
>            end-if
> 
>            if (ws-max-lf-benefit <= ws-lf-limit-max-benefit)
>               or (ws-lf-limit-max-benefit = zeros)
>               continue
>            else
>               move 10                  to ws-error-sub
>               move '- Lf Benefit '     to ws-error-sup
>               perform 0180-error-handle
>                                        thru 0180-exit
>               go to 0300-return-cics
>            end-if
> 
>            if ws-rate-lf-term <= ws-lf-limit-max-term
>               continue
>            else
>               move 9                   to ws-error-sub
>               move '- Lf Term '        to ws-error-sup
>               perform 0180-error-handle
>                                        thru 0180-exit
>               go to 0300-return-cics
>            end-if
> 
>            if (ws-att-age <= ws-lf-limit-att-age)
>               or (ws-lf-limit-att-age = zeros)
>               continue
>            else
>               move 5                   to ws-error-sub
>               move ws-att-age          to ws-error-sup
>               perform 0180-error-handle
>                                        thru 0180-exit
>               go to 0300-return-cics
>            end-if
> 
>            .
>        0190-final-ah.
> 
>            if ws-rate-in-ah-ben-code (1:1) = ' '
>               go to 0190-exit
>            end-if
> 
>       *    display ' made it to 0190-final-ah ' ws-di-limit-check-elig
>       *    display ' rate loan amt      ' ws-rate-loan-amt
>       *    display ' rate ah prem       ' ws-rate-ah-prem
>       *    display ' di limit max totben' ws-di-limit-max-tot-ben
>       *    display ' rate ah term       ' ws-rate-ah-term
>       *    display ' rate per pmt       ' ws-rate-per-pmt
>       *    display ' rate loan term     ' ws-rate-loan-term
> 
>            if ws-di-limit-check-elig <> 0
>               if (ws-rate-loan-amt +
>                   ws-rate-ah-prem)  <= ws-di-limit-max-tot-ben
>                  continue
>               else
>                  move 32               to ws-error-sub
>                  move '- Di Benefit '  to ws-error-sup
>                  perform 0180-error-handle
>                                        thru 0180-exit
>                  go to 0300-return-cics
>               end-if
>               if ws-rate-state = 'FL'
>                  if ((ws-rate-loan-term * ws-rate-per-pmt) <=
>                             ws-di-limit-max-tot-ben)
>                     continue
>                  else
>                     move 32            to ws-error-sub
>                     move '- Di ToT Ben ' to ws-error-sup
>                     perform 0180-error-handle
>                                        thru 0180-exit
>                     go to 0300-return-cics
>                  end-if
>               end-if
>            end-if
> 
>            if ws-max-ah-benefit <= ws-di-limit-max-mo-ben
>               continue
>            else
>               move 11                  to ws-error-sub
>               move '- Ah Benefit '     to ws-error-sup
>               perform 0180-error-handle
>                                        thru 0180-exit
>               go to 0300-return-cics
>            end-if
> 
>            if ws-rate-sin-jnt-ah = 'J'
>               if ws-rate-ah-term <= ws-di-limit-max-jnt-term
>                  continue
>               else
>                  move 8                   to ws-error-sub
>                  move '- Ah TermJNT'      to ws-error-sup
>                  perform 0180-error-handle
>                                           thru 0180-exit
>                  go to 0300-return-cics
>               end-if
>            else
>               if ws-rate-ah-term <= ws-di-limit-max-term
>                  continue
>               else
>                  move 9                   to ws-error-sub
>                  move '- Ah Term '        to ws-error-sup
>                  perform 0180-error-handle
>                                           thru 0180-exit
>                  go to 0300-return-cics
>               end-if
>            end-if
> 
>            if (ws-rate-ah-term * ws-max-ah-benefit) <=
>                          ws-di-limit-max-tot-ben
>               continue
>            else
>               move 13                  to ws-error-sub
>               move '- Ah Tot Ben '     to ws-error-sup
>               perform 0180-error-handle
>                                        thru 0180-exit
>               go to 0300-return-cics
>            end-if
> 
>            if ws-att-age <= ws-di-limit-att-age
>               continue
>            else
>               move 5                   to ws-error-sub
>               move ws-att-age          to ws-error-sup
>               perform 0180-error-handle
>                                        thru 0180-exit
>               go to 0300-return-cics
>            end-if
> 
>            .
>        0190-exit.
>            exit.
> 
>        0200-calc-NP-payment.
1741a2928,2930
>            if m = zeros
>               move ws-rate-ah-term to m
>            end-if
1744a2934,2936
>            if i = zeros
>               move .0000001            to i
>            end-if
1755,1756c2947,2949
<            COMPUTE A-PRM-ANGLE-N ROUNDED =
<               A-ANGLE-N / GAMMA
---
>            COMPUTE A-PRM-ANGLE-N ROUNDED = A-ANGLE-N / GAMMA
>            compute ws-rate-loan-pmt rounded =
>               l / a-prm-angle-n
1758,1759c2951,2958
<            COMPUTE TEMP-VALUE-3 ROUNDED =
<               M + ((D - DPP) / DPP)
---
>       ***____________________________________________________________***
>       **(-                                                          -)**
>       **(-   This section is for TX Net Pay + 1                     -)**
>       **(-   This formula is designed to use the actual MOB rate    -)**
>       **(- and then applies the discount using x.                   -)**
>       **(-   This formula works for net and net truncated.          -)**
>       **(-                                                          -)**
>       ***____________________________________________________________***
1761,1762c2960,2962
<            compute mob rounded =
<               (lf-rate / (m + (ppy/12))) * 2
---
>            if ws-rate-state <> 'TX'
>               go to 0200-try-oh
>            end-if
1764,1766c2964,2968
<       *    COMPUTE MOB ROUNDED =
<       *       (lf-rate *
<       *       (TEMP-VALUE-3 / PPY)) / ((M + (PPY / 12)) / 2)
---
>            COMPUTE X ROUNDED = 1 / (1 + TX-DISCOUNT-RATE)
> 
>            COMPUTE V-TO-N ROUNDED = (1 / (1 + I)) ** N
>            COMPUTE X-TO-M ROUNDED = X ** M
>            COMPUTE V-TO-N-M ROUNDED = (1 / (1 + I)) ** (N - M)
1769c2971
<                (M - (A-ANGLE-N - A-ANGLE-N-M)) / I
---
>                (1 + I) / I
1772c2974
<                1 + (PLUS2 * I * (PPY / 12))
---
>                (X-TO-M - 1) / (X - 1)
1774,1786c2976,2978
<            display ' L         ' l
<            display ' anglen       ' a-angle-n
<            display ' gamma        ' gamma
<            display ' tv3          ' temp-value-3
<            display 'a-prm-angle-n ' a-prm-angle-n
<            display ' tv1          ' temp-value-1
<            display ' mob          ' mob
<            display ' tv2          ' temp-value-2
<            display ' ah rate      ' ah-rate
<            display ' m            ' m
<            COMPUTE pmt ROUNDED =
<                L / (A-PRM-ANGLE-N - (TEMP-VALUE-1 * (MOB / 100) *
<                TEMP-VALUE-2) - ((ah-rate * M) / 100))
---
>            COMPUTE TEMP-VALUE-3 ROUNDED =
>                ((X-TO-M * V-TO-N-M) - V-TO-N) /
>                ((X * (1 + I)) - 1)
1788,1789c2980,2981
<            COMPUTE DL-PREMIUM ROUNDED = Pmt *
<                TEMP-VALUE-1 * (MOB / 100) * TEMP-VALUE-2
---
>            COMPUTE TEMP-VALUE-4 ROUNDED =
>                M * (AH-RATE / 100)
1791,1795c2983,2984
<            COMPUTE AH-PREMIUM ROUNDED =
<                Pmt * M * (AH-RATE / 100)
<  
<            COMPUTE T-FINANCED =
<                L + DL-PREMIUM + AH-PREMIUM
---
>            COMPUTE TEMP-VALUE-5 ROUNDED =
>                A-PRM-ANGLE-N * (1 + I)
1797c2986,2988
<            COMPUTE T-PAYMENTS = N * Pmt
---
>            COMPUTE LIFE-FACTOR ROUNDED =
>                TEMP-VALUE-1 * (TEMP-VALUE-2 - TEMP-VALUE-3) *
>                (lf-rate / 1000)
1799,1803c2990,2991
<            move pmt                    to ws-rate-per-pmt
<            move dl-premium             to ws-rate-lf-prem
<            move ah-premium             to ws-rate-ah-prem
<            move t-financed             to ws-rate-tot-financed
<            move t-payments             to ws-rate-tot-pmts
---
>            COMPUTE PMT ROUNDED =
>                L / (A-PRM-ANGLE-N - LIFE-FACTOR - TEMP-VALUE-4)
1805,1811c2993,2994
<            display ' lf-rate       ' lf-rate
<            display ' ah-rate       ' ah-rate
<            display ' payment       ' pmt
<            display ' lf prem       ' ws-rate-lf-prem
<            display ' ah prem       ' ws-rate-ah-prem
<            display ' tot financed  ' ws-rate-tot-financed
<            display ' tot payments  ' ws-rate-tot-pmts
---
>            COMPUTE SINGLE-FACTOR ROUNDED =
>                (LIFE-FACTOR * 100) / TEMP-VALUE-5
1814,1815c2997
<        0200-exit.
<            exit.
---
>        0200-check-tx-partial.
1817c2999,3006
<        0300-RETURN-CICS.
---
>            if ws-lf-limit-partial-cov = 0
>               display ' no partial coverage '
>               move pmt                 to dispmt
>                                           lifepmt1
>                                           lifepmt2
>                                           newpmt
>               go to 0200-carry-on-tx
>            end-if
1819,1821c3008,3013
<            move ws-return-string       to dfhcommarea
<            exec cics return end-exec
<            goback
---
>            if pmt < ws-di-limit-max-mo-ben
>               move pmt                 to dispmt
>            else
>               move ws-di-limit-max-mo-ben
>                                        to dispmt
>            end-if
1823,1825c3015,3018
<            .
<        0300-exit.
<            exit.
---
>            if (ws-di-limit-max-tot-ben / n) < dispmt
>               compute dispmt rounded =
>                  (ws-di-limit-max-tot-ben / n) - .005
>            end-if
1827,1832c3020,3022
<        6000-CONNECT-TO-DB.
<       
<       ***-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_***
<       ***                                                            ***
<       ***                                                            ***
<       ***_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-***
---
>            compute lifepmt1 rounded =
>               (l + (single-factor * (pmt * a-prm-angle-n * (1 + 1 * i))
>               / 100) + dispmt * m * ah-rate / 100) / a-prm-angle-n
1834,1841c3024,3028
<            MOVE 'NTSQLTST2_CrtManage'  TO SVR
<            move 'sa'                   to usr
<            move 'sql2008r2'            to pass
< 
<            if ws-kix-myenv = 'cid1p'
<               MOVE 'NTCSO2_CrtManage'  TO SVR
<               move 'sa'                to usr
<               move 'ntcso2'            to pass
---
>            if (ws-lf-limit-max-benefit / a-prm-angle-n) < lifepmt1
>               compute lifepmt1 rounded =
>                  ws-lf-limit-max-benefit / a-prm-angle-n
>               move ws-lf-limit-max-benefit
>                                        to ws-max-lf-benefit
1844c3031,3821
<            string
---
>            compute newpmt rounded =
>               (l + (single-factor * (lifepmt1 * a-prm-angle-n *
>               (1 + 1 * i)) / 100) + dispmt * m * ah-rate / 100) /
>               a-prm-angle-n
> 
>            .
>        0200-carry-on-tx.
> 
>            COMPUTE DL-PREMIUM ROUNDED =
>                SINGLE-FACTOR *
>                ((lifePMT1 * TEMP-VALUE-5) / 100)
> 
>            COMPUTE AH-PREMIUM ROUNDED =
>                disPMT * TEMP-VALUE-4
> 
>       *    display 'discount       ' tx-discount-rate
>       *    display ' v to n        ' v-to-n
>       *    display ' x to m        ' x-to-m
>       *    display ' v to n - m    ' v-to-n-m
>       *    display ' anglen        ' a-angle-n
>       *    display ' gamma         ' gamma
>       *    display ' anglend       ' a-prm-angle-n
>       *    display ' tv1           ' temp-value-1
>       *    display ' tv2           ' temp-value-2
>       *    display ' tv3           ' temp-value-3
>       *    display ' tv4           ' temp-value-4
>       *    display ' tv5           ' temp-value-5
>       *    display ' lf factor     ' life-factor
>       *    display ' payment       ' pmt
>       *    display ' dis pmt       ' dispmt
>       *    display ' lifepmt1      ' lifepmt1
>       *    display ' new pmt       ' newpmt
>       *    display ' single factor ' single-factor
>       *    display ' lf prem       ' dl-premium
>       *    display ' disab prem    ' ah-premium
> 
>            go to 0200-continue
> 
>            .
>        0200-try-oh.
> 
>       ***____________________________________________________________***
>       **(-                                                          -)**
>       **(-   This section is for OH, AK, KY, MA, MN, NH, NV         -)**
>       **(-     and WA                                               -)**
>       **(-                                                          -)**
>       ***____________________________________________________________***
> 
>            if ws-rate-state <> 'OH' and 'AK' and 'KY' and 'MA' and
>                                'MN' and 'NH' and 'NV' and 'WA'
>               go to 0200-try-al
>            end-if
> 
>            evaluate true
>               when ws-rate-state = 'OH' or 'AK' or 'KY' or 'NH' or
>                                    'NV'
>                  move 2                to plus2
>               when ws-rate-state = 'MN'
>                  move 1                to plus2
>               when ws-rate-state = 'MA' or 'WA'
>                  move 0                to plus2
>               when other
>                  move 1                to plus2
>            end-evaluate
> 
>            COMPUTE TEMP-VALUE-1 ROUNDED =
>               ((M - (A-ANGLE-N - A-ANGLE-N-M)) / I)
>            compute temp-value-2 rounded = 
>               (temp-value-1 * lf-rate * (1 + (plus2 * i))) / 1000
>       *    COMPUTE TEMP-VALUE-2 ROUNDED =
>       *       (lf-rate / 1000) * (1 + (PLUS2 * I))
>            COMPUTE TEMP-VALUE-3 ROUNDED =
>               M * (AH-RATE / 100)
> 
>            COMPUTE PMT ROUNDED = L /
>               (A-PRM-ANGLE-N -
>               TEMP-VALUE-2 - TEMP-VALUE-3)
> 
>       *    COMPUTE PMT ROUNDED = L /
>       *       (A-PRM-ANGLE-N -
>       *       (TEMP-VALUE-1 * TEMP-VALUE-2) - TEMP-VALUE-3)
> 
>            if ws-lf-limit-partial-cov = 0
>               move pmt                 to dispmt
>                                           lifepmt1
>                                           lifepmt2
>                                           newpmt
>            end-if
> 
>            .
>        0200-carry-on-oh.
> 
>            COMPUTE DL-PREMIUM ROUNDED =
>               PMT * TEMP-VALUE-2
> 
>       *    COMPUTE DL-PREMIUM ROUNDED =
>       *       PMT * TEMP-VALUE-1 * TEMP-VALUE-2
> 
>            COMPUTE AH-PREMIUM ROUNDED =
>               PMT * m * (ah-rate / 100)
> 
>       *    COMPUTE AH-PREMIUM ROUNDED =
>       *       PMT * TEMP-VALUE-3
> 
>       *    display ' plus2      ' plus2
>       *    display ' days       ' d
>       *    display ' anglen     ' A-ANGLE-N
>       *    display ' anglend    ' a-prm-angle-n
>       *    display ' gamma      ' gamma
>       *    display ' tv1        ' temp-value-1
>       *    display ' tv2        ' temp-value-2
>       *    display ' tv3        ' temp-value-3
>       *    display ' pmt        ' pmt
>       *    display ' lf prem    ' dl-premium
>       *    display ' ah prem    ' ah-premium
> 
>            go to 0200-continue
> 
>            .
>        0200-try-al.
> 
>       ***____________________________________________________________***
>       **(-                                                          -)**
>       **(-   This section is for AL STD RATES.                      -)**
>       **(-                                                          -)**
>       ***____________________________________________________________***
> 
>            if ws-rate-state <> 'AL'
>               go to 0200-try-ME
>            end-if
> 
>            COMPUTE TEMP-VALUE-1 ROUNDED =
>                M - (A-ANGLE-N - A-ANGLE-N-M) + (I * M)
>       
>            COMPUTE TEMP-VALUE-2 ROUNDED =
>                TEMP-VALUE-1 / I * lf-RATE
>       
>            COMPUTE TEMP-VALUE-3 ROUNDED =
>                M * (AH-RATE / 100)
>            COMPUTE pmt ROUNDED =
>                L /
>                (A-PRM-ANGLE-N - (TEMP-VALUE-2 / 1000) -
>                TEMP-VALUE-3)
> 
> 
>            if ws-lf-limit-partial-cov = 0
>               move pmt                 to dispmt
>                                           lifepmt1
>                                           lifepmt2
>                                           newpmt
>            end-if
> 
>            .
>        0200-carry-on-al.
> 
>            COMPUTE DL-PREMIUM ROUNDED =
>                PMT * (TEMP-VALUE-2 / 1000)
>            COMPUTE AH-PREMIUM ROUNDED =
>                PMT * TEMP-VALUE-3
> 
>            go to 0200-continue
> 
>            .
>        0200-try-ME.
> 
>       ***____________________________________________________________***
>       **(-                                                          -)**
>       **(-   This section is for ME STD RATES.                      -)**
>       **(-                                                          -)**
>       ***____________________________________________________________***
> 
>            if ws-rate-state <> 'ME'
>               go to 0200-try-IN
>            end-if
> 
>            COMPUTE TEMP-DISCOUNT-RATE ROUNDED =
>                1 / (1 + ((0.045 * N) / 24))
> 
>            COMPUTE TEMP-VALUE-1 ROUNDED =
>                (N - A-ANGLE-N) / I
> 
>            COMPUTE TEMP-VALUE-2 ROUNDED =
>                TEMP-VALUE-1 * (lf-rate / 1000) * TEMP-DISCOUNT-RATE
> 
>            COMPUTE TEMP-VALUE-3 ROUNDED =
>                (N * AH-RATE) / 100
> 
>            COMPUTE PMT ROUNDED =
>                L / (A-PRM-ANGLE-N - TEMP-VALUE-2 - TEMP-VALUE-3)
> 
>            if ws-lf-limit-partial-cov = 0
>               move pmt                 to dispmt
>                                           lifepmt1
>                                           lifepmt2
>                                           newpmt
>            end-if
> 
>            .
>        0200-carry-on-me.
> 
>            COMPUTE DL-PREMIUM ROUNDED =
>                PMT * TEMP-VALUE-2
> 
>            COMPUTE AH-PREMIUM ROUNDED =
>                PMT * TEMP-VALUE-3
> 
>            go to 0200-continue
> 
>            .
>        0200-try-IN.
> 
>       ***____________________________________________________________***
>       **(-                                                          -)**
>       **(-   This section is for IN, MT, ND, NJ, AZ, RI, VT and VA  -)**
>       **(-                                                          -)**
>       ***____________________________________________________________***
> 
>            if ws-rate-state <> 'IN' and 'MT' and 'ND' and 'NJ' and
>                                'AZ' and 'RI' and 'VT' and 'VA'
>               go to 0200-try-PA
>            end-if
> 
>            evaluate true
>               when ws-rate-state = 'MT' or 'AZ' or 'RI' or 'VT'
>                  MOVE 2                TO PLUS2
>               when ws-rate-state = 'IN' or 'ND' or 'VA'
>                  MOVE 0                TO PLUS2
>               when ws-rate-state = 'NJ'
>                  move 1                to plus2
>            end-evaluate
> 
>            COMPUTE V-TO-N ROUNDED = (1 / (1 + I)) ** N
> *
>            COMPUTE TEMP-DISCOUNT-RATE ROUNDED =
>                ws-DISCOUNT-RATE * 12 / PPY
> 
>            COMPUTE X ROUNDED = 1 / (1 + TEMP-DISCOUNT-RATE)
>            COMPUTE X-TO-N ROUNDED = X ** N
> 
>            COMPUTE TEMP-VALUE-1 ROUNDED =
>                (X-TO-N - V-TO-N) / ((X * (1 + I)) - 1)
>            COMPUTE TEMP-VALUE-2 ROUNDED =
>                (X-TO-N - 1) / (X - 1)
>            COMPUTE TEMP-VALUE-4 ROUNDED =
>                TEMP-VALUE-2 - TEMP-VALUE-1
>            COMPUTE TEMP-VALUE-5 ROUNDED =
>                1 + ((PLUS2 * PPY / 12) * I)
> 
>            COMPUTE LIFE-FACTOR ROUNDED =
>                (TEMP-VALUE-5 / I) * TEMP-VALUE-4 *
>                (lf-rate / 1000)
> 
>            COMPUTE TEMP-VALUE-3 ROUNDED =
>                (N * AH-RATE) / 100
> 
>            COMPUTE SINGLE-FACTOR ROUNDED =
>                (LIFE-FACTOR * 100) / (A-ANGLE-N * TEMP-VALUE-5)
> 
>            COMPUTE PMT ROUNDED =
>                L / (A-PRM-ANGLE-N - LIFE-FACTOR - TEMP-VALUE-3)
> 
>            if ws-lf-limit-partial-cov = 0
>               move pmt                 to dispmt
>                                           lifepmt1
>                                           lifepmt2
>                                           newpmt
>            end-if
> 
>            .
>        0200-carry-on-in.
> 
>            COMPUTE DL-PREMIUM ROUNDED =
>                SINGLE-FACTOR *
>                ((PMT * A-ANGLE-N * TEMP-VALUE-5) / 100)
> 
>            COMPUTE AH-PREMIUM ROUNDED =
>                PMT * TEMP-VALUE-3
> 
>            go to 0200-continue
> 
>            .
>        0200-try-PA.
> 
>       ***____________________________________________________________***
>       **(-                                                          -)**
>       **(-   This section is for PA.                                -)**
>       **(-                                                          -)**
>       ***____________________________________________________________***
> 
>            if ws-rate-state <> 'PA'
>               go to 0200-try-all-other
>            end-if
> 
>            evaluate true
>               when ws-rate-state = 'PA'
>                  MOVE 0                TO PLUS2
>               when other
>                  move 1                to plus2
>            end-evaluate
> 
>            COMPUTE TEMP-VALUE-1 ROUNDED =
>                1 + (ws-DISCOUNT-RATE * (M / 24))
> 
>            COMPUTE TEMP-VALUE-2 ROUNDED =
>                1 / (10 * TEMP-VALUE-1)
> 
>            COMPUTE TEMP-VALUE-3 ROUNDED =
>                (M * AH-RATE) / 100
> 
>            COMPUTE TEMP-VALUE-4 ROUNDED =
>                (M - (A-ANGLE-N - A-ANGLE-N-M)) / I
> 
>            COMPUTE TEMP-VALUE-5 ROUNDED =
>                (lf-rate / 100) * (1 + (PLUS2 * ws-rate-apr / 12))
> 
>            COMPUTE TEMP-VALUE-6 ROUNDED =
>                TEMP-VALUE-4 * TEMP-VALUE-2 * TEMP-VALUE-5
> 
>            COMPUTE PMT ROUNDED =
>                L / (A-PRM-ANGLE-N - TEMP-VALUE-6 - TEMP-VALUE-3)
> 
>            if ws-lf-limit-partial-cov = 0
>               move pmt                 to dispmt
>                                           lifepmt1
>                                           lifepmt2
>                                           newpmt
>            end-if
> 
>            .
>        0200-carry-on-PA.
> 
>            COMPUTE DL-PREMIUM ROUNDED =
>                PMT * TEMP-VALUE-6
> 
>            COMPUTE AH-PREMIUM ROUNDED =
>                PMT * TEMP-VALUE-3
> 
>            go to 0200-continue
> 
>            .
>        0200-try-all-other.
> 
>       ***____________________________________________________________***
>       **(-                                                          -)**
>       **(-   This works for all states other than listed above      -)**
>       **(-  Haven't figured out all the states' extra months        -)**
>       **(-  interest yet.                                           -)**
>       **(-                                                          -)**
>       ***____________________________________________________________***
> 
>            evaluate true
>               when ws-rate-state = 'SC'
>                  move 1                to plus2
>               when other
>                  move 2                to plus2
>            end-evaluate
> 
>            COMPUTE TEMP-VALUE-3 ROUNDED =
>               M + ((D - DPP) / DPP)
> 
>       ***____________________________________________________________***
>       **(-                                                          -)**
>       **(-      OK, the below formula works in conjunction with     -)**
>       **(-    other than 30 days to first payment. Since Logic      -)**
>       **(-    gives me the actual rate, I have to convert it to the -)**
>       **(-   annual rate so it works just like QC.                  -)**
>       **(-                                                          -)**
>       **(-                                                          -)**
>       ***____________________________________________________________***
> 
>            compute mnthly-rate rounded = lf-rate / m
>            compute mob rounded = mnthly-rate * 12
> 
>            compute mob rounded = lf-rate / (m / 12)
> 
>       *    compute mob rounded =
>       *       (lf-rate / (m + (ppy/12))) * 2
> 
>            COMPUTE MOB ROUNDED =
>               (mob *
>               (TEMP-VALUE-3 / PPY)) / ((M + (PPY / 12)) / 2)
> 
>            COMPUTE TEMP-VALUE-1 ROUNDED =
>                (M - (A-ANGLE-N - A-ANGLE-N-M)) / I
> 
>            COMPUTE TEMP-VALUE-2 ROUNDED =
>                1 + (PLUS2 * I * (PPY / 12))
> 
>       *    display ' L         ' l
>       *    display ' anglen       ' a-angle-n
>       *    display ' days(d)      ' d
>       *    display ' gamma        ' gamma
>       *    display ' tv3          ' temp-value-3
>       *    display 'a-prm-angle-n ' a-prm-angle-n
>       *    display ' tv1          ' temp-value-1
>       *    display ' mob          ' mob
>       *    display ' tv2          ' temp-value-2
>       *    display ' ah rate      ' ah-rate
>       *    display ' m            ' m
>            COMPUTE pmt ROUNDED =
>                L / (A-PRM-ANGLE-N - (TEMP-VALUE-1 * (MOB / 100) *
>                TEMP-VALUE-2) - ((ah-rate * M) / 100))
> 
>            .
>        0200-check-partial.
> 
>            if ws-lf-limit-partial-cov = 0
>               move pmt                 to dispmt
>                                           lifepmt1
>                                           lifepmt2
>                                           newpmt
>               go to 0200-carry-on-all-other
>            end-if
> 
>            if pmt < ws-di-limit-max-mo-ben
>               move pmt                 to dispmt
>            else
>               move ws-di-limit-max-mo-ben
>                                        to dispmt
>            end-if
> 
>            if (ws-di-limit-max-tot-ben / m) < dispmt
>               compute dispmt rounded =
>                  (ws-di-limit-max-tot-ben / m) - .005
>            end-if
> 
>            compute lifepmt1 rounded =
>               (l + pmt * temp-value-1 * mob / 100 * temp-value-2 +
>               dispmt * (ah-rate * m) / 100) / a-prm-angle-n
> 
>            if (ws-lf-limit-max-benefit / a-prm-angle-n) < lifepmt1
>               compute lifepmt1 rounded =
>                  ws-lf-limit-max-benefit / a-prm-angle-n
>               move ws-lf-limit-max-benefit
>                                        to ws-max-lf-benefit
>            end-if
> 
>            compute newpmt rounded =
>               (l +lifepmt1 * temp-value-1 * mob / 100 * temp-value-2 +
>               dispmt * (ah-rate * m) / 100) / a-prm-angle-n
> 
>            .
>        0200-carry-on-all-other.
> 
>            COMPUTE DL-PREMIUM ROUNDED = lifepmt1 *
>                TEMP-VALUE-1 * (MOB / 100) * TEMP-VALUE-2
> 
>            COMPUTE AH-PREMIUM ROUNDED =
>                disPmt * M * (AH-RATE / 100)
>  
>            move pmt                    to ws-rate-per-pmt
>            move dl-premium             to ws-rate-lf-prem
>            move ah-premium             to ws-rate-ah-prem
>            move t-financed             to ws-rate-tot-financed
>            move t-payments             to ws-rate-tot-pmts
> 
>            .
>        0200-continue.
> 
>            COMPUTE T-FINANCED =
>                L + DL-PREMIUM + AH-PREMIUM
> 
>            COMPUTE T-PAYMENTS = N * newPmt
> 
>            if ws-max-lf-benefit = zeros
>               move t-financed          to ws-max-lf-benefit
>            end-if
> 
>            move newpmt                 to ws-rate-per-pmt
>            move dispmt                 to ws-max-ah-benefit
>            move dl-premium             to ws-rate-lf-prem
>            move ah-premium             to ws-rate-ah-prem
>            move t-financed             to ws-rate-tot-financed
>            move t-payments             to ws-rate-tot-pmts
> 
>       *    display ' new pmt       ' newpmt
>       *    display ' dis pmt       ' dispmt
>       *    display ' lifepmt1      ' lifepmt1
>       *    display ' lf-rate       ' lf-rate
>       *    display ' ah-rate       ' ah-rate
>       *    display ' payment       ' pmt
>       *    display ' lf prem       ' ws-rate-lf-prem
>       *    display ' ah prem       ' ws-rate-ah-prem
>       *    display ' tot financed  ' ws-rate-tot-financed
>       *    display ' tot payments  ' ws-rate-tot-pmts
> 
>            .
>        0200-exit.
>            exit.
> 
>        0250-calc-GP-payment.
> 
>       *  States with special coding in quick-calc for Gross Pay
>       *   AZ
>       *   IN
>       *   MT
>       *   ND
>       *   NJ
>       *   PA
> 
>       ***____________________________________________________________***
>       **(-                                                          -)**
>       **(-   Right now this should work for all states other than   -)**
>       **(-    those listed above.                                   -)**
>       **(-                                                          -)**
>       ***____________________________________________________________***
> 
>            move ws-rate-loan-amt       to l
>            move ws-rate-loan-term      to n
>            move ws-rate-lf-term        to m
>            if m = zeros
>               move ws-rate-ah-term     to m
>            end-if
>            move ws-rate-pmts-per-year  to ppy
>            move 30                     to dpp
>            compute i = ws-rate-apr / (ppy * 100)
> 
>            if i = 0
>               move n                   to a-angle-n
>            else
>               COMPUTE A-ANGLE-N ROUNDED =
>                  (1 - ((1 / (1 + I)) ** N)) / I
>            end-if
> 
>            COMPUTE GAMMA ROUNDED =
>                (1 + ((D * I) / DPP)) / (1 + I)
> 
>            COMPUTE A-PRM-ANGLE-N ROUNDED =
>               A-ANGLE-N / GAMMA
> 
>            compute ws-rate-loan-pmt rounded =
>               l / a-prm-angle-n
> 
>            COMPUTE TEMP-VALUE-1 ROUNDED =
>               (N + ((D - DPP) / DPP)) / PPY
> 
>            compute mnthly-rate rounded = lf-rate / n
>            compute mob rounded = mnthly-rate * 12
>       *    compute mob rounded =
>       *       (lf-rate / n * 12)
> 
>            COMPUTE TEMP-VALUE-2 ROUNDED = A-PRM-ANGLE-N -
>               ((N * TEMP-VALUE-1 *
>               (mob / 100)) +
>               (N * (aH-RATE / 100)))
> 
>            COMPUTE pmt ROUNDED = L / TEMP-VALUE-2
>       *    display ' anglen ' a-angle-n
>       *    display ' gamma  ' gamma
>       *    display ' prm anglen ' a-prm-angle-n
>       *    display ' tv1        ' temp-value-1
>       *    display ' mob        ' mob
>       *    display ' tv2        ' temp-value-2
>       *    display ' pmt        ' pmt
> 
>            .
>        0250-check-for-partial.
> 
>            if ws-lf-limit-partial-cov = 0
>               move pmt                 to dispmt
>                                           lifepmt1
>                                           lifepmt2
>                                           newpmt
>               go to 0250-carry-on
>            end-if
> 
>            if pmt < ws-di-limit-max-mo-ben
>               move pmt                 to dispmt
>            else
>               move ws-di-limit-max-mo-ben
>                                        to dispmt
>            end-if
> 
>            if (ws-di-limit-max-tot-ben / n) < dispmt
>               compute dispmt rounded =
>                  (ws-di-limit-max-tot-ben / n) - .005
>            end-if
> 
>            compute lifepmt1 rounded =
>               (l + (pmt * n * (n + (d - dpp) / dpp) / ppy * mob /
>                  100) + dispmt * (n * ah-rate / 100)) / A-PRM-ANGLE-N
> 
>            if (ws-lf-limit-max-benefit / n) < lifepmt1
>               compute lifepmt1 rounded =
>                  ws-lf-limit-max-benefit / n
>               move ws-lf-limit-max-benefit
>                                        to ws-max-lf-benefit
>            end-if
> 
>            compute newpmt rounded =
>               (l + (lifepmt1 * n * (n + (d - dpp) / dpp) / ppy *
>                  mob / 100) + dispmt * (n * ah-rate / 100)) /
>                  A-PRM-ANGLE-N
> 
>            .
>        0250-carry-on.
> 
>            COMPUTE DL-PREMIUM ROUNDED =
>               lifepmt1 * N * TEMP-VALUE-1 *
>               (mob / 100)
> 
>            COMPUTE AH-PREMIUM ROUNDED =
>               dispmt * m * (AH-RATE / 100)
> 
>       *    display ' L         ' l
>       *    display ' anglen       ' a-angle-n
>       *    display ' days(d)      ' d
>       *    display ' gamma        ' gamma
>       *    display 'a-prm-angle-n ' a-prm-angle-n
>       *    display ' tv1          ' temp-value-1
>       *    display ' mob          ' mob
>       *    display ' tv2          ' temp-value-2
>       *    display ' ah rate      ' ah-rate
>       *    display ' m            ' m
>  
>            COMPUTE T-FINANCED =
>                L + DL-PREMIUM + AH-PREMIUM
> 
>            COMPUTE T-PAYMENTS = N * newPmt
> 
>            if i = 0
>               move t-financed          to t-payments
>            end-if
> 
>            if ws-max-lf-benefit = zeros
>               move t-payments          to ws-max-lf-benefit
>            end-if
> 
>            move newpmt                 to ws-rate-per-pmt
>            move dispmt                 to ws-max-ah-benefit
>            move dl-premium             to ws-rate-lf-prem
>            move ah-premium             to ws-rate-ah-prem
>            move t-financed             to ws-rate-tot-financed
>            move t-payments             to ws-rate-tot-pmts
> 
> 
>       *    display ' lf-rate       ' lf-rate
>       *    display ' ah-rate       ' ah-rate
>       *    display ' payment       ' pmt
>       *    display ' dis pmt       ' dispmt
>       *    display ' lifepmt1      ' lifepmt1
>       *    display ' new pmt       ' newpmt
>       *    display ' lf prem       ' ws-rate-lf-prem
>       *    display ' ah prem       ' ws-rate-ah-prem
>       *    display ' tot financed  ' ws-rate-tot-financed
>       *    display ' tot payments  ' ws-rate-tot-pmts
> 
>            go to 0250-exit
> 
>            .
>        xxxx-code-that-works.  *>!!!!!!
> 
>       ***____________________________________________________________***
>       **(-                                                          -)**
>       **(-   Right now this should work for all states other than   -)**
>       **(-    listed above. Below worked prior to adding partial    -)**
>       **(-    coverage stuff.                                       -)**
>       ***____________________________________________________________***
> 
>            move ws-rate-loan-amt       to l
>            move ws-rate-loan-term      to n
>            move ws-rate-lf-term        to m
>            move ws-rate-pmts-per-year  to ppy
>            move 30                     to dpp
>            compute i = ws-rate-apr / (ppy * 100)
> 
>            if i = 0
>               move n                   to a-angle-n
>            else
>               COMPUTE A-ANGLE-N ROUNDED =
>                  (1 - ((1 / (1 + I)) ** N)) / I
>            end-if
> 
>            if i = 0
>               compute a-angle-n-m = n - m
>            else
>               COMPUTE A-ANGLE-N-M ROUNDED =
>                  (1 - ((1 / (1 + I)) ** (N - M))) / I
>            end-if
> 
>            COMPUTE GAMMA ROUNDED =
>                (1 + ((D * I) / DPP)) / (1 + I)
> 
>            COMPUTE A-PRM-ANGLE-N ROUNDED =
>               A-ANGLE-N / GAMMA
> 
>            COMPUTE TEMP-VALUE-1 ROUNDED =
>               (N + ((D - DPP) / DPP)) / PPY
> 
>            compute mob rounded =
>               (lf-rate / n * 12)
> 
>            COMPUTE TEMP-VALUE-2 ROUNDED = A-PRM-ANGLE-N -
>               ((N * TEMP-VALUE-1 *
>               (mob / 100)) +
>               (N * (aH-RATE / 100)))
> 
>            COMPUTE pmt ROUNDED = L / TEMP-VALUE-2
> 
>            COMPUTE DL-PREMIUM ROUNDED =
>               pmt * N * TEMP-VALUE-1 *
>               (mob / 100)
> 
> 
>            COMPUTE AH-PREMIUM ROUNDED =
>               pmt * N * (AH-RATE / 100)
> 
>       *    display ' L         ' l
>       *    display ' anglen       ' a-angle-n
>       *    display ' days(d)      ' d
>       *    display ' gamma        ' gamma
>       *    display 'a-prm-angle-n ' a-prm-angle-n
>       *    display ' tv1          ' temp-value-1
>       *    display ' mob          ' mob
>       *    display ' tv2          ' temp-value-2
>       *    display ' ah rate      ' ah-rate
>       *    display ' m            ' m
>  
>            COMPUTE T-FINANCED =
>                L + DL-PREMIUM + AH-PREMIUM
> 
>            COMPUTE T-PAYMENTS = N * Pmt
> 
>            move pmt                    to ws-rate-per-pmt
>            move dl-premium             to ws-rate-lf-prem
>            move ah-premium             to ws-rate-ah-prem
>            move t-financed             to ws-rate-tot-financed
>            move t-payments             to ws-rate-tot-pmts
> 
>       *    display ' lf-rate       ' lf-rate
>       *    display ' ah-rate       ' ah-rate
>       *    display ' payment       ' pmt
>       *    display ' lf prem       ' ws-rate-lf-prem
>       *    display ' ah prem       ' ws-rate-ah-prem
>       *    display ' tot financed  ' ws-rate-tot-financed
>       *    display ' tot payments  ' ws-rate-tot-pmts
> 
>            .
>        0250-exit.
>            exit.
> 
>        0300-RETURN-CICS.
> 
>            perform 0400-disconnect     thru 0400-exit
>            move ws-return-string       to dfhcommarea
>            exec cics return end-exec
>            goback
> 
>            .
>        0300-exit.
>            exit.
> 
>        0400-disconnect.
> 
>            if connected-to-db
>               EXEC SQL
>                   disconnect all
>               END-EXEC
>               move ' ' to ws-connect-sw
>            end-if
> 
>            .
>        0400-exit.
>            exit.
> 
>        6000-CONNECT-TO-DB.
>       
>       ***-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_***
>       ***                                                            ***
>       ***                                                            ***
>       ***_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-***
> 
>            evaluate true
>               when ws-kix-myenv = 'cid1p'
>                  MOVE 'NTCSO2_CrtManage'
>                                        TO SVR
>                  move 'sa'             to usr
>                  move 'ntcso2'         to pass
>               when ws-kix-myenv = 'mdoff'
>                  MOVE 'NTSQLTST2UAT_CrtManage'
>                                        TO SVR
>                  move 'sa'             to usr
>                  move 'sql2008r2'      to pass
>               when other
>                  MOVE 'NTSQLTST2_CrtManage'
>                                        TO SVR
>                  move 'sa'             to usr
>                  move 'sql2008r2'      to pass
>            end-evaluate
> 
>            string
1850,1851d3826
<            display ' About to connect to ' svr ' ' usr-pass
< 
1869a3845,3846
> 
>            move all '9'                to errate-key
1871,1874c3848,3889
<            EXEC CICS LINK
<               PROGRAM ('ELRATE')
<               COMMAREA (CALCULATION-PASS-AREA)
<               LENGTH   (CP-COMM-LENGTH)
---
>            MOVE CP-COMPANY-CD          TO RATE-COMPANY-CD
>            MOVE CP-STATE               TO RATE-ST-CODE
>            MOVE CP-CLASS-CODE          TO RATE-ST-CLASS
>            MOVE CP-DEVIATION-CODE      TO RATE-ST-DEV
>            MOVE CP-ISSUE-AGE           TO RATE-HIGH-AGE
> 
>            IF CP-RATING-BENEFIT-AMT NOT NUMERIC OR
>               CP-RATING-BENEFIT-AMT = ZEROS
>               MOVE CP-ORIGINAL-BENEFIT TO RATE-HIGH-AMT
>            ELSE
>               MOVE CP-RATING-BENEFIT-AMT
>                                        TO RATE-HIGH-AMT
>            end-if
> 
>            IF CP-AH
>                MOVE CP-AH-OVERRIDE-CODE
>                                        TO RATE-L-AH
>            ELSE
>                MOVE CP-LIFE-OVERRIDE-CODE
>                                        TO RATE-L-AH
>            end-if
> 
>            MOVE CP-BENEFIT-CD          TO RATE-LAH-NUM
>            MOVE CP-CERT-EFF-DT         TO DC-BIN-DATE-1
>            MOVE SPACE                  TO DC-OPTION-CODE
>      
>            PERFORM 9700-date-link      thru 9700-exit
>      
>            IF NO-CONVERSION-ERROR
>               move errate-key          to save-errate-key
>               MOVE dc-greg-date-cymd   TO RATE-EXPIRY-DATE
>                                           svrt-expiry-date
>            ELSE
>               MOVE '2'                 TO CP-RETURN-CODE
>               GO TO 7000-exit
>            END-IF
> 
>            EXEC CICS STARTBR
>               DATASET  ('ERRATE')
>               RIDFLD   (ERRATE-KEY)
>               RESP     (ws-response)
>               GTEQ
1876c3891,3947
<            
---
> 
>            if not resp-normal
>               move '6'                 to cp-return-code
>               go to 7000-exit
>            end-if
> 
>            .
>        7000-read-loop.
> 
>            EXEC CICS READNEXT
>               DATASET  ('ERRATE')
>               into     (RATE-RECORD)
>               RESP     (ws-response)
>               RIDFLD   (ERRATE-KEY)
>            END-EXEC
> 
>            if not resp-normal
>               move '6'                 to cp-return-code
>               go to 7000-done
>            end-if
> 
>            IF SVRT-COMPANY-CD = RT-COMPANY-CD  AND
>               SVRT-ST-CODE    = RT-ST-CODE     AND
>               SVRT-ST-CLASS   = RT-ST-CLASS    AND
>               SVRT-ST-DEV     = RT-ST-DEV      AND
>               SVRT-L-AH       = RT-L-AH        AND
>               SVRT-LAH-NUM    = RT-LAH-NUM
>               continue
>            ELSE
>               move '6'                 to cp-return-code
>               go to 7000-done
>            end-if
> 
>            IF SVRT-HIGH-AGE > RT-HIGH-AGE
>               move '6'                 to cp-return-code
>               go to 7000-done
>            end-if
> 
>            IF SVRT-HIGH-AMT >= RT-HIGH-AMT
>               GO TO 7000-read-loop
>            end-if
>      
>            IF SVRT-EXPIRY-DATE > RT-EXPIRY-DATE
>               GO TO 7000-read-loop
>            end-if
>      
>            IF SVRT-EXPIRY-DATE = RT-EXPIRY-DATE
>               GO TO 7000-read-loop
>            end-if
> 
>            .
>        7000-done.
> 
>            EXEC CICS ENDBR
>               DATASET  ('ERRATE')
>            END-EXEC
> 

</pre>
<h3><a name="WSMESS03.cl2">WSMESS03.cl2</a><br><a href="#topper">Back to Top</a><br><pre>

 This is a new module located on slunikix at - /apps/prod/cid1p/src/online/WSMESS03.cl2

</pre>
</body></html>